diff --git a/demos/declarative/calculator/main.cpp b/demos/declarative/calculator/main.cpp
index cb79f85..1ba16ca 100644
--- a/demos/declarative/calculator/main.cpp
+++ b/demos/declarative/calculator/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include <QtCore/QDebug>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
diff --git a/demos/declarative/flickr/main.cpp b/demos/declarative/flickr/main.cpp
index ab5ad2b..5cc4e04 100644
--- a/demos/declarative/flickr/main.cpp
+++ b/demos/declarative/flickr/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/demos/declarative/minehunt/main.cpp b/demos/declarative/minehunt/main.cpp
index 8d3c545..2089703 100644
--- a/demos/declarative/minehunt/main.cpp
+++ b/demos/declarative/minehunt/main.cpp
@@ -41,9 +41,9 @@
 
 #include "qmlapplicationviewer.h"
 #include "minehunt.h"
-#include <QtGui/QApplication>
-#include <QtDeclarative/QDeclarativeContext>
-#include <QtDeclarative/QDeclarativeEngine>
+#include <QtWidgets/QApplication>
+#include <QtQuick1/QDeclarativeContext>
+#include <QtQuick1/QDeclarativeEngine>
 
 int main(int argc, char *argv[])
 {
diff --git a/demos/declarative/minehunt/minehunt.pro b/demos/declarative/minehunt/minehunt.pro
index 5c0b707..29af4cc 100644
--- a/demos/declarative/minehunt/minehunt.pro
+++ b/demos/declarative/minehunt/minehunt.pro
@@ -20,6 +20,8 @@ symbian:{
     TARGET.EPOCALLOWDLLDATA = 1
     TARGET.EPOCHEAPSIZE = 0x20000 0x2000000
     include($$QT_SOURCE_TREE/demos/symbianpkgrules.pri)
+    qmlminehuntfiles.files = MinehuntCore minehunt.qml
+    DEPLOYMENT += qmlminehuntfiles
 }
 
 # Allow network access on Symbian
diff --git a/demos/declarative/photoviewer/main.cpp b/demos/declarative/photoviewer/main.cpp
index e0988ba..9632fe7 100644
--- a/demos/declarative/photoviewer/main.cpp
+++ b/demos/declarative/photoviewer/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/demos/declarative/rssnews/main.cpp b/demos/declarative/rssnews/main.cpp
index d3f6026..862834f 100644
--- a/demos/declarative/rssnews/main.cpp
+++ b/demos/declarative/rssnews/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/demos/declarative/samegame/main.cpp b/demos/declarative/samegame/main.cpp
index 819e86b..6ef94e8 100644
--- a/demos/declarative/samegame/main.cpp
+++ b/demos/declarative/samegame/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/demos/declarative/snake/main.cpp b/demos/declarative/snake/main.cpp
index cd2b512..11241cf 100644
--- a/demos/declarative/snake/main.cpp
+++ b/demos/declarative/snake/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/demos/declarative/twitter/main.cpp b/demos/declarative/twitter/main.cpp
index 0599f31..2494884 100644
--- a/demos/declarative/twitter/main.cpp
+++ b/demos/declarative/twitter/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/demos/declarative/webbrowser/main.cpp b/demos/declarative/webbrowser/main.cpp
index abbfd04..1b59d85 100644
--- a/demos/declarative/webbrowser/main.cpp
+++ b/demos/declarative/webbrowser/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/demos/demos.pro b/demos/demos.pro
new file mode 100644
index 0000000..f80ed20
--- /dev/null
+++ b/demos/demos.pro
@@ -0,0 +1,2 @@
+TEMPLATE    = subdirs
+SUBDIRS += declarative helper
diff --git a/demos/helper/qmlapplicationviewer/qmlapplicationviewer.cpp b/demos/helper/qmlapplicationviewer/qmlapplicationviewer.cpp
index 570f68f..d8a9336 100644
--- a/demos/helper/qmlapplicationviewer/qmlapplicationviewer.cpp
+++ b/demos/helper/qmlapplicationviewer/qmlapplicationviewer.cpp
@@ -42,10 +42,10 @@
 
 #include <QtCore/QDir>
 #include <QtCore/QFileInfo>
-#include <QtDeclarative/QDeclarativeComponent>
-#include <QtDeclarative/QDeclarativeEngine>
-#include <QtDeclarative/QDeclarativeContext>
-#include <QtGui/QApplication>
+#include <QtQuick1/QDeclarativeComponent>
+#include <QtQuick1/QDeclarativeEngine>
+#include <QtQuick1/QDeclarativeContext>
+#include <QtWidgets/QApplication>
 
 #include <qplatformdefs.h> // MEEGO_EDITION_HARMATTAN
 
@@ -164,45 +164,8 @@ void QmlApplicationViewer::addImportPath(const QString &path)
 
 void QmlApplicationViewer::setOrientation(ScreenOrientation orientation)
 {
-#if defined(Q_OS_SYMBIAN)
-    // If the version of Qt on the device is < 4.7.2, that attribute won't work
-    if (orientation != ScreenOrientationAuto) {
-        const QStringList v = QString::fromAscii(qVersion()).split(QLatin1Char('.'));
-        if (v.count() == 3 && (v.at(0).toInt() << 16 | v.at(1).toInt() << 8 | v.at(2).toInt()) < 0x040702) {
-            qWarning("Screen orientation locking only supported with Qt 4.7.2 and above");
-            return;
-        }
-    }
-#endif // Q_OS_SYMBIAN
-
-    Qt::WidgetAttribute attribute;
-    switch (orientation) {
-#if QT_VERSION < 0x040702
-    // Qt < 4.7.2 does not yet have the Qt::WA_*Orientation attributes
-    case ScreenOrientationLockPortrait:
-        attribute = static_cast<Qt::WidgetAttribute>(128);
-        break;
-    case ScreenOrientationLockLandscape:
-        attribute = static_cast<Qt::WidgetAttribute>(129);
-        break;
-    default:
-    case ScreenOrientationAuto:
-        attribute = static_cast<Qt::WidgetAttribute>(130);
-        break;
-#else // QT_VERSION < 0x040702
-    case ScreenOrientationLockPortrait:
-        attribute = Qt::WA_LockPortraitOrientation;
-        break;
-    case ScreenOrientationLockLandscape:
-        attribute = Qt::WA_LockLandscapeOrientation;
-        break;
-    default:
-    case ScreenOrientationAuto:
-        attribute = Qt::WA_AutoOrientation;
-        break;
-#endif // QT_VERSION < 0x040702
-    };
-    setAttribute(attribute, true);
+    // TODO: Needs a Qt5 implmentation
+    Q_UNUSED(orientation)
 }
 
 void QmlApplicationViewer::showExpanded()
diff --git a/demos/helper/qmlapplicationviewer/qmlapplicationviewer.h b/demos/helper/qmlapplicationviewer/qmlapplicationviewer.h
index 85c02ab..d8ef27e 100644
--- a/demos/helper/qmlapplicationviewer/qmlapplicationviewer.h
+++ b/demos/helper/qmlapplicationviewer/qmlapplicationviewer.h
@@ -41,7 +41,7 @@
 #ifndef QMLAPPLICATIONVIEWER_H
 #define QMLAPPLICATIONVIEWER_H
 
-#include <QtDeclarative/QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 
 class QmlApplicationViewer : public QDeclarativeView
 {
diff --git a/demos/helper/qmlapplicationviewer/qmlapplicationviewer.pri b/demos/helper/qmlapplicationviewer/qmlapplicationviewer.pri
index 6809b64..2feb9e0 100644
--- a/demos/helper/qmlapplicationviewer/qmlapplicationviewer.pri
+++ b/demos/helper/qmlapplicationviewer/qmlapplicationviewer.pri
@@ -4,7 +4,7 @@
 # It is recommended not to modify this file, since newer versions of Qt Creator
 # may offer an updated version of it.
 
-QT += declarative
+QT += quick1
 
 SOURCES += $$PWD/qmlapplicationviewer.cpp
 HEADERS += $$PWD/qmlapplicationviewer.h
diff --git a/demos/mobile/guitartuner/guitartuner.pro b/demos/mobile/guitartuner/guitartuner.pro
index 6283530..b86f477 100644
--- a/demos/mobile/guitartuner/guitartuner.pro
+++ b/demos/mobile/guitartuner/guitartuner.pro
@@ -4,7 +4,7 @@
 #
 #-------------------------------------------------
 
-QT       += core gui
+QT       += core gui widgets
 
 TARGET = guitartuner
 TEMPLATE = app
@@ -65,8 +65,8 @@ symbian {
     TARGET.CAPABILITY = UserEnvironment
 }
 
-# Add declarative module
-QT       += declarative
+# Add quick1 module
+QT       += quick1
 
 OTHER_FILES += \
     src/application.qml \
diff --git a/demos/mobile/guitartuner/src/guitartuner.cpp b/demos/mobile/guitartuner/src/guitartuner.cpp
index 43222f2..35c553b 100644
--- a/demos/mobile/guitartuner/src/guitartuner.cpp
+++ b/demos/mobile/guitartuner/src/guitartuner.cpp
@@ -320,40 +320,6 @@ void GuitarTuner::setMaxVolumeLevel(qreal percent)
   */
 void GuitarTuner::setOrientation(Orientation orientation)
 {
-#ifdef Q_OS_SYMBIAN
-    if (orientation != Auto) {
-#if defined(ORIENTATIONLOCK)
-        const CAknAppUiBase::TAppUiOrientation uiOrientation =
-                (orientation == LockPortrait)
-                    ? CAknAppUi::EAppUiOrientationPortrait
-                    : CAknAppUi::EAppUiOrientationLandscape;
-        CAknAppUi* appUi = dynamic_cast<CAknAppUi*>
-                (CEikonEnv::Static()->AppUi());
-        TRAPD(error,
-            if (appUi)
-                appUi->SetOrientationL(uiOrientation);
-        );
-#else // ORIENTATIONLOCK
-        qWarning(QString("'ORIENTATIONLOCK' needs to be defined on")
-                 +QString(" Symbian when locking the orientation."));
-#endif // ORIENTATIONLOCK
-    }
-#elif defined(Q_WS_MAEMO_5)
-    Qt::WidgetAttribute attribute;
-    switch (orientation) {
-    case LockPortrait:
-        attribute = Qt::WA_Maemo5PortraitOrientation;
-        break;
-    case LockLandscape:
-        attribute = Qt::WA_Maemo5LandscapeOrientation;
-        break;
-    case Auto:
-    default:
-        attribute = Qt::WA_Maemo5AutoOrientation;
-        break;
-    }
-    setAttribute(attribute, true);
-#else // Q_OS_SYMBIAN
-    Q_UNUSED(orientation);
-#endif // Q_OS_SYMBIAN
+    // TODO: Needs a Qt5 implmentation
+    Q_UNUSED(orientation)
 }
diff --git a/demos/mobile/guitartuner/src/guitartuner.h b/demos/mobile/guitartuner/src/guitartuner.h
index fbb16f7..fdac53f 100644
--- a/demos/mobile/guitartuner/src/guitartuner.h
+++ b/demos/mobile/guitartuner/src/guitartuner.h
@@ -42,7 +42,7 @@
 #define MAINWINDOW_H
 
 #include <QMainWindow>
-#include <QtDeclarative>
+#include <QtQuick1>
 #include <QAudioDeviceInfo>
 #include <QAudioOutput>
 #include <QAudioInput>
diff --git a/demos/mobile/guitartuner/src/main.cpp b/demos/mobile/guitartuner/src/main.cpp
index 7ddd1f7..3930793 100644
--- a/demos/mobile/guitartuner/src/main.cpp
+++ b/demos/mobile/guitartuner/src/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "guitartuner.h"
 
 int main(int argc, char *argv[])
diff --git a/demos/mobile/qtbubblelevel/main.cpp b/demos/mobile/qtbubblelevel/main.cpp
index df1393d..a8de03c 100644
--- a/demos/mobile/qtbubblelevel/main.cpp
+++ b/demos/mobile/qtbubblelevel/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtDeclarative>
+#include <QtQuick1>
 #include <QtGui>
 #include <QAccelerometer>
 
diff --git a/demos/mobile/qtbubblelevel/qtbubblelevel.pro b/demos/mobile/qtbubblelevel/qtbubblelevel.pro
index 3314815..93c676c 100644
--- a/demos/mobile/qtbubblelevel/qtbubblelevel.pro
+++ b/demos/mobile/qtbubblelevel/qtbubblelevel.pro
@@ -1,4 +1,4 @@
-QT       += core gui declarative
+QT       += core gui quick1
 CONFIG   += mobility
 MOBILITY += sensors
 
diff --git a/demos/mobile/quickhit/main.cpp b/demos/mobile/quickhit/main.cpp
index e6e021d..fbfd4ce 100644
--- a/demos/mobile/quickhit/main.cpp
+++ b/demos/mobile/quickhit/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include <QDesktopWidget>
 #include "mainwindow.h"
 
diff --git a/demos/mobile/quickhit/quickhit.pro b/demos/mobile/quickhit/quickhit.pro
index 44bf09b..70a8145 100644
--- a/demos/mobile/quickhit/quickhit.pro
+++ b/demos/mobile/quickhit/quickhit.pro
@@ -1,4 +1,4 @@
-QT       += core gui declarative opengl
+QT       += core gui quick1 opengl
 
 VERSION = 1.1.1
 
diff --git a/doc/src/snippets/declarative/qtbinding/context-advanced/main.cpp b/doc/src/snippets/declarative/qtbinding/context-advanced/main.cpp
index 6951f69..9de6b70 100644
--- a/doc/src/snippets/declarative/qtbinding/context-advanced/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/context-advanced/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 #include "applicationdata.h"
 
diff --git a/doc/src/snippets/declarative/qtbinding/context/main.cpp b/doc/src/snippets/declarative/qtbinding/context/main.cpp
index cfe130a..0597107 100644
--- a/doc/src/snippets/declarative/qtbinding/context/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/context/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 int main(int argc, char *argv[])
 {
diff --git a/doc/src/snippets/declarative/qtbinding/enums/imageviewer.h b/doc/src/snippets/declarative/qtbinding/enums/imageviewer.h
index 75e9923..1cf89f1 100644
--- a/doc/src/snippets/declarative/qtbinding/enums/imageviewer.h
+++ b/doc/src/snippets/declarative/qtbinding/enums/imageviewer.h
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 //![start]
 class ImageViewer : public QDeclarativeItem
diff --git a/doc/src/snippets/declarative/qtbinding/enums/main.cpp b/doc/src/snippets/declarative/qtbinding/enums/main.cpp
index 3dbc56d..802c469 100644
--- a/doc/src/snippets/declarative/qtbinding/enums/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/enums/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 #include "imageviewer.h"
 
diff --git a/doc/src/snippets/declarative/qtbinding/functions-cpp/main.cpp b/doc/src/snippets/declarative/qtbinding/functions-cpp/main.cpp
index 8c4d6b2..1526f21 100644
--- a/doc/src/snippets/declarative/qtbinding/functions-cpp/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/functions-cpp/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 #include "myclass.h"
 
diff --git a/doc/src/snippets/declarative/qtbinding/functions-qml/main.cpp b/doc/src/snippets/declarative/qtbinding/functions-qml/main.cpp
index 4ddbfb9..1d666d2 100644
--- a/doc/src/snippets/declarative/qtbinding/functions-qml/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/functions-qml/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 int main(int argc, char *argv[])
 {
diff --git a/doc/src/snippets/declarative/qtbinding/loading/main.cpp b/doc/src/snippets/declarative/qtbinding/loading/main.cpp
index 20f9813..43247d9 100644
--- a/doc/src/snippets/declarative/qtbinding/loading/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/loading/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 static void withComponent()
 {
diff --git a/doc/src/snippets/declarative/qtbinding/newelements/imageviewer.h b/doc/src/snippets/declarative/qtbinding/newelements/imageviewer.h
index b0fdaf5..da08eae 100644
--- a/doc/src/snippets/declarative/qtbinding/newelements/imageviewer.h
+++ b/doc/src/snippets/declarative/qtbinding/newelements/imageviewer.h
@@ -39,7 +39,7 @@
 ****************************************************************************/
 //![0]
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 class ImageViewer : public QDeclarativeItem
 {
diff --git a/doc/src/snippets/declarative/qtbinding/newelements/main.cpp b/doc/src/snippets/declarative/qtbinding/newelements/main.cpp
index 0825a60..1ffdd57 100644
--- a/doc/src/snippets/declarative/qtbinding/newelements/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/newelements/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 #include "imageviewer.h"
 
diff --git a/doc/src/snippets/declarative/qtbinding/properties-cpp/main.cpp b/doc/src/snippets/declarative/qtbinding/properties-cpp/main.cpp
index 2da27e3..5476f21 100644
--- a/doc/src/snippets/declarative/qtbinding/properties-cpp/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/properties-cpp/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 #include "applicationdata.h"
 
diff --git a/doc/src/snippets/declarative/qtbinding/properties-qml/main.cpp b/doc/src/snippets/declarative/qtbinding/properties-qml/main.cpp
index acbf206..bf8d46c 100644
--- a/doc/src/snippets/declarative/qtbinding/properties-qml/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/properties-qml/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 int main(int argc, char *argv[])
 {
diff --git a/doc/src/snippets/declarative/qtbinding/signals-cpp/imageviewer.h b/doc/src/snippets/declarative/qtbinding/signals-cpp/imageviewer.h
index e235249..7be9695 100644
--- a/doc/src/snippets/declarative/qtbinding/signals-cpp/imageviewer.h
+++ b/doc/src/snippets/declarative/qtbinding/signals-cpp/imageviewer.h
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 //![start]
 class ImageViewer : public QDeclarativeItem
diff --git a/doc/src/snippets/declarative/qtbinding/signals-cpp/main.cpp b/doc/src/snippets/declarative/qtbinding/signals-cpp/main.cpp
index f418ed3..b3cc907 100644
--- a/doc/src/snippets/declarative/qtbinding/signals-cpp/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/signals-cpp/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 #include "imageviewer.h"
 
diff --git a/doc/src/snippets/declarative/qtbinding/signals-qml/main.cpp b/doc/src/snippets/declarative/qtbinding/signals-qml/main.cpp
index e31e3ee..0f90763 100644
--- a/doc/src/snippets/declarative/qtbinding/signals-qml/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/signals-qml/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 //![0]
 int main(int argc, char *argv[]) {
diff --git a/doc/src/snippets/declarative/qtbinding/variantlistmap/main.cpp b/doc/src/snippets/declarative/qtbinding/variantlistmap/main.cpp
index a00df36..90c4ae7 100644
--- a/doc/src/snippets/declarative/qtbinding/variantlistmap/main.cpp
+++ b/doc/src/snippets/declarative/qtbinding/variantlistmap/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 #include <QtCore>
-#include <QtDeclarative>
+#include <QtQuick1>
 
 int main(int argc, char *argv[]) {
     QApplication app(argc, argv);
diff --git a/examples/declarative/animation/basics/color-animation/main.cpp b/examples/declarative/animation/basics/color-animation/main.cpp
index 20cb7c7..719d203 100644
--- a/examples/declarative/animation/basics/color-animation/main.cpp
+++ b/examples/declarative/animation/basics/color-animation/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/animation/basics/property-animation/main.cpp b/examples/declarative/animation/basics/property-animation/main.cpp
index 50a5a78..5cc0758 100644
--- a/examples/declarative/animation/basics/property-animation/main.cpp
+++ b/examples/declarative/animation/basics/property-animation/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/animation/behaviors/behavior-example/main.cpp b/examples/declarative/animation/behaviors/behavior-example/main.cpp
index d60ee64..6a9abbf 100644
--- a/examples/declarative/animation/behaviors/behavior-example/main.cpp
+++ b/examples/declarative/animation/behaviors/behavior-example/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/animation/behaviors/wigglytext/main.cpp b/examples/declarative/animation/behaviors/wigglytext/main.cpp
index d60ee64..6a9abbf 100644
--- a/examples/declarative/animation/behaviors/wigglytext/main.cpp
+++ b/examples/declarative/animation/behaviors/wigglytext/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/animation/easing/main.cpp b/examples/declarative/animation/easing/main.cpp
index 5cd75e7..4eb2411 100644
--- a/examples/declarative/animation/easing/main.cpp
+++ b/examples/declarative/animation/easing/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/animation/states/main.cpp b/examples/declarative/animation/states/main.cpp
index 3728c68..a7c37ff 100644
--- a/examples/declarative/animation/states/main.cpp
+++ b/examples/declarative/animation/states/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/cppextensions/imageprovider/imageprovider.pro b/examples/declarative/cppextensions/imageprovider/imageprovider.pro
index ad918c3..84044f4 100644
--- a/examples/declarative/cppextensions/imageprovider/imageprovider.pro
+++ b/examples/declarative/cppextensions/imageprovider/imageprovider.pro
@@ -1,6 +1,6 @@
 TEMPLATE = lib
 CONFIG += qt plugin
-QT += declarative
+QT += quick1
 
 DESTDIR = ImageProviderCore
 TARGET  = qmlimageproviderplugin
diff --git a/examples/declarative/cppextensions/networkaccessmanagerfactory/networkaccessmanagerfactory.pro b/examples/declarative/cppextensions/networkaccessmanagerfactory/networkaccessmanagerfactory.pro
index 4f32197..88636c3 100644
--- a/examples/declarative/cppextensions/networkaccessmanagerfactory/networkaccessmanagerfactory.pro
+++ b/examples/declarative/cppextensions/networkaccessmanagerfactory/networkaccessmanagerfactory.pro
@@ -28,7 +28,7 @@ symbian:TARGET.CAPABILITY += NetworkServices
 
 # Add dependency to Symbian components
 # CONFIG += qt-components
-QT += network
+QT += network widgets
 
 # The .cpp file which was generated for your project. Feel free to hack it.
 SOURCES += main.cpp
diff --git a/examples/declarative/cppextensions/plugins/plugin.cpp b/examples/declarative/cppextensions/plugins/plugin.cpp
index c26e889..b77c9fb 100644
--- a/examples/declarative/cppextensions/plugins/plugin.cpp
+++ b/examples/declarative/cppextensions/plugins/plugin.cpp
@@ -38,8 +38,8 @@
 **
 ****************************************************************************/
 
-#include <QtDeclarative/QDeclarativeExtensionPlugin>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/QDeclarativeExtensionPlugin>
+#include <QtQuick1/qdeclarative.h>
 #include <qdebug.h>
 #include <qdatetime.h>
 #include <qbasictimer.h>
diff --git a/examples/declarative/cppextensions/plugins/plugins.pro b/examples/declarative/cppextensions/plugins/plugins.pro
index e5c05e0..a29d3ef 100644
--- a/examples/declarative/cppextensions/plugins/plugins.pro
+++ b/examples/declarative/cppextensions/plugins/plugins.pro
@@ -1,6 +1,6 @@
 TEMPLATE = lib
 CONFIG += qt plugin
-QT += declarative
+QT += widgets quick1
 
 DESTDIR = com/nokia/TimeExample
 TARGET  = qmlqtimeexampleplugin
diff --git a/examples/declarative/cppextensions/qgraphicslayouts/layoutitem/layoutitem.pro b/examples/declarative/cppextensions/qgraphicslayouts/layoutitem/layoutitem.pro
index 77c6b2a..9054f19 100644
--- a/examples/declarative/cppextensions/qgraphicslayouts/layoutitem/layoutitem.pro
+++ b/examples/declarative/cppextensions/qgraphicslayouts/layoutitem/layoutitem.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = 
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += widgets quick1
 
 SOURCES += main.cpp
 RESOURCES += layoutitem.qrc
diff --git a/examples/declarative/cppextensions/qgraphicslayouts/qgraphicsgridlayout/qgraphicsgridlayout.pro b/examples/declarative/cppextensions/qgraphicslayouts/qgraphicsgridlayout/qgraphicsgridlayout.pro
index e42b7ed..e616fae 100644
--- a/examples/declarative/cppextensions/qgraphicslayouts/qgraphicsgridlayout/qgraphicsgridlayout.pro
+++ b/examples/declarative/cppextensions/qgraphicslayouts/qgraphicsgridlayout/qgraphicsgridlayout.pro
@@ -28,7 +28,7 @@ symbian:TARGET.CAPABILITY += NetworkServices
 
 # Add dependency to Symbian components
 # CONFIG += qt-components
-QT += network
+QT += network widgets
 
 # The .cpp file which was generated for your project. Feel free to hack it.
 SOURCES += \
diff --git a/examples/declarative/cppextensions/qgraphicslayouts/qgraphicslinearlayout/qgraphicslinearlayout.pro b/examples/declarative/cppextensions/qgraphicslayouts/qgraphicslinearlayout/qgraphicslinearlayout.pro
index 52955e8..bec3691 100644
--- a/examples/declarative/cppextensions/qgraphicslayouts/qgraphicslinearlayout/qgraphicslinearlayout.pro
+++ b/examples/declarative/cppextensions/qgraphicslayouts/qgraphicslinearlayout/qgraphicslinearlayout.pro
@@ -29,6 +29,8 @@ symbian:TARGET.CAPABILITY += NetworkServices
 # Add dependency to Symbian components
 # CONFIG += qt-components
 
+QT += widgets
+
 # The .cpp file which was generated for your project. Feel free to hack it.
 SOURCES += \
     linearlayout.cpp \
diff --git a/examples/declarative/cppextensions/qwidgets/qwidgets.cpp b/examples/declarative/cppextensions/qwidgets/qwidgets.cpp
index 7781f12..d87cc7d 100644
--- a/examples/declarative/cppextensions/qwidgets/qwidgets.cpp
+++ b/examples/declarative/cppextensions/qwidgets/qwidgets.cpp
@@ -38,10 +38,10 @@
 **
 ****************************************************************************/
 
-#include <QtDeclarative/QDeclarativeExtensionPlugin>
-#include <QtDeclarative/qdeclarative.h>
-#include <QtGui/QGraphicsProxyWidget>
-#include <QtGui/QPushButton>
+#include <QtQuick1/QDeclarativeExtensionPlugin>
+#include <QtQuick1/qdeclarative.h>
+#include <QtWidgets/QGraphicsProxyWidget>
+#include <QtWidgets/QPushButton>
 #include <QDebug>
 
 class MyPushButton : public QGraphicsProxyWidget
diff --git a/examples/declarative/cppextensions/qwidgets/qwidgets.pro b/examples/declarative/cppextensions/qwidgets/qwidgets.pro
index d272180..750c864 100644
--- a/examples/declarative/cppextensions/qwidgets/qwidgets.pro
+++ b/examples/declarative/cppextensions/qwidgets/qwidgets.pro
@@ -1,6 +1,6 @@
 TEMPLATE = lib
 CONFIG += qt plugin
-QT += declarative
+QT += widgets quick1
 
 DESTDIR = QWidgets
 TARGET = qmlqwidgetsplugin
diff --git a/examples/declarative/cppextensions/referenceexamples/adding/adding.pro b/examples/declarative/cppextensions/referenceexamples/adding/adding.pro
index b2acf0e..8e22ea0 100644
--- a/examples/declarative/cppextensions/referenceexamples/adding/adding.pro
+++ b/examples/declarative/cppextensions/referenceexamples/adding/adding.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = adding
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/attached/attached.pro b/examples/declarative/cppextensions/referenceexamples/attached/attached.pro
index 2448841..57084da 100644
--- a/examples/declarative/cppextensions/referenceexamples/attached/attached.pro
+++ b/examples/declarative/cppextensions/referenceexamples/attached/attached.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = attached
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/binding/binding.pro b/examples/declarative/cppextensions/referenceexamples/binding/binding.pro
index 063de62..b8ecc2c 100644
--- a/examples/declarative/cppextensions/referenceexamples/binding/binding.pro
+++ b/examples/declarative/cppextensions/referenceexamples/binding/binding.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = binding
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/coercion/coercion.pro b/examples/declarative/cppextensions/referenceexamples/coercion/coercion.pro
index 4b63bac..d8acfa7 100644
--- a/examples/declarative/cppextensions/referenceexamples/coercion/coercion.pro
+++ b/examples/declarative/cppextensions/referenceexamples/coercion/coercion.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = coercion
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/default/default.pro b/examples/declarative/cppextensions/referenceexamples/default/default.pro
index aa72c11..63ea07c 100644
--- a/examples/declarative/cppextensions/referenceexamples/default/default.pro
+++ b/examples/declarative/cppextensions/referenceexamples/default/default.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = default
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/extended/extended.pro b/examples/declarative/cppextensions/referenceexamples/extended/extended.pro
index fb263fd..0513e96 100644
--- a/examples/declarative/cppextensions/referenceexamples/extended/extended.pro
+++ b/examples/declarative/cppextensions/referenceexamples/extended/extended.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = extended
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += widgets quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/grouped/grouped.pro b/examples/declarative/cppextensions/referenceexamples/grouped/grouped.pro
index 93406b6..92040e8 100644
--- a/examples/declarative/cppextensions/referenceexamples/grouped/grouped.pro
+++ b/examples/declarative/cppextensions/referenceexamples/grouped/grouped.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = grouped
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/methods/methods.pro b/examples/declarative/cppextensions/referenceexamples/methods/methods.pro
index ae06242..35868f8 100644
--- a/examples/declarative/cppextensions/referenceexamples/methods/methods.pro
+++ b/examples/declarative/cppextensions/referenceexamples/methods/methods.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = methods
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/properties/properties.pro b/examples/declarative/cppextensions/referenceexamples/properties/properties.pro
index 7b7616d..d5160ba 100644
--- a/examples/declarative/cppextensions/referenceexamples/properties/properties.pro
+++ b/examples/declarative/cppextensions/referenceexamples/properties/properties.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = properties
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/signal/signal.pro b/examples/declarative/cppextensions/referenceexamples/signal/signal.pro
index 339cfbc..a32ca93 100644
--- a/examples/declarative/cppextensions/referenceexamples/signal/signal.pro
+++ b/examples/declarative/cppextensions/referenceexamples/signal/signal.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = signal
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/cppextensions/referenceexamples/valuesource/valuesource.pro b/examples/declarative/cppextensions/referenceexamples/valuesource/valuesource.pro
index e95914b..770529d 100644
--- a/examples/declarative/cppextensions/referenceexamples/valuesource/valuesource.pro
+++ b/examples/declarative/cppextensions/referenceexamples/valuesource/valuesource.pro
@@ -2,7 +2,7 @@ TEMPLATE = app
 TARGET = valuesource
 DEPENDPATH += .
 INCLUDEPATH += .
-QT += declarative
+QT += quick1
 
 # Input
 SOURCES += main.cpp \
diff --git a/examples/declarative/i18n/main.cpp b/examples/declarative/i18n/main.cpp
index 1296edc..4c83adf 100644
--- a/examples/declarative/i18n/main.cpp
+++ b/examples/declarative/i18n/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/imageelements/borderimage/main.cpp b/examples/declarative/imageelements/borderimage/main.cpp
index e5d2566..9ee393f 100644
--- a/examples/declarative/imageelements/borderimage/main.cpp
+++ b/examples/declarative/imageelements/borderimage/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/imageelements/image/main.cpp b/examples/declarative/imageelements/image/main.cpp
index 114662b..352a7a1 100644
--- a/examples/declarative/imageelements/image/main.cpp
+++ b/examples/declarative/imageelements/image/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/imageelements/shadows/main.cpp b/examples/declarative/imageelements/shadows/main.cpp
index f910e3d..039e76c 100644
--- a/examples/declarative/imageelements/shadows/main.cpp
+++ b/examples/declarative/imageelements/shadows/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/keyinteraction/focus/main.cpp b/examples/declarative/keyinteraction/focus/main.cpp
index 1cbe5e0..ed3e020 100644
--- a/examples/declarative/keyinteraction/focus/main.cpp
+++ b/examples/declarative/keyinteraction/focus/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/abstractitemmodel/abstractitemmodel.pro b/examples/declarative/modelviews/abstractitemmodel/abstractitemmodel.pro
index c751b2c..3b4d826 100644
--- a/examples/declarative/modelviews/abstractitemmodel/abstractitemmodel.pro
+++ b/examples/declarative/modelviews/abstractitemmodel/abstractitemmodel.pro
@@ -29,6 +29,8 @@ symbian:TARGET.CAPABILITY += NetworkServices
 # Add dependency to Symbian components
 # CONFIG += qt-components
 
+QT += widgets
+
 # The .cpp file which was generated for your project. Feel free to hack it.
 SOURCES = main.cpp model.cpp
 HEADERS = model.h
diff --git a/examples/declarative/modelviews/gridview/main.cpp b/examples/declarative/modelviews/gridview/main.cpp
index a3e331b..0c243fb 100644
--- a/examples/declarative/modelviews/gridview/main.cpp
+++ b/examples/declarative/modelviews/gridview/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/listview/dynamiclist/main.cpp b/examples/declarative/modelviews/listview/dynamiclist/main.cpp
index 1d197cb..571f54e 100644
--- a/examples/declarative/modelviews/listview/dynamiclist/main.cpp
+++ b/examples/declarative/modelviews/listview/dynamiclist/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/listview/expandingdelegates/main.cpp b/examples/declarative/modelviews/listview/expandingdelegates/main.cpp
index b9c99a0..017420b 100644
--- a/examples/declarative/modelviews/listview/expandingdelegates/main.cpp
+++ b/examples/declarative/modelviews/listview/expandingdelegates/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/listview/highlight/main.cpp b/examples/declarative/modelviews/listview/highlight/main.cpp
index 0b1fe97..6f28c7a 100644
--- a/examples/declarative/modelviews/listview/highlight/main.cpp
+++ b/examples/declarative/modelviews/listview/highlight/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/listview/highlightranges/main.cpp b/examples/declarative/modelviews/listview/highlightranges/main.cpp
index cd4b76c..66ab780 100644
--- a/examples/declarative/modelviews/listview/highlightranges/main.cpp
+++ b/examples/declarative/modelviews/listview/highlightranges/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/listview/sections/main.cpp b/examples/declarative/modelviews/listview/sections/main.cpp
index 8bb1edf..960f00c 100644
--- a/examples/declarative/modelviews/listview/sections/main.cpp
+++ b/examples/declarative/modelviews/listview/sections/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/objectlistmodel/objectlistmodel.pro b/examples/declarative/modelviews/objectlistmodel/objectlistmodel.pro
index be38339..378d40e 100644
--- a/examples/declarative/modelviews/objectlistmodel/objectlistmodel.pro
+++ b/examples/declarative/modelviews/objectlistmodel/objectlistmodel.pro
@@ -29,6 +29,8 @@ symbian:TARGET.CAPABILITY += NetworkServices
 # Add dependency to Symbian components
 # CONFIG += qt-components
 
+QT += widgets
+
 # input
 SOURCES += main.cpp \
            dataobject.cpp
diff --git a/examples/declarative/modelviews/package/main.cpp b/examples/declarative/modelviews/package/main.cpp
index 2131955..5e96a41 100644
--- a/examples/declarative/modelviews/package/main.cpp
+++ b/examples/declarative/modelviews/package/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/modelviews/parallax/main.cpp b/examples/declarative/modelviews/parallax/main.cpp
index 5f95c60..6427bee 100644
--- a/examples/declarative/modelviews/parallax/main.cpp
+++ b/examples/declarative/modelviews/parallax/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/modelviews/pathview/main.cpp b/examples/declarative/modelviews/pathview/main.cpp
index 7b46685..7682d66 100644
--- a/examples/declarative/modelviews/pathview/main.cpp
+++ b/examples/declarative/modelviews/pathview/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/stringlistmodel/stringlistmodel.pro b/examples/declarative/modelviews/stringlistmodel/stringlistmodel.pro
index b6c7e22..685cb35 100644
--- a/examples/declarative/modelviews/stringlistmodel/stringlistmodel.pro
+++ b/examples/declarative/modelviews/stringlistmodel/stringlistmodel.pro
@@ -29,6 +29,8 @@ symbian:TARGET.CAPABILITY += NetworkServices
 # Add dependency to Symbian components
 # CONFIG += qt-components
 
+QT += widgets
+
 # The .cpp file which was generated for your project. Feel free to hack it.
 SOURCES += main.cpp
 
diff --git a/examples/declarative/modelviews/visualitemmodel/main.cpp b/examples/declarative/modelviews/visualitemmodel/main.cpp
index 6bcb474..26213e3 100644
--- a/examples/declarative/modelviews/visualitemmodel/main.cpp
+++ b/examples/declarative/modelviews/visualitemmodel/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/webview/alerts/main.cpp b/examples/declarative/modelviews/webview/alerts/main.cpp
index f8eb727..bf8770f 100644
--- a/examples/declarative/modelviews/webview/alerts/main.cpp
+++ b/examples/declarative/modelviews/webview/alerts/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/webview/autosize/main.cpp b/examples/declarative/modelviews/webview/autosize/main.cpp
index b5b7da3..98c7bfd 100644
--- a/examples/declarative/modelviews/webview/autosize/main.cpp
+++ b/examples/declarative/modelviews/webview/autosize/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/webview/googlemaps/main.cpp b/examples/declarative/modelviews/webview/googlemaps/main.cpp
index cc3a3ae..34c67e2 100644
--- a/examples/declarative/modelviews/webview/googlemaps/main.cpp
+++ b/examples/declarative/modelviews/webview/googlemaps/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/webview/inlinehtml/main.cpp b/examples/declarative/modelviews/webview/inlinehtml/main.cpp
index 35a06f3..e05231a 100644
--- a/examples/declarative/modelviews/webview/inlinehtml/main.cpp
+++ b/examples/declarative/modelviews/webview/inlinehtml/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/modelviews/webview/newwindows/main.cpp b/examples/declarative/modelviews/webview/newwindows/main.cpp
index 779cbf1..70ddd1f 100644
--- a/examples/declarative/modelviews/webview/newwindows/main.cpp
+++ b/examples/declarative/modelviews/webview/newwindows/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/positioners/main.cpp b/examples/declarative/positioners/main.cpp
index 474d0cb..f8fb55c 100644
--- a/examples/declarative/positioners/main.cpp
+++ b/examples/declarative/positioners/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/righttoleft/layoutdirection/main.cpp b/examples/declarative/righttoleft/layoutdirection/main.cpp
index 215a8d4..8ca3eae 100644
--- a/examples/declarative/righttoleft/layoutdirection/main.cpp
+++ b/examples/declarative/righttoleft/layoutdirection/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
diff --git a/examples/declarative/righttoleft/layoutmirroring/main.cpp b/examples/declarative/righttoleft/layoutmirroring/main.cpp
index 00ade6f..c9c0b83 100644
--- a/examples/declarative/righttoleft/layoutmirroring/main.cpp
+++ b/examples/declarative/righttoleft/layoutmirroring/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
diff --git a/examples/declarative/righttoleft/textalignment/main.cpp b/examples/declarative/righttoleft/textalignment/main.cpp
index c8a8683..ec6c1e0 100644
--- a/examples/declarative/righttoleft/textalignment/main.cpp
+++ b/examples/declarative/righttoleft/textalignment/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
diff --git a/examples/declarative/shadereffects/main.cpp b/examples/declarative/shadereffects/main.cpp
index 4e70e82..31caa9f 100644
--- a/examples/declarative/shadereffects/main.cpp
+++ b/examples/declarative/shadereffects/main.cpp
@@ -40,7 +40,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include <QtOpenGL>
 #include <QDeclarativeView>
 #include <QDeclarativeEngine>
diff --git a/examples/declarative/shadereffects/shadereffects.pro b/examples/declarative/shadereffects/shadereffects.pro
index 58e7ab7..9b56e72 100644
--- a/examples/declarative/shadereffects/shadereffects.pro
+++ b/examples/declarative/shadereffects/shadereffects.pro
@@ -29,7 +29,7 @@ symbian:TARGET.CAPABILITY += NetworkServices
 # Add dependency to Symbian components
 # CONFIG += qt-components
 
-QT += declarative opengl
+QT += quick1 opengl
 
 # The .cpp file which was generated for your project. Feel free to hack it.
 SOURCES += main.cpp
diff --git a/examples/declarative/sqllocalstorage/main.cpp b/examples/declarative/sqllocalstorage/main.cpp
index a4b6317..46691bf 100644
--- a/examples/declarative/sqllocalstorage/main.cpp
+++ b/examples/declarative/sqllocalstorage/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
diff --git a/examples/declarative/text/fonts/availableFonts/main.cpp b/examples/declarative/text/fonts/availableFonts/main.cpp
index 3b26dde..dfa42f5 100644
--- a/examples/declarative/text/fonts/availableFonts/main.cpp
+++ b/examples/declarative/text/fonts/availableFonts/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/text/fonts/banner/main.cpp b/examples/declarative/text/fonts/banner/main.cpp
index c693e99..7b49331 100644
--- a/examples/declarative/text/fonts/banner/main.cpp
+++ b/examples/declarative/text/fonts/banner/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/text/fonts/fonts/main.cpp b/examples/declarative/text/fonts/fonts/main.cpp
index ab7bd32..5f962a3 100644
--- a/examples/declarative/text/fonts/fonts/main.cpp
+++ b/examples/declarative/text/fonts/fonts/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/text/fonts/hello/main.cpp b/examples/declarative/text/fonts/hello/main.cpp
index fb2cee6..ecf62db 100644
--- a/examples/declarative/text/fonts/hello/main.cpp
+++ b/examples/declarative/text/fonts/hello/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/text/textselection/main.cpp b/examples/declarative/text/textselection/main.cpp
index 5a96999..1798e0c 100644
--- a/examples/declarative/text/textselection/main.cpp
+++ b/examples/declarative/text/textselection/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/threading/threadedlistmodel/main.cpp b/examples/declarative/threading/threadedlistmodel/main.cpp
index 1707c1a..1099789 100644
--- a/examples/declarative/threading/threadedlistmodel/main.cpp
+++ b/examples/declarative/threading/threadedlistmodel/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/threading/workerscript/main.cpp b/examples/declarative/threading/workerscript/main.cpp
index ea8b668..0111ef7 100644
--- a/examples/declarative/threading/workerscript/main.cpp
+++ b/examples/declarative/threading/workerscript/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/touchinteraction/gestures/experimental-gestures/main.cpp b/examples/declarative/touchinteraction/gestures/experimental-gestures/main.cpp
index 9a38a46..c25744a 100644
--- a/examples/declarative/touchinteraction/gestures/experimental-gestures/main.cpp
+++ b/examples/declarative/touchinteraction/gestures/experimental-gestures/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/touchinteraction/mousearea/mousearea-example/main.cpp b/examples/declarative/touchinteraction/mousearea/mousearea-example/main.cpp
index d7bb4a2..af2ad6d 100644
--- a/examples/declarative/touchinteraction/mousearea/mousearea-example/main.cpp
+++ b/examples/declarative/touchinteraction/mousearea/mousearea-example/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/touchinteraction/pincharea/main.cpp b/examples/declarative/touchinteraction/pincharea/main.cpp
index 676c6b3..5cb984e 100644
--- a/examples/declarative/touchinteraction/pincharea/main.cpp
+++ b/examples/declarative/touchinteraction/pincharea/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/toys/clocks/main.cpp b/examples/declarative/toys/clocks/main.cpp
index 1a56f89..c3df876 100644
--- a/examples/declarative/toys/clocks/main.cpp
+++ b/examples/declarative/toys/clocks/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/toys/corkboards/main.cpp b/examples/declarative/toys/corkboards/main.cpp
index 0ca8f8d..af0bdf0 100644
--- a/examples/declarative/toys/corkboards/main.cpp
+++ b/examples/declarative/toys/corkboards/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/toys/dynamicscene/main.cpp b/examples/declarative/toys/dynamicscene/main.cpp
index 9064219..226550e 100644
--- a/examples/declarative/toys/dynamicscene/main.cpp
+++ b/examples/declarative/toys/dynamicscene/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/toys/tic-tac-toe/main.cpp b/examples/declarative/toys/tic-tac-toe/main.cpp
index fef1486..fa4db31 100644
--- a/examples/declarative/toys/tic-tac-toe/main.cpp
+++ b/examples/declarative/toys/tic-tac-toe/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/toys/tvtennis/main.cpp b/examples/declarative/toys/tvtennis/main.cpp
index 330cd17..e6ccee3 100644
--- a/examples/declarative/toys/tvtennis/main.cpp
+++ b/examples/declarative/toys/tvtennis/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/tutorials/extending/chapter1-basics/chapter1-basics.pro b/examples/declarative/tutorials/extending/chapter1-basics/chapter1-basics.pro
index 0f04167..d75e7b2 100644
--- a/examples/declarative/tutorials/extending/chapter1-basics/chapter1-basics.pro
+++ b/examples/declarative/tutorials/extending/chapter1-basics/chapter1-basics.pro
@@ -1,4 +1,4 @@
-QT += declarative
+QT += widgets quick1
 
 HEADERS += piechart.h
 SOURCES += piechart.cpp \
diff --git a/examples/declarative/tutorials/extending/chapter2-methods/chapter2-methods.pro b/examples/declarative/tutorials/extending/chapter2-methods/chapter2-methods.pro
index 0f04167..d75e7b2 100644
--- a/examples/declarative/tutorials/extending/chapter2-methods/chapter2-methods.pro
+++ b/examples/declarative/tutorials/extending/chapter2-methods/chapter2-methods.pro
@@ -1,4 +1,4 @@
-QT += declarative
+QT += widgets quick1
 
 HEADERS += piechart.h
 SOURCES += piechart.cpp \
diff --git a/examples/declarative/tutorials/extending/chapter3-bindings/chapter3-bindings.pro b/examples/declarative/tutorials/extending/chapter3-bindings/chapter3-bindings.pro
index 0f04167..d75e7b2 100644
--- a/examples/declarative/tutorials/extending/chapter3-bindings/chapter3-bindings.pro
+++ b/examples/declarative/tutorials/extending/chapter3-bindings/chapter3-bindings.pro
@@ -1,4 +1,4 @@
-QT += declarative
+QT += widgets quick1
 
 HEADERS += piechart.h
 SOURCES += piechart.cpp \
diff --git a/examples/declarative/tutorials/extending/chapter4-customPropertyTypes/chapter4-customPropertyTypes.pro b/examples/declarative/tutorials/extending/chapter4-customPropertyTypes/chapter4-customPropertyTypes.pro
index c3f5402..535f8a7 100644
--- a/examples/declarative/tutorials/extending/chapter4-customPropertyTypes/chapter4-customPropertyTypes.pro
+++ b/examples/declarative/tutorials/extending/chapter4-customPropertyTypes/chapter4-customPropertyTypes.pro
@@ -1,4 +1,4 @@
-QT += declarative
+QT += widgets quick1
 
 HEADERS += piechart.h \
            pieslice.h 
diff --git a/examples/declarative/tutorials/extending/chapter5-listproperties/chapter5-listproperties.pro b/examples/declarative/tutorials/extending/chapter5-listproperties/chapter5-listproperties.pro
index c3f5402..535f8a7 100644
--- a/examples/declarative/tutorials/extending/chapter5-listproperties/chapter5-listproperties.pro
+++ b/examples/declarative/tutorials/extending/chapter5-listproperties/chapter5-listproperties.pro
@@ -1,4 +1,4 @@
-QT += declarative
+QT += widgets quick1
 
 HEADERS += piechart.h \
            pieslice.h 
diff --git a/examples/declarative/tutorials/extending/chapter6-plugins/chapter6-plugins.pro b/examples/declarative/tutorials/extending/chapter6-plugins/chapter6-plugins.pro
index e16a1f2..2d7d948 100644
--- a/examples/declarative/tutorials/extending/chapter6-plugins/chapter6-plugins.pro
+++ b/examples/declarative/tutorials/extending/chapter6-plugins/chapter6-plugins.pro
@@ -1,6 +1,6 @@
 TEMPLATE = lib
 CONFIG += qt plugin
-QT += declarative
+QT += quick1
 
 DESTDIR = lib
 OBJECTS_DIR = tmp
diff --git a/examples/declarative/ui-components/dialcontrol/main.cpp b/examples/declarative/ui-components/dialcontrol/main.cpp
index 84c8b27..f3c9cd1 100644
--- a/examples/declarative/ui-components/dialcontrol/main.cpp
+++ b/examples/declarative/ui-components/dialcontrol/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/ui-components/flipable/main.cpp b/examples/declarative/ui-components/flipable/main.cpp
index 50855db..466306e 100644
--- a/examples/declarative/ui-components/flipable/main.cpp
+++ b/examples/declarative/ui-components/flipable/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/ui-components/main/main.cpp b/examples/declarative/ui-components/main/main.cpp
index 925abc1..9091d1d 100644
--- a/examples/declarative/ui-components/main/main.cpp
+++ b/examples/declarative/ui-components/main/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/ui-components/progressbar/main.cpp b/examples/declarative/ui-components/progressbar/main.cpp
index 97b2035..dddec95 100644
--- a/examples/declarative/ui-components/progressbar/main.cpp
+++ b/examples/declarative/ui-components/progressbar/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/ui-components/scrollbar/main.cpp b/examples/declarative/ui-components/scrollbar/main.cpp
index 00ecf44..f611a19 100644
--- a/examples/declarative/ui-components/scrollbar/main.cpp
+++ b/examples/declarative/ui-components/scrollbar/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/ui-components/searchbox/main.cpp b/examples/declarative/ui-components/searchbox/main.cpp
index 84680ca..bce0043 100644
--- a/examples/declarative/ui-components/searchbox/main.cpp
+++ b/examples/declarative/ui-components/searchbox/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/ui-components/slideswitch/main.cpp b/examples/declarative/ui-components/slideswitch/main.cpp
index 6def7fc..35e8f5e 100644
--- a/examples/declarative/ui-components/slideswitch/main.cpp
+++ b/examples/declarative/ui-components/slideswitch/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/declarative/ui-components/spinner/main.cpp b/examples/declarative/ui-components/spinner/main.cpp
index 3758c4c..3f45f34 100644
--- a/examples/declarative/ui-components/spinner/main.cpp
+++ b/examples/declarative/ui-components/spinner/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/ui-components/tabwidget/main.cpp b/examples/declarative/ui-components/tabwidget/main.cpp
index 9e4ab92..87b5b8e 100644
--- a/examples/declarative/ui-components/tabwidget/main.cpp
+++ b/examples/declarative/ui-components/tabwidget/main.cpp
@@ -39,7 +39,7 @@
 ****************************************************************************/
 
 #include "qmlapplicationviewer.h"
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 Q_DECL_EXPORT int main(int argc, char *argv[])
 {
diff --git a/examples/declarative/xml/xmlhttprequest-example/main.cpp b/examples/declarative/xml/xmlhttprequest-example/main.cpp
index 82e6a3b..0c0bce5 100644
--- a/examples/declarative/xml/xmlhttprequest-example/main.cpp
+++ b/examples/declarative/xml/xmlhttprequest-example/main.cpp
@@ -38,7 +38,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include "qmlapplicationviewer.h"
 
 int main(int argc, char *argv[])
diff --git a/examples/examples.pro b/examples/examples.pro
new file mode 100644
index 0000000..03c4a21
--- /dev/null
+++ b/examples/examples.pro
@@ -0,0 +1,2 @@
+TEMPLATE = subdirs
+SUBDIRS += declarative
diff --git a/examples/helper/qmlapplicationviewer/qmlapplicationviewer.cpp b/examples/helper/qmlapplicationviewer/qmlapplicationviewer.cpp
index 570f68f..d8a9336 100644
--- a/examples/helper/qmlapplicationviewer/qmlapplicationviewer.cpp
+++ b/examples/helper/qmlapplicationviewer/qmlapplicationviewer.cpp
@@ -42,10 +42,10 @@
 
 #include <QtCore/QDir>
 #include <QtCore/QFileInfo>
-#include <QtDeclarative/QDeclarativeComponent>
-#include <QtDeclarative/QDeclarativeEngine>
-#include <QtDeclarative/QDeclarativeContext>
-#include <QtGui/QApplication>
+#include <QtQuick1/QDeclarativeComponent>
+#include <QtQuick1/QDeclarativeEngine>
+#include <QtQuick1/QDeclarativeContext>
+#include <QtWidgets/QApplication>
 
 #include <qplatformdefs.h> // MEEGO_EDITION_HARMATTAN
 
@@ -164,45 +164,8 @@ void QmlApplicationViewer::addImportPath(const QString &path)
 
 void QmlApplicationViewer::setOrientation(ScreenOrientation orientation)
 {
-#if defined(Q_OS_SYMBIAN)
-    // If the version of Qt on the device is < 4.7.2, that attribute won't work
-    if (orientation != ScreenOrientationAuto) {
-        const QStringList v = QString::fromAscii(qVersion()).split(QLatin1Char('.'));
-        if (v.count() == 3 && (v.at(0).toInt() << 16 | v.at(1).toInt() << 8 | v.at(2).toInt()) < 0x040702) {
-            qWarning("Screen orientation locking only supported with Qt 4.7.2 and above");
-            return;
-        }
-    }
-#endif // Q_OS_SYMBIAN
-
-    Qt::WidgetAttribute attribute;
-    switch (orientation) {
-#if QT_VERSION < 0x040702
-    // Qt < 4.7.2 does not yet have the Qt::WA_*Orientation attributes
-    case ScreenOrientationLockPortrait:
-        attribute = static_cast<Qt::WidgetAttribute>(128);
-        break;
-    case ScreenOrientationLockLandscape:
-        attribute = static_cast<Qt::WidgetAttribute>(129);
-        break;
-    default:
-    case ScreenOrientationAuto:
-        attribute = static_cast<Qt::WidgetAttribute>(130);
-        break;
-#else // QT_VERSION < 0x040702
-    case ScreenOrientationLockPortrait:
-        attribute = Qt::WA_LockPortraitOrientation;
-        break;
-    case ScreenOrientationLockLandscape:
-        attribute = Qt::WA_LockLandscapeOrientation;
-        break;
-    default:
-    case ScreenOrientationAuto:
-        attribute = Qt::WA_AutoOrientation;
-        break;
-#endif // QT_VERSION < 0x040702
-    };
-    setAttribute(attribute, true);
+    // TODO: Needs a Qt5 implmentation
+    Q_UNUSED(orientation)
 }
 
 void QmlApplicationViewer::showExpanded()
diff --git a/examples/helper/qmlapplicationviewer/qmlapplicationviewer.h b/examples/helper/qmlapplicationviewer/qmlapplicationviewer.h
index 85c02ab..d8ef27e 100644
--- a/examples/helper/qmlapplicationviewer/qmlapplicationviewer.h
+++ b/examples/helper/qmlapplicationviewer/qmlapplicationviewer.h
@@ -41,7 +41,7 @@
 #ifndef QMLAPPLICATIONVIEWER_H
 #define QMLAPPLICATIONVIEWER_H
 
-#include <QtDeclarative/QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 
 class QmlApplicationViewer : public QDeclarativeView
 {
diff --git a/examples/helper/qmlapplicationviewer/qmlapplicationviewer.pri b/examples/helper/qmlapplicationviewer/qmlapplicationviewer.pri
index 6809b64..2feb9e0 100644
--- a/examples/helper/qmlapplicationviewer/qmlapplicationviewer.pri
+++ b/examples/helper/qmlapplicationviewer/qmlapplicationviewer.pri
@@ -4,7 +4,7 @@
 # It is recommended not to modify this file, since newer versions of Qt Creator
 # may offer an updated version of it.
 
-QT += declarative
+QT += quick1
 
 SOURCES += $$PWD/qmlapplicationviewer.cpp
 HEADERS += $$PWD/qmlapplicationviewer.h
diff --git a/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.cpp b/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.cpp
index 7d1c7cb..154b8b9 100644
--- a/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.cpp
+++ b/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.cpp
@@ -41,7 +41,7 @@
 #include "dialogPlugin.h"
 #include "directory.h"
 #include "file.h"
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarative.h>
 
 void DialogPlugin::registerTypes(const char *uri)
 {
diff --git a/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.h b/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.h
index 110908f..7b62156 100644
--- a/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.h
+++ b/examples/tutorials/gettingStarted/gsQml/filedialog/dialogPlugin.h
@@ -41,7 +41,7 @@
 #ifndef DIALOGPLUGIN_H
 #define DIALOGPLUGIN_H
 
-#include <QtDeclarative/QDeclarativeExtensionPlugin>
+#include <QtQuick1/QDeclarativeExtensionPlugin>
 
 class DialogPlugin : public QDeclarativeExtensionPlugin
 {
diff --git a/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.cpp b/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.cpp
index 6d438f0..90ffb1a 100644
--- a/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.cpp
+++ b/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.cpp
@@ -41,7 +41,7 @@
 #include "dialogPlugin.h"
 #include "directory.h"
 #include "file.h"
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarative.h>
 
 void DialogPlugin::registerTypes(const char *uri){
     
diff --git a/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.h b/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.h
index da47e2a..c8e1782 100644
--- a/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.h
+++ b/examples/tutorials/gettingStarted/gsQml/parts/part5/filedialog/dialogPlugin.h
@@ -41,7 +41,7 @@
 #ifndef DIALOGPLUGIN_H
 #define DIALOGPLUGIN_H
 
-#include <QtDeclarative/QDeclarativeExtensionPlugin>
+#include <QtQuick1/QDeclarativeExtensionPlugin>
 
 class DialogPlugin : public QDeclarativeExtensionPlugin
 {
diff --git a/mkspecs/features/quick1_debug.prf b/mkspecs/features/quick1_debug.prf
new file mode 100644
index 0000000..4ffdfa7
--- /dev/null
+++ b/mkspecs/features/quick1_debug.prf
@@ -0,0 +1 @@
+contains(QT, qtquick1):DEFINES += QT_DECLARATIVE_DEBUG
diff --git a/modules/qt_quick1.pri b/modules/qt_quick1.pri
new file mode 100644
index 0000000..49bf4e2
--- /dev/null
+++ b/modules/qt_quick1.pri
@@ -0,0 +1,17 @@
+QT.quick1.VERSION = 5.0.0
+QT.quick1.MAJOR_VERSION = 5
+QT.quick1.MINOR_VERSION = 0
+QT.quick1.PATCH_VERSION = 0
+
+QT.quick1.name = QtQuick1
+QT.quick1.bins = $$QT_MODULE_BIN_BASE
+QT.quick1.includes = $$QT_MODULE_INCLUDE_BASE $$QT_MODULE_INCLUDE_BASE/QtQuick1
+QT.quick1.private_includes = $$QT_MODULE_INCLUDE_BASE/QtQuick1/$$QT.quick1.VERSION
+QT.quick1.sources = $$QT_MODULE_BASE/src/declarative
+QT.quick1.libs = $$QT_MODULE_LIB_BASE
+QT.quick1.plugins = $$QT_MODULE_PLUGIN_BASE
+QT.quick1.imports = $$QT_MODULE_IMPORT_BASE
+QT.quick1.depends = gui network script xmlpatterns
+QT.quick1.DEFINES = QT_QTQUICK1_LIB
+
+QT_CONFIG += quick1
diff --git a/qtquick1.pro b/qtquick1.pro
new file mode 100644
index 0000000..1d82d98
--- /dev/null
+++ b/qtquick1.pro
@@ -0,0 +1,25 @@
+TEMPLATE = subdirs
+CONFIG += ordered
+
+module_qtquick1_src.subdir = src
+module_qtquick1_src.target = module-qtquick1-src
+
+module_qtquick1_tools.subdir = tools
+module_qtquick1_tools.target = module-qtquick1-tools
+module_qtquick1_tools.depends = module_qtquick1_src
+
+module_qtquick1_demos.subdir = demos
+module_qtquick1_demos.target = module-qtquick1-demos
+module_qtquick1_demos.depends = module_qtquick1_src
+
+module_qtquick1_examples.subdir = examples
+module_qtquick1_examples.target = module-qtquick1-examples
+module_qtquick1_examples.depends = module_qtquick1_src
+!contains(QT_BUILD_PARTS,examples) {
+    module_qtquick1_examples.CONFIG = no_default_target no_default_install
+}
+
+SUBDIRS += module_qtquick1_src \
+           module_qtquick1_tools \
+           module_qtquick1_demos \
+           module_qtquick1_examples \
diff --git a/src/declarative/debugger/qdeclarativedebugserver.cpp b/src/declarative/debugger/qdeclarativedebugserver.cpp
index c664f96..9de9544 100644
--- a/src/declarative/debugger/qdeclarativedebugserver.cpp
+++ b/src/declarative/debugger/qdeclarativedebugserver.cpp
@@ -116,7 +116,7 @@ void QDeclarativeDebugServerPrivate::advertisePlugins()
         QDataStream out(&message, QIODevice::WriteOnly);
         out << QString(QLatin1String("QDeclarativeDebugClient")) << 1 << plugins.keys();
     }
-    connection->send(message);
+    connection->send(QList<QByteArray>() << message);
 }
 
 QDeclarativeDebugServerConnection *QDeclarativeDebugServerPrivate::loadConnectionPlugin(
@@ -268,7 +268,7 @@ void QDeclarativeDebugServer::receiveMessage(const QByteArray &message)
             QDataStream out(&helloAnswer, QIODevice::WriteOnly);
             out << QString(QLatin1String("QDeclarativeDebugClient")) << 0 << protocolVersion << d->plugins.keys();
         }
-        d->connection->send(helloAnswer);
+        d->connection->send(QList<QByteArray>() << helloAnswer);
 
         d->gotHello = true;
 
@@ -399,7 +399,7 @@ void QDeclarativeDebugServer::sendMessage(QDeclarativeDebugService *service,
         QDataStream out(&msg, QIODevice::WriteOnly);
         out << service->name() << message;
     }
-    d->connection->send(msg);
+    d->connection->send(QList<QByteArray>() << msg);
 }
 
 bool QDeclarativeDebugServer::waitForMessage(QDeclarativeDebugService *service)
diff --git a/src/declarative/debugger/qdeclarativedebugserverconnection_p.h b/src/declarative/debugger/qdeclarativedebugserverconnection_p.h
index 16fa798..1f237d2 100644
--- a/src/declarative/debugger/qdeclarativedebugserverconnection_p.h
+++ b/src/declarative/debugger/qdeclarativedebugserverconnection_p.h
@@ -42,7 +42,18 @@
 #ifndef QDECLARATIVEDEBUGSERVERCONNECTION_H
 #define QDECLARATIVEDEBUGSERVERCONNECTION_H
 
-#include <QtDeclarative/private/qdeclarativeglobal_p.h>
+#include <private/qdeclarativeglobal_p.h>
+
+//
+//  W A R N I N G
+//  -------------
+//
+// This file is not part of the Qt API.  It exists purely as an
+// implementation detail.  This header file may change from version to
+// version without notice, or even be removed.
+//
+// We mean it.
+//
 
 QT_BEGIN_HEADER
 
@@ -60,7 +71,7 @@ public:
     virtual void setServer(QDeclarativeDebugServer *server) = 0;
     virtual void setPort(int port, bool bock) = 0;
     virtual bool isConnected() const = 0;
-    virtual void send(const QByteArray &message) = 0;
+    virtual void send(const QList<QByteArray> &messages) = 0;
     virtual void disconnect() = 0;
     virtual bool waitForMessage() = 0;
 };
diff --git a/src/declarative/debugger/qdeclarativeinspectorinterface_p.h b/src/declarative/debugger/qdeclarativeinspectorinterface_p.h
index bd7cd95..0ee2f07 100644
--- a/src/declarative/debugger/qdeclarativeinspectorinterface_p.h
+++ b/src/declarative/debugger/qdeclarativeinspectorinterface_p.h
@@ -42,7 +42,7 @@
 #ifndef QDECLARATIVEOBSERVERINTERFACE_H
 #define QDECLARATIVEOBSERVERINTERFACE_H
 
-#include <QtDeclarative/private/qdeclarativeglobal_p.h>
+#include <QtQuick1/private/qdeclarativeglobal_p.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/declarative/debugger/qdeclarativeinspectorservice.cpp b/src/declarative/debugger/qdeclarativeinspectorservice.cpp
index b651b25..cfb6dcb 100644
--- a/src/declarative/debugger/qdeclarativeinspectorservice.cpp
+++ b/src/declarative/debugger/qdeclarativeinspectorservice.cpp
@@ -47,7 +47,7 @@
 #include <QtCore/QDir>
 #include <QtCore/QPluginLoader>
 
-#include <QtDeclarative/QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/debugger/qjsdebugservice.cpp b/src/declarative/debugger/qjsdebugservice.cpp
index 686710d..062eda6 100644
--- a/src/declarative/debugger/qjsdebugservice.cpp
+++ b/src/declarative/debugger/qjsdebugservice.cpp
@@ -45,7 +45,7 @@
 #include <QtCore/qdatastream.h>
 #include <QtCore/qdebug.h>
 #include <QtCore/qstringlist.h>
-#include <QtDeclarative/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeengine.h>
 
 Q_GLOBAL_STATIC(QJSDebugService, serviceInstance)
 
diff --git a/src/declarative/declarative.pro b/src/declarative/declarative.pro
index 055e4b9..2232ac3 100644
--- a/src/declarative/declarative.pro
+++ b/src/declarative/declarative.pro
@@ -1,8 +1,19 @@
-TARGET     = QtDeclarative
+load(qt_module)
+
+TARGET     = QtQuick1
 QPRO_PWD   = $$PWD
-QT         = core gui script network
+
+QT         += core core-private gui gui-private widgets widgets-private script script-private network xmlpatterns
 contains(QT_CONFIG, svg): QT += svg
+
+CONFIG += module
+MODULE_PRI = ../../modules/qt_quick1.pri
+
+MODULE=quick1
+load(qt_module_config)
+
 DEFINES   += QT_BUILD_DECLARATIVE_LIB QT_NO_URL_CAST_FROM_STRING
+
 win32-msvc*|win32-icc:QMAKE_LFLAGS += /BASE:0x66000000
 solaris-cc*:QMAKE_CXXFLAGS_RELEASE -= -O2
 
@@ -13,29 +24,12 @@ exists("qdeclarative_enable_gcov") {
     LIBS += -lgcov
 }
 
-include(../qbase.pri)
-
-#INCLUDEPATH -= $$QMAKE_INCDIR_QT/$$TARGET
-#DESTDIR=.
-
 #modules
+include(qml/qml.pri)
 include(util/util.pri)
 include(graphicsitems/graphicsitems.pri)
-include(qml/qml.pri)
 include(debugger/debugger.pri)
 
-symbian: {
-    TARGET.UID3=0x2001E623
-    LIBS += -lefsrv -lhal
-
-    contains(QT_CONFIG, freetype) {
-        DEFINES += QT_NO_FONTCONFIG
-        INCLUDEPATH += \
-            ../3rdparty/freetype/src \
-            ../3rdparty/freetype/include
-    }
-}
-
 linux-g++-maemo:DEFINES += QDECLARATIVEVIEW_NOBACKGROUND
 
 DEFINES += QT_NO_OPENTYPE
diff --git a/src/declarative/graphicsitems/qdeclarativeborderimage.cpp b/src/declarative/graphicsitems/qdeclarativeborderimage.cpp
index 5babbb2..f01aeec 100644
--- a/src/declarative/graphicsitems/qdeclarativeborderimage.cpp
+++ b/src/declarative/graphicsitems/qdeclarativeborderimage.cpp
@@ -48,6 +48,7 @@
 #include <QNetworkRequest>
 #include <QNetworkReply>
 #include <QFile>
+#include <QtWidgets/qdrawutil.h>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/graphicsitems/qdeclarativeflipable.cpp b/src/declarative/graphicsitems/qdeclarativeflipable.cpp
index 1156960..0c300a3 100644
--- a/src/declarative/graphicsitems/qdeclarativeflipable.cpp
+++ b/src/declarative/graphicsitems/qdeclarativeflipable.cpp
@@ -46,7 +46,7 @@
 
 #include <qdeclarativeinfo.h>
 
-#include <QtGui/qgraphicstransform.h>
+#include <QtWidgets/qgraphicstransform.h>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/graphicsitems/qdeclarativefocuspanel.cpp b/src/declarative/graphicsitems/qdeclarativefocuspanel.cpp
index 489ee90..97eea74 100644
--- a/src/declarative/graphicsitems/qdeclarativefocuspanel.cpp
+++ b/src/declarative/graphicsitems/qdeclarativefocuspanel.cpp
@@ -43,7 +43,7 @@
 
 #include "private/qdeclarativeitem_p.h"
 
-#include <QtGui/qgraphicsscene.h>
+#include <QtWidgets/qgraphicsscene.h>
 #include <QEvent>
 
 QT_BEGIN_NAMESPACE
diff --git a/src/declarative/graphicsitems/qdeclarativegraphicswidget_p.h b/src/declarative/graphicsitems/qdeclarativegraphicswidget_p.h
index 93242ac..079c8b6 100644
--- a/src/declarative/graphicsitems/qdeclarativegraphicswidget_p.h
+++ b/src/declarative/graphicsitems/qdeclarativegraphicswidget_p.h
@@ -43,7 +43,7 @@
 #define QDECLARATIVEGRAPHICSWIDGET_P_H
 
 #include <QObject>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/declarative/graphicsitems/qdeclarativegridview.cpp b/src/declarative/graphicsitems/qdeclarativegridview.cpp
index 1d9348c..d1c40a9 100644
--- a/src/declarative/graphicsitems/qdeclarativegridview.cpp
+++ b/src/declarative/graphicsitems/qdeclarativegridview.cpp
@@ -45,7 +45,7 @@
 #include "private/qdeclarativeflickable_p_p.h"
 
 #include "private/qdeclarativesmoothedanimation_p_p.h"
-#include <qdeclarativeguard_p.h>
+#include <private/qdeclarativeguard_p.h>
 
 #include <qlistmodelinterface_p.h>
 #include <QKeyEvent>
diff --git a/src/declarative/graphicsitems/qdeclarativeitem.cpp b/src/declarative/graphicsitems/qdeclarativeitem.cpp
index fa6e8e1..1c370af 100644
--- a/src/declarative/graphicsitems/qdeclarativeitem.cpp
+++ b/src/declarative/graphicsitems/qdeclarativeitem.cpp
@@ -44,7 +44,7 @@
 #include "private/qdeclarativeevents_p_p.h"
 #include <private/qdeclarativeengine_p.h>
 #include <private/qgraphicsitem_p.h>
-#include <QtDeclarative/private/qdeclarativeitem_p.h>
+#include <QtQuick1/private/qdeclarativeitem_p.h>
 
 #include <qdeclarativeengine.h>
 #include <qdeclarativeopenmetaobject_p.h>
@@ -60,7 +60,7 @@
 #include <QGraphicsSceneMouseEvent>
 #include <QtCore/qnumeric.h>
 #include <QtScript/qscriptengine.h>
-#include <QtGui/qgraphicstransform.h>
+#include <QtWidgets/qgraphicstransform.h>
 #include <qlistmodelinterface_p.h>
 
 #include <float.h>
diff --git a/src/declarative/graphicsitems/qdeclarativeitem.h b/src/declarative/graphicsitems/qdeclarativeitem.h
index ce8c945..b57c38e 100644
--- a/src/declarative/graphicsitems/qdeclarativeitem.h
+++ b/src/declarative/graphicsitems/qdeclarativeitem.h
@@ -42,15 +42,15 @@
 #ifndef QDECLARATIVEITEM_H
 #define QDECLARATIVEITEM_H
 
-#include <QtDeclarative/qdeclarative.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarative.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 
 #include <QtCore/QObject>
 #include <QtCore/QList>
-#include <QtGui/qgraphicsitem.h>
-#include <QtGui/qgraphicstransform.h>
+#include <QtWidgets/qgraphicsitem.h>
+#include <QtWidgets/qgraphicstransform.h>
 #include <QtGui/qfont.h>
-#include <QtGui/qaction.h>
+#include <QtWidgets/qaction.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/declarative/graphicsitems/qdeclarativeitemsmodule.cpp b/src/declarative/graphicsitems/qdeclarativeitemsmodule.cpp
index e9af7e7..e440d7e 100644
--- a/src/declarative/graphicsitems/qdeclarativeitemsmodule.cpp
+++ b/src/declarative/graphicsitems/qdeclarativeitemsmodule.cpp
@@ -41,9 +41,9 @@
 
 #include "private/qdeclarativeitemsmodule_p.h"
 
-#include <QtGui/qaction.h>
+#include <QtWidgets/qaction.h>
 #include <QtGui/qvalidator.h>
-#include <QtGui/qgraphicseffect.h>
+#include <QtWidgets/qgraphicseffect.h>
 
 #include "private/qdeclarativeevents_p_p.h"
 #include "private/qdeclarativescalegrid_p_p.h"
diff --git a/src/declarative/graphicsitems/qdeclarativelistview.cpp b/src/declarative/graphicsitems/qdeclarativelistview.cpp
index 331dc35..a158075 100644
--- a/src/declarative/graphicsitems/qdeclarativelistview.cpp
+++ b/src/declarative/graphicsitems/qdeclarativelistview.cpp
@@ -47,7 +47,7 @@
 #include "private/qdeclarativesmoothedanimation_p_p.h"
 #include <qdeclarativeexpression.h>
 #include <qdeclarativeengine.h>
-#include <qdeclarativeguard_p.h>
+#include <private/qdeclarativeguard_p.h>
 #include <qdeclarativeinfo.h>
 
 #include <qlistmodelinterface_p.h>
diff --git a/src/declarative/graphicsitems/qdeclarativeloader.cpp b/src/declarative/graphicsitems/qdeclarativeloader.cpp
index f55cc9b..8fee862 100644
--- a/src/declarative/graphicsitems/qdeclarativeloader.cpp
+++ b/src/declarative/graphicsitems/qdeclarativeloader.cpp
@@ -42,8 +42,8 @@
 #include "private/qdeclarativeloader_p_p.h"
 
 #include <qdeclarativeinfo.h>
-#include <qdeclarativeengine_p.h>
-#include <qdeclarativeglobal_p.h>
+#include <private/qdeclarativeengine_p.h>
+#include <private/qdeclarativeglobal_p.h>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/graphicsitems/qdeclarativepathview_p_p.h b/src/declarative/graphicsitems/qdeclarativepathview_p_p.h
index b226f79..2faabbf 100644
--- a/src/declarative/graphicsitems/qdeclarativepathview_p_p.h
+++ b/src/declarative/graphicsitems/qdeclarativepathview_p_p.h
@@ -60,7 +60,7 @@
 
 #include <qdeclarative.h>
 #include <qdeclarativeanimation_p_p.h>
-#include <qdeclarativeguard_p.h>
+#include <private/qdeclarativeguard_p.h>
 
 #include <qdatetime.h>
 
diff --git a/src/declarative/graphicsitems/qdeclarativerectangle.cpp b/src/declarative/graphicsitems/qdeclarativerectangle.cpp
index e4389ec..dbbf238 100644
--- a/src/declarative/graphicsitems/qdeclarativerectangle.cpp
+++ b/src/declarative/graphicsitems/qdeclarativerectangle.cpp
@@ -45,6 +45,7 @@
 #include <QPainter>
 #include <QStringBuilder>
 #include <QtCore/qmath.h>
+#include <QtWidgets/qdrawutil.h>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/graphicsitems/qdeclarativetextinput.cpp b/src/declarative/graphicsitems/qdeclarativetextinput.cpp
index 18db4fd..2d519be 100644
--- a/src/declarative/graphicsitems/qdeclarativetextinput.cpp
+++ b/src/declarative/graphicsitems/qdeclarativetextinput.cpp
@@ -893,7 +893,7 @@ void QDeclarativeTextInput::setEchoMode(QDeclarativeTextInput::EchoMode echo)
     Q_D(QDeclarativeTextInput);
     if (echoMode() == echo)
         return;
-    d->control->setEchoMode((uint)echo);
+    d->control->setEchoMode(QLineControl::EchoMode(echo));
     d->updateInputMethodHints();
     q_textChanged();
     emit echoModeChanged(echoMode());
diff --git a/src/declarative/graphicsitems/qdeclarativevisualitemmodel.cpp b/src/declarative/graphicsitems/qdeclarativevisualitemmodel.cpp
index 3f71e57..cd40b68 100644
--- a/src/declarative/graphicsitems/qdeclarativevisualitemmodel.cpp
+++ b/src/declarative/graphicsitems/qdeclarativevisualitemmodel.cpp
@@ -44,23 +44,23 @@
 #include "qdeclarativeitem.h"
 
 #include <qdeclarativecontext.h>
-#include <qdeclarativecontext_p.h>
+#include <private/qdeclarativecontext_p.h>
 #include <qdeclarativeengine.h>
 #include <qdeclarativeexpression.h>
 #include <qdeclarativepackage_p.h>
 #include <qdeclarativeopenmetaobject_p.h>
 #include <qdeclarativelistaccessor_p.h>
 #include <qdeclarativeinfo.h>
-#include <qdeclarativedata_p.h>
-#include <qdeclarativepropertycache_p.h>
-#include <qdeclarativeguard_p.h>
-#include <qdeclarativeglobal_p.h>
+#include <private/qdeclarativedata_p.h>
+#include <private/qdeclarativepropertycache_p.h>
+#include <private/qdeclarativeguard_p.h>
+#include <private/qdeclarativeglobal_p.h>
 
 #include <qgraphicsscene.h>
 #include <qlistmodelinterface_p.h>
 #include <qhash.h>
 #include <qlist.h>
-#include <qmetaobjectbuilder_p.h>
+#include <private/qmetaobjectbuilder_p.h>
 #include <QtCore/qdebug.h>
 
 #include <private/qobject_p.h>
@@ -288,8 +288,8 @@ public:
                 for (int ii = 0; ii < m_roles.count(); ++ii)
                     m_roleNames.insert(m_listModelInterface->toString(m_roles.at(ii)).toUtf8(), m_roles.at(ii));
             } else if (m_abstractItemModel) {
-                for (QHash<int,QByteArray>::const_iterator it = m_abstractItemModel->roleNames().begin();
-                        it != m_abstractItemModel->roleNames().end(); ++it) {
+                for (QHash<int,QByteArray>::const_iterator it = m_abstractItemModel->roleNames().constBegin();
+                        it != m_abstractItemModel->roleNames().constEnd(); ++it) {
                     m_roles.append(it.key());
                     m_roleNames.insert(*it, it.key());
                 }
@@ -316,8 +316,8 @@ public:
         if (!m_metaDataCreated) {
             ensureRoles();
             if (m_roleNames.count()) {
-                QHash<QByteArray, int>::const_iterator it = m_roleNames.begin();
-                while (it != m_roleNames.end()) {
+                QHash<QByteArray, int>::const_iterator it = m_roleNames.constBegin();
+                while (it != m_roleNames.constEnd()) {
                     int propId = m_delegateDataType->createProperty(it.key()) - m_delegateDataType->propertyOffset();
                     m_roleToPropId.insert(*it, propId);
                     ++it;
@@ -349,7 +349,7 @@ public:
         QObject *item(int index) {
             QObject *item = 0;
             QHash<int, ObjectRef>::const_iterator it = find(index);
-            if (it != end())
+            if (it != constEnd())
                 item = (*it).obj;
             return item;
         }
@@ -458,7 +458,7 @@ int QDeclarativeVisualDataModelData::propForRole(int id) const
 {
     QDeclarativeVisualDataModelPrivate *model = QDeclarativeVisualDataModelPrivate::get(m_model);
     QHash<int,int>::const_iterator it = model->m_roleToPropId.find(id);
-    if (it != model->m_roleToPropId.end())
+    if (it != model->m_roleToPropId.constEnd())
         return *it;
 
     return -1;
@@ -515,7 +515,7 @@ QVariant QDeclarativeVisualDataModelDataMetaObject::initialValue(int propId)
     } else if (model->m_listModelInterface) {
         model->ensureRoles();
         QHash<QByteArray,int>::const_iterator it = model->m_roleNames.find(propName);
-        if (it != model->m_roleNames.end()) {
+        if (it != model->m_roleNames.constEnd()) {
             QVariant value = model->m_listModelInterface->data(data->m_index, *it);
             return value;
         } else if (model->m_roles.count() == 1 && propName == "modelData") {
@@ -530,7 +530,7 @@ QVariant QDeclarativeVisualDataModelDataMetaObject::initialValue(int propId)
             return model->m_abstractItemModel->hasChildren(index);
         } else {
             QHash<QByteArray,int>::const_iterator it = model->m_roleNames.find(propName);
-            if (it != model->m_roleNames.end()) {
+            if (it != model->m_roleNames.constEnd()) {
                 return model->m_abstractItemModel->data(index, *it);
             } else if (model->m_roles.count() == 1 && propName == "modelData") {
                 //for compatibility with other lists, assign modelData if there is only a single role
@@ -1203,8 +1203,8 @@ void QDeclarativeVisualDataModel::_q_itemsChanged(int index, int count,
         }
     }
 
-    for (QHash<int,QDeclarativeVisualDataModelPrivate::ObjectRef>::ConstIterator iter = d->m_cache.begin();
-        iter != d->m_cache.end(); ++iter) {
+    for (QHash<int,QDeclarativeVisualDataModelPrivate::ObjectRef>::ConstIterator iter = d->m_cache.constBegin();
+        iter != d->m_cache.constEnd(); ++iter) {
         const int idx = iter.key();
 
         if (idx >= index && idx < index+count) {
diff --git a/src/declarative/qml/parser/qdeclarativejsparser.cpp b/src/declarative/qml/parser/qdeclarativejsparser.cpp
index da2dd7e..0dfc28e 100644
--- a/src/declarative/qml/parser/qdeclarativejsparser.cpp
+++ b/src/declarative/qml/parser/qdeclarativejsparser.cpp
@@ -40,7 +40,7 @@
 ****************************************************************************/
 
 #include <QtCore/QtDebug>
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 #include <string.h>
 
diff --git a/src/declarative/qml/qdeclarative.h b/src/declarative/qml/qdeclarative.h
index f0893b2..b4fba4f 100644
--- a/src/declarative/qml/qdeclarative.h
+++ b/src/declarative/qml/qdeclarative.h
@@ -42,11 +42,11 @@
 #ifndef QDECLARATIVE_H
 #define QDECLARATIVE_H
 
-#include <QtDeclarative/qdeclarativeprivate.h>
-#include <QtDeclarative/qdeclarativeparserstatus.h>
-#include <QtDeclarative/qdeclarativepropertyvaluesource.h>
-#include <QtDeclarative/qdeclarativepropertyvalueinterceptor.h>
-#include <QtDeclarative/qdeclarativelist.h>
+#include <QtQuick1/qdeclarativeprivate.h>
+#include <QtQuick1/qdeclarativeparserstatus.h>
+#include <QtQuick1/qdeclarativepropertyvaluesource.h>
+#include <QtQuick1/qdeclarativepropertyvalueinterceptor.h>
+#include <QtQuick1/qdeclarativelist.h>
 
 #include <QtCore/qbytearray.h>
 #include <QtCore/qmetaobject.h>
diff --git a/src/declarative/qml/qdeclarativecompiledbindings.cpp b/src/declarative/qml/qdeclarativecompiledbindings.cpp
index 798c97f..3a7bd51 100644
--- a/src/declarative/qml/qdeclarativecompiledbindings.cpp
+++ b/src/declarative/qml/qdeclarativecompiledbindings.cpp
@@ -44,7 +44,7 @@
 
 #include "private/qdeclarativecompiledbindings_p.h"
 
-#include <QtDeclarative/qdeclarativeinfo.h>
+#include <QtQuick1/qdeclarativeinfo.h>
 #include <private/qdeclarativecontext_p.h>
 #include <private/qdeclarativejsast_p.h>
 #include <private/qdeclarativejsengine_p.h>
diff --git a/src/declarative/qml/qdeclarativecomponent.h b/src/declarative/qml/qdeclarativecomponent.h
index 50954ad..bc079e4 100644
--- a/src/declarative/qml/qdeclarativecomponent.h
+++ b/src/declarative/qml/qdeclarativecomponent.h
@@ -42,8 +42,8 @@
 #ifndef QDECLARATIVECOMPONENT_H
 #define QDECLARATIVECOMPONENT_H
 
-#include <QtDeclarative/qdeclarative.h>
-#include <QtDeclarative/qdeclarativeerror.h>
+#include <QtQuick1/qdeclarative.h>
+#include <QtQuick1/qdeclarativeerror.h>
 
 #include <QtCore/qobject.h>
 #include <QtCore/qstring.h>
diff --git a/src/declarative/qml/qdeclarativedata_p.h b/src/declarative/qml/qdeclarativedata_p.h
index b26c4d5..495b4cf 100644
--- a/src/declarative/qml/qdeclarativedata_p.h
+++ b/src/declarative/qml/qdeclarativedata_p.h
@@ -92,7 +92,6 @@ public:
     static void objectNameChanged(QAbstractDeclarativeData *, QObject *);
 
     void destroyed(QObject *);
-    void parentChanged(QObject *, QObject *);
     void objectNameChanged(QObject *);
 
     void setImplicitDestructible() {
diff --git a/src/declarative/qml/qdeclarativeengine.cpp b/src/declarative/qml/qdeclarativeengine.cpp
index 39a1733..af9d0d8 100644
--- a/src/declarative/qml/qdeclarativeengine.cpp
+++ b/src/declarative/qml/qdeclarativeengine.cpp
@@ -96,7 +96,6 @@
 #include <QtCore/qmutex.h>
 #include <QtGui/qcolor.h>
 #include <QtGui/qvector3d.h>
-#include <QtGui/qsound.h>
 #include <QtCore/qcryptographichash.h>
 
 #include <private/qobject_p.h>
@@ -552,7 +551,9 @@ void QDeclarativeData::destroyed(QAbstractDeclarativeData *d, QObject *o)
 
 void QDeclarativeData::parentChanged(QAbstractDeclarativeData *d, QObject *o, QObject *p)
 {
-    static_cast<QDeclarativeData *>(d)->parentChanged(o, p);
+    Q_UNUSED(d)
+    Q_UNUSED(o)
+    Q_UNUSED(p)
 }
 
 void QDeclarativeData::objectNameChanged(QAbstractDeclarativeData *d, QObject *o)
@@ -1169,11 +1170,6 @@ void QDeclarativeData::destroyed(QObject *object)
         delete this;
 }
 
-void QDeclarativeData::parentChanged(QObject *, QObject *parent)
-{
-    if (!parent && scriptValue) { delete scriptValue; scriptValue = 0; }
-}
-
 void QDeclarativeData::objectNameChanged(QObject *)
 {
     if (extendedData) objectNameNotifier()->notify();
diff --git a/src/declarative/qml/qdeclarativeengine.h b/src/declarative/qml/qdeclarativeengine.h
index fd06115..1f925eb 100644
--- a/src/declarative/qml/qdeclarativeengine.h
+++ b/src/declarative/qml/qdeclarativeengine.h
@@ -46,8 +46,8 @@
 #include <QtCore/qobject.h>
 #include <QtCore/qmap.h>
 #include <QtScript/qscriptvalue.h>
-#include <QtDeclarative/qdeclarativeerror.h>
-#include <QtDeclarative/qdeclarativedebug.h>
+#include <QtQuick1/qdeclarativeerror.h>
+#include <QtQuick1/qdeclarativedebug.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/declarative/qml/qdeclarativeexpression.h b/src/declarative/qml/qdeclarativeexpression.h
index 732aa74..7a8055c 100644
--- a/src/declarative/qml/qdeclarativeexpression.h
+++ b/src/declarative/qml/qdeclarativeexpression.h
@@ -42,7 +42,7 @@
 #ifndef QDECLARATIVEEXPRESSION_H
 #define QDECLARATIVEEXPRESSION_H
 
-#include <QtDeclarative/qdeclarativeerror.h>
+#include <QtQuick1/qdeclarativeerror.h>
 
 #include <QtCore/qobject.h>
 #include <QtCore/qvariant.h>
diff --git a/src/declarative/qml/qdeclarativeextensionplugin.h b/src/declarative/qml/qdeclarativeextensionplugin.h
index 7ae4987..e8bc508 100644
--- a/src/declarative/qml/qdeclarativeextensionplugin.h
+++ b/src/declarative/qml/qdeclarativeextensionplugin.h
@@ -44,7 +44,7 @@
 
 #include <QtCore/qplugin.h>
 
-#include <QtDeclarative/qdeclarativeextensioninterface.h>
+#include <QtQuick1/qdeclarativeextensioninterface.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/declarative/qml/qdeclarativeimport.cpp b/src/declarative/qml/qdeclarativeimport.cpp
index a3592f9..e79ffe4 100644
--- a/src/declarative/qml/qdeclarativeimport.cpp
+++ b/src/declarative/qml/qdeclarativeimport.cpp
@@ -47,7 +47,7 @@
 #include <QtCore/qpluginloader.h>
 #include <QtCore/qlibraryinfo.h>
 #include <QtCore/qalgorithms.h>
-#include <QtDeclarative/qdeclarativeextensioninterface.h>
+#include <QtQuick1/qdeclarativeextensioninterface.h>
 #include <private/qdeclarativeglobal_p.h>
 #include <private/qdeclarativetypenamecache_p.h>
 #include <private/qdeclarativeengine_p.h>
diff --git a/src/declarative/qml/qdeclarativeinfo.h b/src/declarative/qml/qdeclarativeinfo.h
index e97d841..206c270 100644
--- a/src/declarative/qml/qdeclarativeinfo.h
+++ b/src/declarative/qml/qdeclarativeinfo.h
@@ -44,7 +44,7 @@
 
 #include <QtCore/qdebug.h>
 #include <QtCore/qurl.h>
-#include <QtDeclarative/qdeclarativeerror.h>
+#include <QtQuick1/qdeclarativeerror.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/declarative/qml/qdeclarativemetatype.cpp b/src/declarative/qml/qdeclarativemetatype.cpp
index d46eb78..33f7422 100644
--- a/src/declarative/qml/qdeclarativemetatype.cpp
+++ b/src/declarative/qml/qdeclarativemetatype.cpp
@@ -39,7 +39,7 @@
 **
 ****************************************************************************/
 
-#include <QtDeclarative/qdeclarativeprivate.h>
+#include <QtQuick1/qdeclarativeprivate.h>
 #include "private/qdeclarativemetatype_p.h"
 
 #include "private/qdeclarativeproxymetaobject_p.h"
@@ -992,13 +992,13 @@ QT_END_NAMESPACE
 #include <QtGui/qbrush.h>
 #include <QtGui/qcolor.h>
 #include <QtGui/qpalette.h>
-#include <QtGui/qicon.h>
+#include <QtWidgets/qicon.h>
 #include <QtGui/qimage.h>
 #include <QtGui/qpolygon.h>
 #include <QtGui/qregion.h>
 #include <QtGui/qbitmap.h>
 #include <QtGui/qcursor.h>
-#include <QtGui/qsizepolicy.h>
+#include <QtWidgets/qsizepolicy.h>
 #include <QtGui/qkeysequence.h>
 #include <QtGui/qpen.h>
 
diff --git a/src/declarative/qml/qdeclarativetypeloader.cpp b/src/declarative/qml/qdeclarativetypeloader.cpp
index 4fa4510..75868f1 100644
--- a/src/declarative/qml/qdeclarativetypeloader.cpp
+++ b/src/declarative/qml/qdeclarativetypeloader.cpp
@@ -47,7 +47,7 @@
 #include <private/qdeclarativeglobal_p.h>
 #include <private/qdeclarativedebugtrace_p.h>
 
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <QtCore/qdebug.h>
 #include <QtCore/qdir.h>
 #include <QtCore/qdiriterator.h>
diff --git a/src/declarative/qml/qdeclarativetypeloader_p.h b/src/declarative/qml/qdeclarativetypeloader_p.h
index d377b4b..3b8e07b 100644
--- a/src/declarative/qml/qdeclarativetypeloader_p.h
+++ b/src/declarative/qml/qdeclarativetypeloader_p.h
@@ -55,8 +55,8 @@
 
 #include <QtCore/qobject.h>
 #include <QtNetwork/qnetworkreply.h>
-#include <QtDeclarative/qdeclarativeerror.h>
-#include <QtDeclarative/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeerror.h>
+#include <QtQuick1/qdeclarativeengine.h>
 #include <private/qdeclarativescriptparser_p.h>
 #include <private/qdeclarativedirparser_p.h>
 #include <private/qdeclarativeimport_p.h>
diff --git a/src/declarative/qml/qdeclarativeworkerscript.cpp b/src/declarative/qml/qdeclarativeworkerscript.cpp
index be283ea..a1fd4cc 100644
--- a/src/declarative/qml/qdeclarativeworkerscript.cpp
+++ b/src/declarative/qml/qdeclarativeworkerscript.cpp
@@ -55,7 +55,7 @@
 #include <QtCore/qfile.h>
 #include <QtCore/qdatetime.h>
 #include <QtNetwork/qnetworkaccessmanager.h>
-#include <QtDeclarative/qdeclarativeinfo.h>
+#include <QtQuick1/qdeclarativeinfo.h>
 #include "qdeclarativenetworkaccessmanagerfactory.h"
 
 
diff --git a/src/declarative/qml/qdeclarativexmlhttprequest.cpp b/src/declarative/qml/qdeclarativexmlhttprequest.cpp
index 3348a7d..f6f9ea8 100644
--- a/src/declarative/qml/qdeclarativexmlhttprequest.cpp
+++ b/src/declarative/qml/qdeclarativexmlhttprequest.cpp
@@ -46,7 +46,7 @@
 #include "private/qdeclarativerefcount_p.h"
 #include "private/qdeclarativeengine_p.h"
 #include "private/qdeclarativeexpression_p.h"
-#include "qdeclarativeglobal_p.h"
+#include "private/qdeclarativeglobal_p.h"
 
 #include <QtCore/qobject.h>
 #include <QtScript/qscriptvalue.h>
diff --git a/src/declarative/qml/rewriter/textwriter_p.h b/src/declarative/qml/rewriter/textwriter_p.h
index 472539d..1f70a48 100644
--- a/src/declarative/qml/rewriter/textwriter_p.h
+++ b/src/declarative/qml/rewriter/textwriter_p.h
@@ -42,7 +42,7 @@
 #ifndef TEXTWRITER_H
 #define TEXTWRITER_H
 
-#include <qdeclarativejsglobal_p.h>
+#include <private/qdeclarativejsglobal_p.h>
 
 #include <QtCore/QString>
 #include <QtCore/QList>
diff --git a/src/declarative/util/qdeclarativeanimation.cpp b/src/declarative/util/qdeclarativeanimation.cpp
index 496520e..028deff 100644
--- a/src/declarative/util/qdeclarativeanimation.cpp
+++ b/src/declarative/util/qdeclarativeanimation.cpp
@@ -50,12 +50,12 @@
 #include <qdeclarative.h>
 #include <qdeclarativeinfo.h>
 #include <qdeclarativeexpression.h>
-#include <qdeclarativestringconverters_p.h>
-#include <qdeclarativeglobal_p.h>
-#include <qdeclarativemetatype_p.h>
-#include <qdeclarativevaluetype_p.h>
-#include <qdeclarativeproperty_p.h>
-#include <qdeclarativeengine_p.h>
+#include <private/qdeclarativestringconverters_p.h>
+#include <private/qdeclarativeglobal_p.h>
+#include <private/qdeclarativemetatype_p.h>
+#include <private/qdeclarativevaluetype_p.h>
+#include <private/qdeclarativeproperty_p.h>
+#include <private/qdeclarativeengine_p.h>
 
 #include <qvariant.h>
 #include <qcolor.h>
diff --git a/src/declarative/util/qdeclarativeapplication.cpp b/src/declarative/util/qdeclarativeapplication.cpp
index af80aed..f83b782 100644
--- a/src/declarative/util/qdeclarativeapplication.cpp
+++ b/src/declarative/util/qdeclarativeapplication.cpp
@@ -41,7 +41,7 @@
 
 #include "qdeclarativeapplication_p.h"
 #include <private/qobject_p.h>
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/util/qdeclarativebehavior.cpp b/src/declarative/util/qdeclarativebehavior.cpp
index 8921bee..a49c750 100644
--- a/src/declarative/util/qdeclarativebehavior.cpp
+++ b/src/declarative/util/qdeclarativebehavior.cpp
@@ -46,9 +46,9 @@
 
 #include <qdeclarativecontext.h>
 #include <qdeclarativeinfo.h>
-#include <qdeclarativeproperty_p.h>
-#include <qdeclarativeguard_p.h>
-#include <qdeclarativeengine_p.h>
+#include <private/qdeclarativeproperty_p.h>
+#include <private/qdeclarativeguard_p.h>
+#include <private/qdeclarativeengine_p.h>
 
 #include <private/qobject_p.h>
 
diff --git a/src/declarative/util/qdeclarativeconnections.cpp b/src/declarative/util/qdeclarativeconnections.cpp
index 7c9c933..82f0e67 100644
--- a/src/declarative/util/qdeclarativeconnections.cpp
+++ b/src/declarative/util/qdeclarativeconnections.cpp
@@ -42,10 +42,10 @@
 #include "private/qdeclarativeconnections_p.h"
 
 #include <qdeclarativeexpression.h>
-#include <qdeclarativeproperty_p.h>
-#include <qdeclarativeboundsignal_p.h>
+#include <private/qdeclarativeproperty_p.h>
+#include <private/qdeclarativeboundsignal_p.h>
 #include <qdeclarativecontext.h>
-#include <qdeclarativecontext_p.h>
+#include <private/qdeclarativecontext_p.h>
 #include <qdeclarativeinfo.h>
 
 #include <QtCore/qdebug.h>
diff --git a/src/declarative/util/qdeclarativelistaccessor.cpp b/src/declarative/util/qdeclarativelistaccessor.cpp
index 5a0e2fd..23000d8 100644
--- a/src/declarative/util/qdeclarativelistaccessor.cpp
+++ b/src/declarative/util/qdeclarativelistaccessor.cpp
@@ -41,13 +41,13 @@
 
 #include "private/qdeclarativelistaccessor_p.h"
 
-#include <qdeclarativemetatype_p.h>
+#include <private/qdeclarativemetatype_p.h>
 
 #include <QtCore/qstringlist.h>
 #include <QtCore/qdebug.h>
 
 // ### Remove me
-#include <qdeclarativeengine_p.h>
+#include <private/qdeclarativeengine_p.h>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/util/qdeclarativelistmodel.cpp b/src/declarative/util/qdeclarativelistmodel.cpp
index b87f914..ca0733d 100644
--- a/src/declarative/util/qdeclarativelistmodel.cpp
+++ b/src/declarative/util/qdeclarativelistmodel.cpp
@@ -43,9 +43,9 @@
 #include "private/qdeclarativelistmodelworkeragent_p.h"
 #include "private/qdeclarativeopenmetaobject_p.h"
 
-#include <qdeclarativecustomparser_p.h>
-#include <qdeclarativeparser_p.h>
-#include <qdeclarativeengine_p.h>
+#include <private/qdeclarativecustomparser_p.h>
+#include <private/qdeclarativeparser_p.h>
+#include <private/qdeclarativeengine_p.h>
 #include <qdeclarativecontext.h>
 #include <qdeclarativeinfo.h>
 
diff --git a/src/declarative/util/qdeclarativeopenmetaobject.cpp b/src/declarative/util/qdeclarativeopenmetaobject.cpp
index 6290bf9..02f6bbb 100644
--- a/src/declarative/util/qdeclarativeopenmetaobject.cpp
+++ b/src/declarative/util/qdeclarativeopenmetaobject.cpp
@@ -42,7 +42,7 @@
 #include "private/qdeclarativeopenmetaobject_p.h"
 #include "private/qdeclarativepropertycache_p.h"
 #include "private/qdeclarativedata_p.h"
-#include <qmetaobjectbuilder_p.h>
+#include <private/qmetaobjectbuilder_p.h>
 #include <qdebug.h>
 
 QT_BEGIN_NAMESPACE
diff --git a/src/declarative/util/qdeclarativepropertychanges.cpp b/src/declarative/util/qdeclarativepropertychanges.cpp
index 97c6a1a..a9e9f46 100644
--- a/src/declarative/util/qdeclarativepropertychanges.cpp
+++ b/src/declarative/util/qdeclarativepropertychanges.cpp
@@ -47,14 +47,14 @@
 #include "private/qdeclarativecompiler_p.h"
 
 #include <qdeclarativeinfo.h>
-#include <qdeclarativecustomparser_p.h>
-#include <qdeclarativeparser_p.h>
+#include <private/qdeclarativecustomparser_p.h>
+#include <private/qdeclarativeparser_p.h>
 #include <qdeclarativeexpression.h>
-#include <qdeclarativebinding_p.h>
+#include <private/qdeclarativebinding_p.h>
 #include <qdeclarativecontext.h>
-#include <qdeclarativeguard_p.h>
-#include <qdeclarativeproperty_p.h>
-#include <qdeclarativecontext_p.h>
+#include <private/qdeclarativeguard_p.h>
+#include <private/qdeclarativeproperty_p.h>
+#include <private/qdeclarativecontext_p.h>
 #include <qdeclarativestate_p_p.h>
 
 #include <QtCore/qdebug.h>
diff --git a/src/declarative/util/qdeclarativespringanimation.cpp b/src/declarative/util/qdeclarativespringanimation.cpp
index 034c54b..5f81413 100644
--- a/src/declarative/util/qdeclarativespringanimation.cpp
+++ b/src/declarative/util/qdeclarativespringanimation.cpp
@@ -42,7 +42,7 @@
 #include "private/qdeclarativespringanimation_p.h"
 
 #include "private/qdeclarativeanimation_p_p.h"
-#include <qdeclarativeproperty_p.h>
+#include <private/qdeclarativeproperty_p.h>
 
 #include <QtCore/qdebug.h>
 
diff --git a/src/declarative/util/qdeclarativestate.cpp b/src/declarative/util/qdeclarativestate.cpp
index 2387108..6ed5f84 100644
--- a/src/declarative/util/qdeclarativestate.cpp
+++ b/src/declarative/util/qdeclarativestate.cpp
@@ -48,8 +48,8 @@
 #include "private/qdeclarativeanimation_p.h"
 #include "private/qdeclarativeanimation_p_p.h"
 
-#include <qdeclarativebinding_p.h>
-#include <qdeclarativeglobal_p.h>
+#include <private/qdeclarativebinding_p.h>
+#include <private/qdeclarativeglobal_p.h>
 
 #include <QtCore/qdebug.h>
 
diff --git a/src/declarative/util/qdeclarativestategroup.cpp b/src/declarative/util/qdeclarativestategroup.cpp
index 29be45e..705d176 100644
--- a/src/declarative/util/qdeclarativestategroup.cpp
+++ b/src/declarative/util/qdeclarativestategroup.cpp
@@ -44,8 +44,8 @@
 #include "private/qdeclarativetransition_p.h"
 #include "private/qdeclarativestate_p_p.h"
 
-#include <qdeclarativebinding_p.h>
-#include <qdeclarativeglobal_p.h>
+#include <private/qdeclarativebinding_p.h>
+#include <private/qdeclarativeglobal_p.h>
 
 #include <QtCore/qstringbuilder.h>
 #include <QtCore/qdebug.h>
diff --git a/src/declarative/util/qdeclarativestateoperations.cpp b/src/declarative/util/qdeclarativestateoperations.cpp
index 30c5730..ec48dc6 100644
--- a/src/declarative/util/qdeclarativestateoperations.cpp
+++ b/src/declarative/util/qdeclarativestateoperations.cpp
@@ -47,7 +47,7 @@
 #include <qdeclarativeinfo.h>
 #include <qdeclarativeanchors_p_p.h>
 #include <qdeclarativeitem_p.h>
-#include <qdeclarativeguard_p.h>
+#include <private/qdeclarativeguard_p.h>
 #include <qdeclarativenullablevalue_p_p.h>
 #include "private/qdeclarativecontext_p.h"
 #include "private/qdeclarativeproperty_p.h"
@@ -55,7 +55,7 @@
 #include "private/qdeclarativestate_p_p.h"
 
 #include <QtCore/qdebug.h>
-#include <QtGui/qgraphicsitem.h>
+#include <QtWidgets/qgraphicsitem.h>
 #include <QtCore/qmath.h>
 
 #include <private/qobject_p.h>
diff --git a/src/declarative/util/qdeclarativetransitionmanager.cpp b/src/declarative/util/qdeclarativetransitionmanager.cpp
index 0cd66c0..c02da16 100644
--- a/src/declarative/util/qdeclarativetransitionmanager.cpp
+++ b/src/declarative/util/qdeclarativetransitionmanager.cpp
@@ -44,9 +44,9 @@
 #include "private/qdeclarativestate_p_p.h"
 #include "private/qdeclarativestate_p.h"
 
-#include <qdeclarativebinding_p.h>
-#include <qdeclarativeglobal_p.h>
-#include <qdeclarativeproperty_p.h>
+#include <private/qdeclarativebinding_p.h>
+#include <private/qdeclarativeglobal_p.h>
+#include <private/qdeclarativeproperty_p.h>
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/declarative/util/qdeclarativeview.cpp b/src/declarative/util/qdeclarativeview.cpp
index ec357ff..f726cf4 100644
--- a/src/declarative/util/qdeclarativeview.cpp
+++ b/src/declarative/util/qdeclarativeview.cpp
@@ -45,8 +45,8 @@
 #include <qdeclarativeitem.h>
 #include <qdeclarativeengine.h>
 #include <qdeclarativecontext.h>
-#include <qdeclarativeglobal_p.h>
-#include <qdeclarativeguard_p.h>
+#include <private/qdeclarativeglobal_p.h>
+#include <private/qdeclarativeguard_p.h>
 
 #include <private/qdeclarativedebugtrace_p.h>
 #include <private/qdeclarativeinspectorservice_p.h>
diff --git a/src/declarative/util/qdeclarativeview.h b/src/declarative/util/qdeclarativeview.h
index 043460c..e428e43 100644
--- a/src/declarative/util/qdeclarativeview.h
+++ b/src/declarative/util/qdeclarativeview.h
@@ -44,10 +44,10 @@
 
 #include <QtCore/qdatetime.h>
 #include <QtCore/qurl.h>
-#include <QtGui/qgraphicssceneevent.h>
-#include <QtGui/qgraphicsview.h>
-#include <QtGui/qwidget.h>
-#include <QtDeclarative/qdeclarativedebug.h>
+#include <QtWidgets/qgraphicssceneevent.h>
+#include <QtWidgets/qgraphicsview.h>
+#include <QtWidgets/qwidget.h>
+#include <QtQuick1/qdeclarativedebug.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/declarative/util/qdeclarativexmllistmodel.cpp b/src/declarative/util/qdeclarativexmllistmodel.cpp
index a789996..f314ffb 100644
--- a/src/declarative/util/qdeclarativexmllistmodel.cpp
+++ b/src/declarative/util/qdeclarativexmllistmodel.cpp
@@ -42,7 +42,7 @@
 #include "private/qdeclarativexmllistmodel_p.h"
 
 #include <qdeclarativecontext.h>
-#include <qdeclarativeengine_p.h>
+#include <private/qdeclarativeengine_p.h>
 
 #include <QDebug>
 #include <QStringList>
@@ -254,12 +254,12 @@ int QDeclarativeXmlQueryEngine::doQuery(QString query, QString namespaces, QByte
     {
         QMutexLocker m1(&m_mutex);
         m_queryIds.ref();
-        if (m_queryIds <= 0)
-            m_queryIds = 1;
+        if (m_queryIds.load() <= 0)
+            m_queryIds.store(1);
     }
 
     XmlQueryJob job;
-    job.queryId = m_queryIds;
+    job.queryId = m_queryIds.load();
     job.data = data;
     job.query = QLatin1String("doc($src)") + query;
     job.namespaces = namespaces;
diff --git a/src/imports/folderlistmodel/folderlistmodel.pro b/src/imports/folderlistmodel/folderlistmodel.pro
index 0f63979..fd80acd 100644
--- a/src/imports/folderlistmodel/folderlistmodel.pro
+++ b/src/imports/folderlistmodel/folderlistmodel.pro
@@ -2,7 +2,7 @@ TARGET  = qmlfolderlistmodelplugin
 TARGETPATH = Qt/labs/folderlistmodel
 include(../qimportbase.pri)
 
-QT += declarative script
+QT += widgets quick1 script
 
 SOURCES += qdeclarativefolderlistmodel.cpp plugin.cpp
 HEADERS += qdeclarativefolderlistmodel.h
diff --git a/src/imports/folderlistmodel/plugin.cpp b/src/imports/folderlistmodel/plugin.cpp
index 61054a1..f2b9620 100644
--- a/src/imports/folderlistmodel/plugin.cpp
+++ b/src/imports/folderlistmodel/plugin.cpp
@@ -38,8 +38,8 @@
 **
 ****************************************************************************/
 
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 
 #include "qdeclarativefolderlistmodel.h"
 
diff --git a/src/imports/gestures/gestures.pro b/src/imports/gestures/gestures.pro
index 2768cc9..03dd729 100644
--- a/src/imports/gestures/gestures.pro
+++ b/src/imports/gestures/gestures.pro
@@ -2,7 +2,7 @@ TARGET  = qmlgesturesplugin
 TARGETPATH = Qt/labs/gestures
 include(../qimportbase.pri)
 
-QT += declarative
+QT += quick1 quick1-private widgets widgets-private gui gui-private core-private script-private
 
 SOURCES += qdeclarativegesturearea.cpp plugin.cpp
 HEADERS += qdeclarativegesturearea_p.h
diff --git a/src/imports/gestures/plugin.cpp b/src/imports/gestures/plugin.cpp
index 15c9d22..2cd6732 100644
--- a/src/imports/gestures/plugin.cpp
+++ b/src/imports/gestures/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 
 #include "qdeclarativegesturearea_p.h"
 
diff --git a/src/imports/gestures/qdeclarativegesturearea_p.h b/src/imports/gestures/qdeclarativegesturearea_p.h
index 8171b37..3048e41 100644
--- a/src/imports/gestures/qdeclarativegesturearea_p.h
+++ b/src/imports/gestures/qdeclarativegesturearea_p.h
@@ -48,7 +48,7 @@
 
 #include <QtCore/qobject.h>
 #include <QtCore/qstring.h>
-#include <QtGui/qgesture.h>
+#include <QtWidgets/qgesture.h>
 
 #ifndef QT_NO_GESTURES
 
diff --git a/src/imports/particles/particles.cpp b/src/imports/particles/particles.cpp
index 533ec08..15d1de1 100644
--- a/src/imports/particles/particles.cpp
+++ b/src/imports/particles/particles.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 
 #include "qdeclarativeparticles_p.h"
 
diff --git a/src/imports/particles/particles.pro b/src/imports/particles/particles.pro
index 894d164..019b63a 100644
--- a/src/imports/particles/particles.pro
+++ b/src/imports/particles/particles.pro
@@ -2,7 +2,7 @@ TARGET  = qmlparticlesplugin
 TARGETPATH = Qt/labs/particles
 include(../qimportbase.pri)
 
-QT += declarative
+QT += quick1 quick1-private core-private gui-private widgets-private
 
 SOURCES += \
     qdeclarativeparticles.cpp \
diff --git a/src/imports/particles/qdeclarativeparticles.cpp b/src/imports/particles/qdeclarativeparticles.cpp
index b2b304a..53b447e 100644
--- a/src/imports/particles/qdeclarativeparticles.cpp
+++ b/src/imports/particles/qdeclarativeparticles.cpp
@@ -48,7 +48,7 @@
 #include <QtCore/QAbstractAnimation>
 
 #include <QPainter>
-#include <QtGui/qdrawutil.h>
+#include <QtWidgets/qdrawutil.h>
 #include <QVarLengthArray>
 
 #include <stdlib.h>
diff --git a/src/imports/particles/qdeclarativeparticles_p.h b/src/imports/particles/qdeclarativeparticles_p.h
index 0a2b6d8..7921306 100644
--- a/src/imports/particles/qdeclarativeparticles_p.h
+++ b/src/imports/particles/qdeclarativeparticles_p.h
@@ -42,7 +42,7 @@
 #ifndef QDECLARATIVEPARTICLES_H
 #define QDECLARATIVEPARTICLES_H
 
-#include <QtDeclarative/qdeclarativeitem.h>
+#include <QtQuick1/qdeclarativeitem.h>
 
 QT_BEGIN_HEADER
 
diff --git a/src/imports/shaders/qmlshadersplugin_plugin.cpp b/src/imports/shaders/qmlshadersplugin_plugin.cpp
index 613e183..00a537c 100644
--- a/src/imports/shaders/qmlshadersplugin_plugin.cpp
+++ b/src/imports/shaders/qmlshadersplugin_plugin.cpp
@@ -43,7 +43,7 @@
 #include "shadereffectitem.h"
 #include "shadereffectsource.h"
 
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarative.h>
 
 void qmlshaderspluginPlugin::registerTypes(const char *uri)
 {
diff --git a/src/imports/shaders/qmlshadersplugin_plugin.h b/src/imports/shaders/qmlshadersplugin_plugin.h
index d1f7746..98765aa 100644
--- a/src/imports/shaders/qmlshadersplugin_plugin.h
+++ b/src/imports/shaders/qmlshadersplugin_plugin.h
@@ -42,7 +42,7 @@
 #ifndef QMLSHADERSPLUGIN_PLUGIN_H
 #define QMLSHADERSPLUGIN_PLUGIN_H
 
-#include <QtDeclarative/QDeclarativeExtensionPlugin>
+#include <QtQuick1/QDeclarativeExtensionPlugin>
 
 class qmlshaderspluginPlugin : public QDeclarativeExtensionPlugin
 {
diff --git a/src/imports/shaders/shaders.pro b/src/imports/shaders/shaders.pro
index 51a9a91..2d08952 100644
--- a/src/imports/shaders/shaders.pro
+++ b/src/imports/shaders/shaders.pro
@@ -2,7 +2,7 @@ TARGET = qmlshadersplugin
 TARGETPATH = Qt/labs/shaders
 include(../qimportbase.pri)
 
-QT += declarative opengl
+QT += quick1 opengl
 
 SOURCES += \
     qmlshadersplugin_plugin.cpp \
diff --git a/src/plugins/platforms/uikit/examples/qmltest/qmltest.xcodeproj/project.pbxproj b/src/plugins/platforms/uikit/examples/qmltest/qmltest.xcodeproj/project.pbxproj
index e513030..021eed2 100644
--- a/src/plugins/platforms/uikit/examples/qmltest/qmltest.xcodeproj/project.pbxproj
+++ b/src/plugins/platforms/uikit/examples/qmltest/qmltest.xcodeproj/project.pbxproj
@@ -3,7 +3,7 @@
 	archiveVersion = 1;
 	classes = {
 	};
-	objectVersion = 46;
+	objectVersion = 45;
 	objects = {
 
 /* Begin PBXBuildFile section */
@@ -35,8 +35,8 @@
 		D3CAA7F013264F52008BB877 /* Foundation.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = 1D30AB110D05D00D00671497 /* Foundation.framework */; };
 		D3CAA7F113264F52008BB877 /* UIKit.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = 1DF5F4DF0D08C38300B7A737 /* UIKit.framework */; };
 		D3CAA7F213264F52008BB877 /* CoreGraphics.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = 288765A40DF7441C002DB57D /* CoreGraphics.framework */; };
-		D3CAA7FA13264F8A008BB877 /* libz.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = D3CAA7F913264F8A008BB877 /* libz.dylib */; };
-		D3CAA81113264FF0008BB877 /* libz.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = D3CAA7F913264F8A008BB877 /* libz.dylib */; };
+		D3CAA7FA13264F8A008BB877 /* libz.1.2.3.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = D3CAA7F913264F8A008BB877 /* libz.1.2.3.dylib */; };
+		D3CAA81113264FF0008BB877 /* libz.1.2.3.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = D3CAA7F913264F8A008BB877 /* libz.1.2.3.dylib */; };
 		D3CAA89113265310008BB877 /* qml in Resources */ = {isa = PBXBuildFile; fileRef = D3CAA88E13265310008BB877 /* qml */; };
 		D3CAA89213265310008BB877 /* qml in Resources */ = {isa = PBXBuildFile; fileRef = D3CAA88E13265310008BB877 /* qml */; };
 		D3D817B2132A2CFD00CDE422 /* libQtCore.a in Frameworks */ = {isa = PBXBuildFile; fileRef = D3D817AA132A2CFD00CDE422 /* libQtCore.a */; };
@@ -75,7 +75,7 @@
 		D3578435134A09990046D202 /* libQtOpenGL.a */ = {isa = PBXFileReference; lastKnownFileType = archive.ar; name = libQtOpenGL.a; path = "../../../../../../../qt-lighthouse-ios-device/lib/libQtOpenGL.a"; sourceTree = "<group>"; };
 		D3CAA7C713264AAD008BB877 /* main.mm */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.objcpp; path = main.mm; sourceTree = "<group>"; };
 		D3CAA7F613264F52008BB877 /* qmltest.app */ = {isa = PBXFileReference; explicitFileType = wrapper.application; includeInIndex = 0; path = qmltest.app; sourceTree = BUILT_PRODUCTS_DIR; };
-		D3CAA7F913264F8A008BB877 /* libz.dylib */ = {isa = PBXFileReference; lastKnownFileType = "compiled.mach-o.dylib"; name = libz.dylib; path = usr/lib/libz.dylib; sourceTree = SDKROOT; };
+		D3CAA7F913264F8A008BB877 /* libz.1.2.3.dylib */ = {isa = PBXFileReference; lastKnownFileType = "compiled.mach-o.dylib"; name = libz.1.2.3.dylib; path = usr/lib/libz.1.2.3.dylib; sourceTree = SDKROOT; };
 		D3CAA88E13265310008BB877 /* qml */ = {isa = PBXFileReference; lastKnownFileType = folder; path = qml; sourceTree = SOURCE_ROOT; };
 		D3D817AA132A2CFD00CDE422 /* libQtCore.a */ = {isa = PBXFileReference; lastKnownFileType = archive.ar; name = libQtCore.a; path = "../../../../../../../qt-lighthouse-ios-device/lib/libQtCore.a"; sourceTree = SOURCE_ROOT; };
 		D3D817AB132A2CFD00CDE422 /* libQtDeclarative.a */ = {isa = PBXFileReference; lastKnownFileType = archive.ar; name = libQtDeclarative.a; path = "../../../../../../../qt-lighthouse-ios-device/lib/libQtDeclarative.a"; sourceTree = SOURCE_ROOT; };
@@ -98,7 +98,7 @@
 				1DF5F4E00D08C38300B7A737 /* UIKit.framework in Frameworks */,
 				288765A50DF7441C002DB57D /* CoreGraphics.framework in Frameworks */,
 				D35784261345D9940046D202 /* OpenGLES.framework in Frameworks */,
-				D3CAA7FA13264F8A008BB877 /* libz.dylib in Frameworks */,
+				D3CAA7FA13264F8A008BB877 /* libz.1.2.3.dylib in Frameworks */,
 				D307DECF13EBD05900399BD4 /* libQtCore.a in Frameworks */,
 				D307DED013EBD05900399BD4 /* libQtDeclarative.a in Frameworks */,
 				D307DED113EBD05900399BD4 /* libQtGui.a in Frameworks */,
@@ -121,7 +121,7 @@
 				D3CAA7F013264F52008BB877 /* Foundation.framework in Frameworks */,
 				D3CAA7F113264F52008BB877 /* UIKit.framework in Frameworks */,
 				D3CAA7F213264F52008BB877 /* CoreGraphics.framework in Frameworks */,
-				D3CAA81113264FF0008BB877 /* libz.dylib in Frameworks */,
+				D3CAA81113264FF0008BB877 /* libz.1.2.3.dylib in Frameworks */,
 				D3D817B2132A2CFD00CDE422 /* libQtCore.a in Frameworks */,
 				D3D817B3132A2CFD00CDE422 /* libQtDeclarative.a in Frameworks */,
 				D3D817B4132A2CFD00CDE422 /* libQtGui.a in Frameworks */,
@@ -188,7 +188,7 @@
 				D35784251345D9940046D202 /* OpenGLES.framework */,
 				D35784271345D9E00046D202 /* QuartzCore.framework */,
 				D34F290613F29B0300E4F9AC /* CoreText.framework */,
-				D3CAA7F913264F8A008BB877 /* libz.dylib */,
+				D3CAA7F913264F8A008BB877 /* libz.1.2.3.dylib */,
 			);
 			name = Frameworks;
 			sourceTree = "<group>";
@@ -277,11 +277,8 @@
 /* Begin PBXProject section */
 		29B97313FDCFA39411CA2CEA /* Project object */ = {
 			isa = PBXProject;
-			attributes = {
-				LastUpgradeCheck = 0420;
-			};
 			buildConfigurationList = C01FCF4E08A954540054247B /* Build configuration list for PBXProject "qmltest" */;
-			compatibilityVersion = "Xcode 3.2";
+			compatibilityVersion = "Xcode 3.1";
 			developmentRegion = English;
 			hasScannedForEncodings = 1;
 			knownRegions = (
@@ -396,6 +393,7 @@
 				GCC_C_LANGUAGE_STANDARD = c99;
 				GCC_WARN_ABOUT_RETURN_TYPE = YES;
 				GCC_WARN_UNUSED_VARIABLE = YES;
+				PREBINDING = NO;
 				SDKROOT = iphoneos;
 			};
 			name = Debug;
@@ -409,6 +407,7 @@
 				GCC_WARN_ABOUT_RETURN_TYPE = YES;
 				GCC_WARN_UNUSED_VARIABLE = YES;
 				OTHER_CFLAGS = "-DNS_BLOCK_ASSERTIONS=1";
+				PREBINDING = NO;
 				SDKROOT = iphoneos;
 			};
 			name = Release;
diff --git a/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.cpp b/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.cpp
index 3a1850f..746b4ab 100644
--- a/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.cpp
+++ b/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.cpp
@@ -54,9 +54,9 @@
 #include <QtCore/QCoreApplication>
 #include <QtCore/QDir>
 #include <QtCore/QFileInfo>
-#include <QtDeclarative/QDeclarativeComponent>
-#include <QtDeclarative/QDeclarativeEngine>
-#include <QtDeclarative/QDeclarativeContext>
+#include <QtQuick1/QDeclarativeComponent>
+#include <QtQuick1/QDeclarativeEngine>
+#include <QtQuick1/QDeclarativeContext>
 
 #if defined(QMLJSDEBUGGER) && QT_VERSION < 0x040800
 
@@ -145,45 +145,8 @@ void QmlApplicationViewer::addImportPath(const QString &path)
 
 void QmlApplicationViewer::setOrientation(ScreenOrientation orientation)
 {
-//#if defined(Q_OS_SYMBIAN)
-//    // If the version of Qt on the device is < 4.7.2, that attribute won't work
-//    if (orientation != ScreenOrientationAuto) {
-//        const QStringList v = QString::fromAscii(qVersion()).split(QLatin1Char('.'));
-//        if (v.count() == 3 && (v.at(0).toInt() << 16 | v.at(1).toInt() << 8 | v.at(2).toInt()) < 0x040702) {
-//            qWarning("Screen orientation locking only supported with Qt 4.7.2 and above");
-//            return;
-//        }
-//    }
-//#endif // Q_OS_SYMBIAN
-
-//    Qt::WidgetAttribute attribute;
-//    switch (orientation) {
-//#if QT_VERSION < 0x040702
-//    // Qt < 4.7.2 does not yet have the Qt::WA_*Orientation attributes
-//    case ScreenOrientationLockPortrait:
-//        attribute = static_cast<Qt::WidgetAttribute>(128);
-//        break;
-//    case ScreenOrientationLockLandscape:
-//        attribute = static_cast<Qt::WidgetAttribute>(129);
-//        break;
-//    default:
-//    case ScreenOrientationAuto:
-//        attribute = static_cast<Qt::WidgetAttribute>(130);
-//        break;
-//#else // QT_VERSION < 0x040702
-//    case ScreenOrientationLockPortrait:
-//        attribute = Qt::WA_LockPortraitOrientation;
-//        break;
-//    case ScreenOrientationLockLandscape:
-//        attribute = Qt::WA_LockLandscapeOrientation;
-//        break;
-//    default:
-//    case ScreenOrientationAuto:
-//        attribute = Qt::WA_AutoOrientation;
-//        break;
-//#endif // QT_VERSION < 0x040702
-//    };
-//    setAttribute(attribute, true);
+    // TODO: Needs a Qt5 implmentation
+    Q_UNUSED(orientation)
 }
 
 void QmlApplicationViewer::showExpanded()
diff --git a/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.h b/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.h
index f6a7900..9a32678 100644
--- a/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.h
+++ b/src/plugins/platforms/uikit/examples/share/qmlapplicationviewer/qmlapplicationviewer.h
@@ -52,7 +52,7 @@
 #ifndef QMLAPPLICATIONVIEWER_H
 #define QMLAPPLICATIONVIEWER_H
 
-#include <QtDeclarative/QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 
 class QmlApplicationViewer : public QDeclarativeView
 {
diff --git a/src/plugins/plugins.pro b/src/plugins/plugins.pro
index 94ce675..21d41c1 100644
--- a/src/plugins/plugins.pro
+++ b/src/plugins/plugins.pro
@@ -1,16 +1,3 @@
 TEMPLATE = subdirs
+SUBDIRS += qmltooling
 
-SUBDIRS	*= sqldrivers script bearer
-unix:!symbian {
-        contains(QT_CONFIG,iconv)|contains(QT_CONFIG,gnu-libiconv)|contains(QT_CONFIG,sun-libiconv):SUBDIRS *= codecs
-} else {
-        SUBDIRS *= codecs
-}
-!contains(QT_CONFIG, no-gui): SUBDIRS *= imageformats iconengines
-!embedded:!qpa:!contains(QT_CONFIG, no-gui):SUBDIRS *= graphicssystems
-embedded:SUBDIRS *=  gfxdrivers decorations mousedrivers kbddrivers
-!win32:!embedded:!mac:!symbian:!contains(QT_CONFIG, no-gui):SUBDIRS *= inputmethods
-!symbian:!contains(QT_CONFIG, no-gui):SUBDIRS += accessible
-contains(QT_CONFIG, phonon): SUBDIRS *= phonon
-qpa:SUBDIRS += platforms
-contains(QT_CONFIG, declarative): SUBDIRS *= qmltooling
diff --git a/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.cpp b/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.cpp
index c5e127c..72f55eb 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.cpp
@@ -44,17 +44,16 @@
 #include "abstracttool.h"
 #include "qdeclarativeinspectorprotocol.h"
 
-#include <QtDeclarative/QDeclarativeEngine>
-#include <QtDeclarative/QDeclarativeComponent>
-#include <QtDeclarative/private/qdeclarativedebughelper_p.h>
-#include "QtDeclarative/private/qdeclarativeinspectorservice_p.h"
+#include <QtQuick1/QDeclarativeEngine>
+#include <QtQuick1/QDeclarativeComponent>
+#include <QtCore/private/qabstractanimation_p.h>
+#include <QtQuick1/private/qdeclarativeinspectorservice_p.h>
 
-#include <QtGui/QVBoxLayout>
 #include <QtGui/QMouseEvent>
-#include <QtGui/QWidget>
 
 namespace QmlJSDebugger {
 
+
 AbstractViewInspector::AbstractViewInspector(QObject *parent) :
     QObject(parent),
     m_currentTool(0),
@@ -62,11 +61,8 @@ AbstractViewInspector::AbstractViewInspector(QObject *parent) :
     m_designModeBehavior(false),
     m_animationPaused(false),
     m_slowDownFactor(1.0),
-    m_debugService(0)
+    m_debugService(QDeclarativeInspectorService::instance())
 {
-    m_debugService = QDeclarativeInspectorService::instance();
-    connect(m_debugService, SIGNAL(gotMessage(QByteArray)),
-            this, SLOT(handleMessage(QByteArray)));
 }
 
 void AbstractViewInspector::createQmlObject(const QString &qml, QObject *parent,
@@ -134,7 +130,8 @@ void AbstractViewInspector::animationSpeedChangeRequested(qreal factor)
     }
 
     const float effectiveFactor = m_animationPaused ? 0 : factor;
-    QDeclarativeDebugHelper::setAnimationSlowDownFactor(effectiveFactor);
+    QUnifiedTimer::instance()->setSlowModeEnabled(effectiveFactor != 1.0);
+    QUnifiedTimer::instance()->setSlowdownFactor(effectiveFactor);
 }
 
 void AbstractViewInspector::animationPausedChangeRequested(bool paused)
@@ -145,22 +142,19 @@ void AbstractViewInspector::animationPausedChangeRequested(bool paused)
     }
 
     const float effectiveFactor = paused ? 0 : m_slowDownFactor;
-    QDeclarativeDebugHelper::setAnimationSlowDownFactor(effectiveFactor);
+    QUnifiedTimer::instance()->setSlowModeEnabled(effectiveFactor != 1.0);
+    QUnifiedTimer::instance()->setSlowdownFactor(effectiveFactor);
 }
 
 void AbstractViewInspector::setShowAppOnTop(bool appOnTop)
 {
-    if (viewWidget()) {
-        QWidget *window = viewWidget()->window();
-        Qt::WindowFlags flags = window->windowFlags();
-        if (appOnTop)
-            flags |= Qt::WindowStaysOnTopHint;
-        else
-            flags &= ~Qt::WindowStaysOnTopHint;
+    Qt::WindowFlags flags = windowFlags();
+    if (appOnTop)
+        flags |= Qt::WindowStaysOnTopHint;
+    else
+        flags &= ~Qt::WindowStaysOnTopHint;
 
-        window->setWindowFlags(flags);
-        window->show();
-    }
+    setWindowFlags(flags);
 
     m_showAppOnTop = appOnTop;
     sendShowAppOnTop(appOnTop);
@@ -508,4 +502,3 @@ QString AbstractViewInspector::idStringForObject(QObject *obj) const
 }
 
 } // namespace QmlJSDebugger
-
diff --git a/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.h b/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.h
index 700476f..7fbe444 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/abstractviewinspector.h
@@ -63,7 +63,7 @@ namespace QmlJSDebugger {
 class AbstractTool;
 
 /*
- * The common code between QSGView and QDeclarativeView inspectors lives here,
+ * The common code between QQuickView and QDeclarativeView inspectors lives here,
  */
 class AbstractViewInspector : public QObject
 {
@@ -72,24 +72,13 @@ class AbstractViewInspector : public QObject
 public:
     explicit AbstractViewInspector(QObject *parent = 0);
 
-    virtual void changeCurrentObjects(const QList<QObject*> &objects) = 0;
-
-    virtual void reloadView() = 0;
+    void handleMessage(const QByteArray &message);
 
     void createQmlObject(const QString &qml, QObject *parent,
                          const QStringList &importList,
                          const QString &filename = QString());
-
-    virtual void reparentQmlObject(QObject *object, QObject *newParent) = 0;
-
-    virtual void changeTool(InspectorProtocol::Tool tool) = 0;
-
     void clearComponentCache();
 
-    virtual QWidget *viewWidget() const = 0;
-    virtual QDeclarativeEngine *declarativeEngine() const = 0;
-
-
     bool showAppOnTop() const { return m_showAppOnTop; }
     bool designModeBehavior() const { return m_designModeBehavior; }
 
@@ -105,21 +94,13 @@ public:
 
     QString idStringForObject(QObject *obj) const;
 
-public slots:
-    void sendDesignModeBehavior(bool inDesignMode);
-    void sendColorChanged(const QColor &color);
-
-    void changeToColorPickerTool();
-    void changeToZoomTool();
-    void changeToSingleSelectTool();
-    void changeToMarqueeSelectTool();
-
-    virtual void setDesignModeBehavior(bool value);
-
-    void setShowAppOnTop(bool appOnTop);
-
-    void setAnimationSpeed(qreal factor);
-    void setAnimationPaused(bool paused);
+    virtual void changeCurrentObjects(const QList<QObject*> &objects) = 0;
+    virtual void reloadView() = 0;
+    virtual void reparentQmlObject(QObject *object, QObject *newParent) = 0;
+    virtual void changeTool(InspectorProtocol::Tool tool) = 0;
+    virtual Qt::WindowFlags windowFlags() const = 0;
+    virtual void setWindowFlags(Qt::WindowFlags flags) = 0;
+    virtual QDeclarativeEngine *declarativeEngine() const = 0;
 
 signals:
     void designModeBehaviorChanged(bool inDesignMode);
@@ -135,6 +116,8 @@ signals:
     void animationPausedChanged(bool paused);
 
 protected:
+    AbstractTool *currentTool() const { return m_currentTool; }
+    void setCurrentTool(AbstractTool *tool) { m_currentTool = tool; }
     bool eventFilter(QObject *, QEvent *);
 
     virtual bool leaveEvent(QEvent *);
@@ -146,13 +129,24 @@ protected:
     virtual bool mouseDoubleClickEvent(QMouseEvent *event);
     virtual bool wheelEvent(QWheelEvent *event);
 
-    AbstractTool *currentTool() const { return m_currentTool; }
-    void setCurrentTool(AbstractTool *tool) { m_currentTool = tool; }
-
 private slots:
-    void handleMessage(const QByteArray &message);
+    void sendColorChanged(const QColor &color);
 
 private:
+    void sendDesignModeBehavior(bool inDesignMode);
+
+    void changeToColorPickerTool();
+    void changeToZoomTool();
+    void changeToSingleSelectTool();
+    void changeToMarqueeSelectTool();
+
+    virtual void setDesignModeBehavior(bool value);
+
+    void setShowAppOnTop(bool appOnTop);
+
+    void setAnimationSpeed(qreal factor);
+    void setAnimationPaused(bool paused);
+
     void animationSpeedChangeRequested(qreal factor);
     void animationPausedChangeRequested(bool paused);
 
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.cpp
index 9c2f70c..8d6d3b3 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.cpp
@@ -40,7 +40,7 @@
 ****************************************************************************/
 
 #include "abstractliveedittool.h"
-#include "../qdeclarativeviewinspector_p.h"
+#include "qdeclarativeviewinspector_p.h"
 
 #include <QDeclarativeEngine>
 
@@ -49,6 +49,7 @@
 #include <QDeclarativeItem>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 AbstractLiveEditTool::AbstractLiveEditTool(QDeclarativeViewInspector *editorView)
     : AbstractTool(editorView)
@@ -192,5 +193,5 @@ QString AbstractLiveEditTool::titleForItem(QGraphicsItem *item)
     return constructedName;
 }
 
-
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.h b/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.h
index f2996a1..83a3073 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/abstractliveedittool.h
@@ -43,7 +43,7 @@
 #define ABSTRACTLIVEEDITTOOL_H
 
 #include <QtCore/QList>
-#include "../abstracttool.h"
+#include "abstracttool.h"
 
 QT_BEGIN_NAMESPACE
 class QMouseEvent;
@@ -57,6 +57,7 @@ class QDeclarativeView;
 QT_END_NAMESPACE
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class QDeclarativeViewInspector;
 
@@ -99,6 +100,7 @@ private:
     QList<QGraphicsItem*> m_itemList;
 };
 
-}
+} // namespace QtQuick1
+} // namesacpe QmlJSDebugger
 
 #endif // ABSTRACTLIVEEDITTOOL_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.cpp
index f630569..cace52a 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.cpp
@@ -41,16 +41,17 @@
 
 #include "boundingrecthighlighter.h"
 
-#include "../qdeclarativeviewinspector.h"
-#include "../qmlinspectorconstants.h"
+#include "qdeclarativeviewinspector.h"
+#include "qmlinspectorconstants.h"
 
-#include <QtGui/QGraphicsPolygonItem>
+#include <QtWidgets/QGraphicsPolygonItem>
 
 #include <QtCore/QTimer>
 #include <QtCore/QObject>
 #include <QtCore/QDebug>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 BoundingBox::BoundingBox(QGraphicsObject *itemToHighlight, QGraphicsItem *parentItem,
                          QObject *parent)
@@ -236,5 +237,5 @@ void BoundingRectHighlighter::refresh()
         highlightAll();
 }
 
-
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.h b/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.h
index aef4e4e..45f1b44 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/boundingrecthighlighter.h
@@ -54,6 +54,7 @@ QT_FORWARD_DECLARE_CLASS(QStyleOptionGraphicsItem)
 QT_FORWARD_DECLARE_CLASS(QTimer)
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class QDeclarativeViewInspector;
 class BoundingBox;
@@ -110,6 +111,7 @@ public:
     int type() const;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // BOUNDINGRECTHIGHLIGHTER_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.cpp
index 9fe40fb..b9e77f6 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.cpp
@@ -41,17 +41,18 @@
 
 #include "colorpickertool.h"
 
-#include "../qdeclarativeviewinspector.h"
+#include "qdeclarativeviewinspector.h"
 
 #include <QtGui/QMouseEvent>
 #include <QtGui/QKeyEvent>
 #include <QtCore/QRectF>
 #include <QtGui/QRgb>
 #include <QtGui/QImage>
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include <QtGui/QPalette>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 ColorPickerTool::ColorPickerTool(QDeclarativeViewInspector *view) :
     AbstractLiveEditTool(view)
@@ -75,9 +76,7 @@ void ColorPickerTool::mouseMoveEvent(QMouseEvent *event)
 
 void ColorPickerTool::clear()
 {
-#ifndef QT_NO_CURSOR
     view()->setCursor(Qt::CrossCursor);
-#endif
 }
 
 void ColorPickerTool::pickColor(const QPoint &pos)
@@ -97,4 +96,5 @@ void ColorPickerTool::pickColor(const QPoint &pos)
     emit selectedColorChanged(m_selectedColor);
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.h b/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.h
index dda147b..b61b2bb 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/colorpickertool.h
@@ -49,6 +49,7 @@
 QT_FORWARD_DECLARE_CLASS(QPoint)
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class ColorPickerTool : public AbstractLiveEditTool
 {
@@ -87,6 +88,7 @@ private:
     QColor m_selectedColor;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // COLORPICKERTOOL_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.cpp
index fd52b0e..a177185 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.cpp
@@ -41,11 +41,12 @@
 
 #include "livelayeritem.h"
 
-#include "../qmlinspectorconstants.h"
+#include "qmlinspectorconstants.h"
 
 #include <QGraphicsScene>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 LiveLayerItem::LiveLayerItem(QGraphicsScene* scene)
     : QGraphicsObject()
@@ -89,4 +90,5 @@ QList<QGraphicsItem*> LiveLayerItem::findAllChildItems(const QGraphicsItem *item
     return itemList;
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.h b/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.h
index bfff002..61c0c2d 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/livelayeritem.h
@@ -42,9 +42,10 @@
 #ifndef LIVELAYERITEM_H
 #define LIVELAYERITEM_H
 
-#include <QtGui/QGraphicsObject>
+#include <QtWidgets/QGraphicsObject>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class LiveLayerItem : public QGraphicsObject
 {
@@ -62,6 +63,7 @@ protected:
     QList<QGraphicsItem*> findAllChildItems(const QGraphicsItem *item) const;
 };
 
-}
+} // namespace QtQuick1
+} // namespace QmlJSDebugger
 
 #endif // LIVELAYERITEM_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.cpp
index 7c04f62..7c259d5 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.cpp
@@ -41,13 +41,14 @@
 
 #include "liverubberbandselectionmanipulator.h"
 
-#include "../qdeclarativeviewinspector_p.h"
+#include "qdeclarativeviewinspector_p.h"
 
-#include <QtGui/QGraphicsItem>
+#include <QtWidgets/QGraphicsItem>
 
 #include <QtCore/QDebug>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 LiveRubberBandSelectionManipulator::LiveRubberBandSelectionManipulator(QGraphicsObject *layerItem,
                                                                        QDeclarativeViewInspector *editorView)
@@ -162,4 +163,5 @@ bool LiveRubberBandSelectionManipulator::isActive() const
     return m_isActive;
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.h b/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.h
index c1609ea..8db8a87 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liverubberbandselectionmanipulator.h
@@ -49,6 +49,7 @@
 QT_FORWARD_DECLARE_CLASS(QGraphicsItem)
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class QDeclarativeViewInspector;
 
@@ -91,6 +92,7 @@ private:
     bool m_isActive;
 };
 
-}
+} // namespace QtQuick1
+} // namespace QmlJSDebugger
 
 #endif // RUBBERBANDSELECTIONMANIPULATOR_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.cpp
index 9545651..5715d6e 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.cpp
@@ -41,15 +41,16 @@
 
 #include "liveselectionindicator.h"
 
-#include "../qdeclarativeviewinspector_p.h"
-#include "../qmlinspectorconstants.h"
+#include "qdeclarativeviewinspector_p.h"
+#include "qmlinspectorconstants.h"
 
-#include <QtGui/QGraphicsRectItem>
-#include <QtGui/QGraphicsObject>
-#include <QtGui/QGraphicsScene>
+#include <QtWidgets/QGraphicsRectItem>
+#include <QtWidgets/QGraphicsObject>
+#include <QtWidgets/QGraphicsScene>
 #include <QtGui/QPen>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 LiveSelectionIndicator::LiveSelectionIndicator(QDeclarativeViewInspector *viewInspector,
                                                QGraphicsObject *layerItem)
@@ -114,5 +115,6 @@ void LiveSelectionIndicator::setItems(const QList<QWeakPointer<QGraphicsObject>
     }
 }
 
-} //namespace QmlJSDebugger
+} // namespace QtQuick1
+} // namespace QmlJSDebugger
 
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.h b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.h
index db38628..7effc3a 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionindicator.h
@@ -53,6 +53,7 @@ class QPolygonF;
 QT_END_NAMESPACE
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class QDeclarativeViewInspector;
 
@@ -75,6 +76,7 @@ private:
     QDeclarativeViewInspector *m_view;
 };
 
-}
+} // namespace QtQuick1
+} // namespace QmlJSDebugger
 
 #endif // LIVESELECTIONINDICATOR_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.cpp
index 91db286..e03cc59 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.cpp
@@ -41,18 +41,19 @@
 
 #include "liveselectionrectangle.h"
 
-#include "../qmlinspectorconstants.h"
+#include "qmlinspectorconstants.h"
 
 #include <QtGui/QPen>
-#include <QtGui/QGraphicsRectItem>
-#include <QtGui/QGraphicsObject>
-#include <QtGui/QGraphicsScene>
+#include <QtWidgets/QGraphicsRectItem>
+#include <QtWidgets/QGraphicsObject>
+#include <QtWidgets/QGraphicsScene>
 
 #include <QtCore/QtDebug>
 
 #include <cmath>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class SelectionRectShape : public QGraphicsRectItem
 {
@@ -110,4 +111,5 @@ void LiveSelectionRectangle::setRect(const QPointF &firstPoint,
     m_controlShape->setRect(rect);
 }
 
-}
+} // namespace QtQuick1
+} // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.h b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.h
index 5fe42a0..cb1487e 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectionrectangle.h
@@ -50,6 +50,7 @@ QT_FORWARD_DECLARE_CLASS(QPointF)
 QT_FORWARD_DECLARE_CLASS(QRectF)
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class LiveSelectionRectangle
 {
@@ -72,6 +73,7 @@ private:
     QWeakPointer<QGraphicsObject> m_layerItem;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // LIVESELECTIONRECTANGLE_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.cpp
index 288f1ec..5548924 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.cpp
@@ -42,22 +42,23 @@
 #include "liveselectiontool.h"
 #include "livelayeritem.h"
 
-#include "../qdeclarativeviewinspector_p.h"
+#include "qdeclarativeviewinspector_p.h"
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include <QtGui/QWheelEvent>
 #include <QtGui/QMouseEvent>
 #include <QtGui/QClipboard>
-#include <QtGui/QMenu>
-#include <QtGui/QAction>
-#include <QtGui/QGraphicsObject>
+#include <QtWidgets/QMenu>
+#include <QtWidgets/QAction>
+#include <QtWidgets/QGraphicsObject>
 
-#include <QtDeclarative/QDeclarativeItem>
-#include <QtDeclarative/QDeclarativeEngine>
+#include <QtQuick1/QDeclarativeItem>
+#include <QtQuick1/QDeclarativeEngine>
 
 #include <QtCore/QDebug>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 LiveSelectionTool::LiveSelectionTool(QDeclarativeViewInspector *editorView) :
     AbstractLiveEditTool(editorView),
@@ -363,9 +364,7 @@ void LiveSelectionTool::setSelectOnlyContentItems(bool selectOnlyContentItems)
 
 void LiveSelectionTool::clear()
 {
-#ifndef QT_NO_CURSOR
     view()->setCursor(Qt::ArrowCursor);
-#endif
     m_rubberbandSelectionManipulator.clear(),
             m_singleSelectionManipulator.clear();
     m_selectionIndicator.clear();
@@ -422,4 +421,5 @@ void LiveSelectionTool::selectUnderPoint(QMouseEvent *event)
     m_singleSelectionManipulator.end(event->pos());
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.h b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.h
index eb3c63d..f271aa8 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/liveselectiontool.h
@@ -56,6 +56,7 @@ QT_FORWARD_DECLARE_CLASS(QKeyEvent)
 QT_FORWARD_DECLARE_CLASS(QAction)
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class LiveSelectionTool : public AbstractLiveEditTool
 {
@@ -115,6 +116,7 @@ private:
     QList<QGraphicsItem*> m_contextMenuItemList;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // LIVESELECTIONTOOL_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.cpp
index 6758394..dbdcde2 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.cpp
@@ -41,11 +41,12 @@
 
 #include "livesingleselectionmanipulator.h"
 
-#include "../qdeclarativeviewinspector_p.h"
+#include "qdeclarativeviewinspector_p.h"
 
 #include <QtDebug>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 LiveSingleSelectionManipulator::LiveSingleSelectionManipulator(QDeclarativeViewInspector *editorView)
     : m_editorView(editorView),
@@ -148,4 +149,5 @@ QPointF LiveSingleSelectionManipulator::beginPoint() const
     return m_beginPoint;
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.h b/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.h
index 256a6ea..e0b4a69 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/livesingleselectionmanipulator.h
@@ -48,6 +48,7 @@
 QT_FORWARD_DECLARE_CLASS(QGraphicsItem)
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class QDeclarativeViewInspector;
 
@@ -84,6 +85,7 @@ private:
     bool m_isActive;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // LIVESINGLESELECTIONMANIPULATOR_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/qmltoolbar.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/qmltoolbar.cpp
deleted file mode 100644
index ead0e16..0000000
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/qmltoolbar.cpp
+++ /dev/null
@@ -1,328 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include "qmltoolbar.h"
-#include "toolbarcolorbox.h"
-
-#include <QtGui/QLabel>
-#include <QtGui/QIcon>
-#include <QtGui/QAction>
-#include <QtGui/QMenu>
-
-#include <QtCore/QDebug>
-
-namespace QmlJSDebugger {
-
-QmlToolBar::QmlToolBar(QWidget *parent)
-    : QToolBar(parent)
-    , m_emitSignals(true)
-    , m_paused(false)
-    , m_animationSpeed(1.0f)
-    , ui(new Ui)
-{
-    ui->playIcon = QIcon(QLatin1String(":/qml/images/play-24.png"));
-    ui->pauseIcon = QIcon(QLatin1String(":/qml/images/pause-24.png"));
-
-    ui->designmode = new QAction(QIcon(QLatin1String(":/qml/images/inspectormode-24.png")),
-                                 tr("Inspector Mode"), this);
-    ui->play = new QAction(ui->pauseIcon, tr("Play/Pause Animations"), this);
-    ui->select = new QAction(QIcon(QLatin1String(":/qml/images/select-24.png")), tr("Select"), this);
-    ui->selectMarquee = new QAction(QIcon(QLatin1String(":/qml/images/select-marquee-24.png")),
-                                    tr("Select (Marquee)"), this);
-    ui->zoom = new QAction(QIcon(QLatin1String(":/qml/images/zoom-24.png")), tr("Zoom"), this);
-    ui->colorPicker = new QAction(QIcon(QLatin1String(":/qml/images/color-picker-24.png")),
-                                  tr("Color Picker"), this);
-    ui->toQml = new QAction(QIcon(QLatin1String(":/qml/images/to-qml-24.png")),
-                            tr("Apply Changes to QML Viewer"), this);
-    ui->fromQml = new QAction(QIcon(QLatin1String(":/qml/images/from-qml-24.png")),
-                              tr("Apply Changes to Document"), this);
-    ui->designmode->setCheckable(true);
-    ui->designmode->setChecked(false);
-
-    ui->play->setCheckable(false);
-    ui->select->setCheckable(true);
-    ui->selectMarquee->setCheckable(true);
-    ui->zoom->setCheckable(true);
-    ui->colorPicker->setCheckable(true);
-
-    setWindowTitle(tr("Tools"));
-
-    addAction(ui->designmode);
-    addAction(ui->play);
-    addSeparator();
-
-    addAction(ui->select);
-    // disabled because multi selection does not do anything useful without design mode
-    //addAction(ui->selectMarquee);
-    addSeparator();
-    addAction(ui->zoom);
-    addAction(ui->colorPicker);
-    //addAction(ui->fromQml);
-
-    ui->colorBox = new ToolBarColorBox(this);
-    ui->colorBox->setMinimumSize(24, 24);
-    ui->colorBox->setMaximumSize(28, 28);
-    ui->colorBox->setColor(Qt::black);
-    addWidget(ui->colorBox);
-
-    setWindowFlags(Qt::Tool);
-
-    QMenu *playSpeedMenu = new QMenu(this);
-    ui->playSpeedMenuActions = new QActionGroup(this);
-    ui->playSpeedMenuActions->setExclusive(true);
-
-    QAction *speedAction = playSpeedMenu->addAction(tr("1x"), this, SLOT(changeAnimationSpeed()));
-    speedAction->setCheckable(true);
-    speedAction->setChecked(true);
-    speedAction->setData(1.0f);
-    ui->playSpeedMenuActions->addAction(speedAction);
-
-    speedAction = playSpeedMenu->addAction(tr("0.5x"), this, SLOT(changeAnimationSpeed()));
-    speedAction->setCheckable(true);
-    speedAction->setData(2.0f);
-    ui->playSpeedMenuActions->addAction(speedAction);
-
-    speedAction = playSpeedMenu->addAction(tr("0.25x"), this, SLOT(changeAnimationSpeed()));
-    speedAction->setCheckable(true);
-    speedAction->setData(4.0f);
-    ui->playSpeedMenuActions->addAction(speedAction);
-
-    speedAction = playSpeedMenu->addAction(tr("0.125x"), this, SLOT(changeAnimationSpeed()));
-    speedAction->setCheckable(true);
-    speedAction->setData(8.0f);
-    ui->playSpeedMenuActions->addAction(speedAction);
-
-    speedAction = playSpeedMenu->addAction(tr("0.1x"), this, SLOT(changeAnimationSpeed()));
-    speedAction->setCheckable(true);
-    speedAction->setData(10.0f);
-    ui->playSpeedMenuActions->addAction(speedAction);
-
-    ui->play->setMenu(playSpeedMenu);
-
-    connect(ui->designmode, SIGNAL(toggled(bool)), SLOT(setDesignModeBehaviorOnClick(bool)));
-
-    connect(ui->colorPicker, SIGNAL(triggered()), SLOT(activateColorPickerOnClick()));
-
-    connect(ui->play, SIGNAL(triggered()), SLOT(activatePlayOnClick()));
-
-    connect(ui->zoom, SIGNAL(triggered()), SLOT(activateZoomOnClick()));
-    connect(ui->colorPicker, SIGNAL(triggered()), SLOT(activateColorPickerOnClick()));
-    connect(ui->select, SIGNAL(triggered()), SLOT(activateSelectToolOnClick()));
-    connect(ui->selectMarquee, SIGNAL(triggered()), SLOT(activateMarqueeSelectToolOnClick()));
-
-    connect(ui->toQml, SIGNAL(triggered()), SLOT(activateToQml()));
-    connect(ui->fromQml, SIGNAL(triggered()), SLOT(activateFromQml()));
-}
-
-QmlToolBar::~QmlToolBar()
-{
-    delete ui;
-}
-
-void QmlToolBar::activateColorPicker()
-{
-    m_emitSignals = false;
-    activateColorPickerOnClick();
-    m_emitSignals = true;
-}
-
-void QmlToolBar::activateSelectTool()
-{
-    m_emitSignals = false;
-    activateSelectToolOnClick();
-    m_emitSignals = true;
-}
-
-void QmlToolBar::activateMarqueeSelectTool()
-{
-    m_emitSignals = false;
-    activateMarqueeSelectToolOnClick();
-    m_emitSignals = true;
-}
-
-void QmlToolBar::activateZoom()
-{
-    m_emitSignals = false;
-    activateZoomOnClick();
-    m_emitSignals = true;
-}
-
-void QmlToolBar::setAnimationSpeed(qreal slowDownFactor)
-{
-    if (m_animationSpeed == slowDownFactor)
-        return;
-
-    m_emitSignals = false;
-    m_animationSpeed = slowDownFactor;
-
-    foreach (QAction *action, ui->playSpeedMenuActions->actions()) {
-        if (action->data().toReal() == slowDownFactor) {
-            action->setChecked(true);
-            break;
-        }
-    }
-
-    m_emitSignals = true;
-}
-
-void QmlToolBar::setAnimationPaused(bool paused)
-{
-    if (m_paused == paused)
-        return;
-
-    m_paused = paused;
-    updatePlayAction();
-}
-
-void QmlToolBar::changeAnimationSpeed()
-{
-    QAction *action = qobject_cast<QAction*>(sender());
-    m_animationSpeed = action->data().toReal();
-    emit animationSpeedChanged(m_animationSpeed);
-}
-
-void QmlToolBar::setDesignModeBehavior(bool inDesignMode)
-{
-    m_emitSignals = false;
-    ui->designmode->setChecked(inDesignMode);
-    setDesignModeBehaviorOnClick(inDesignMode);
-    m_emitSignals = true;
-}
-
-void QmlToolBar::setDesignModeBehaviorOnClick(bool checked)
-{
-    ui->select->setEnabled(checked);
-    ui->selectMarquee->setEnabled(checked);
-    ui->zoom->setEnabled(checked);
-    ui->colorPicker->setEnabled(checked);
-    ui->toQml->setEnabled(checked);
-    ui->fromQml->setEnabled(checked);
-
-    if (m_emitSignals)
-        emit designModeBehaviorChanged(checked);
-}
-
-void QmlToolBar::setColorBoxColor(const QColor &color)
-{
-    ui->colorBox->setColor(color);
-}
-
-void QmlToolBar::activatePlayOnClick()
-{
-    m_paused = !m_paused;
-    emit animationPausedChanged(m_paused);
-    updatePlayAction();
-}
-
-void QmlToolBar::updatePlayAction()
-{
-    ui->play->setIcon(m_paused ? ui->playIcon : ui->pauseIcon);
-}
-
-void QmlToolBar::activateColorPickerOnClick()
-{
-    ui->zoom->setChecked(false);
-    ui->select->setChecked(false);
-    ui->selectMarquee->setChecked(false);
-
-    ui->colorPicker->setChecked(true);
-    if (m_activeTool != Constants::ColorPickerMode) {
-        m_activeTool = Constants::ColorPickerMode;
-        if (m_emitSignals)
-            emit colorPickerSelected();
-    }
-}
-
-void QmlToolBar::activateSelectToolOnClick()
-{
-    ui->zoom->setChecked(false);
-    ui->selectMarquee->setChecked(false);
-    ui->colorPicker->setChecked(false);
-
-    ui->select->setChecked(true);
-    if (m_activeTool != Constants::SelectionToolMode) {
-        m_activeTool = Constants::SelectionToolMode;
-        if (m_emitSignals)
-            emit selectToolSelected();
-    }
-}
-
-void QmlToolBar::activateMarqueeSelectToolOnClick()
-{
-    ui->zoom->setChecked(false);
-    ui->select->setChecked(false);
-    ui->colorPicker->setChecked(false);
-
-    ui->selectMarquee->setChecked(true);
-    if (m_activeTool != Constants::MarqueeSelectionToolMode) {
-        m_activeTool = Constants::MarqueeSelectionToolMode;
-        if (m_emitSignals)
-            emit marqueeSelectToolSelected();
-    }
-}
-
-void QmlToolBar::activateZoomOnClick()
-{
-    ui->select->setChecked(false);
-    ui->selectMarquee->setChecked(false);
-    ui->colorPicker->setChecked(false);
-
-    ui->zoom->setChecked(true);
-    if (m_activeTool != Constants::ZoomMode) {
-        m_activeTool = Constants::ZoomMode;
-        if (m_emitSignals)
-            emit zoomToolSelected();
-    }
-}
-
-void QmlToolBar::activateFromQml()
-{
-    if (m_emitSignals)
-        emit applyChangesFromQmlFileSelected();
-}
-
-void QmlToolBar::activateToQml()
-{
-    if (m_emitSignals)
-        emit applyChangesToQmlFileSelected();
-}
-
-} // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/qmltoolbar.h b/src/plugins/qmltooling/qmldbg_inspector/editor/qmltoolbar.h
deleted file mode 100644
index 3833ff2..0000000
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/qmltoolbar.h
+++ /dev/null
@@ -1,132 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef QMLTOOLBAR_H
-#define QMLTOOLBAR_H
-
-#include <QtGui/QToolBar>
-#include <QtGui/QIcon>
-
-#include "../qmlinspectorconstants.h"
-
-QT_FORWARD_DECLARE_CLASS(QActionGroup)
-
-namespace QmlJSDebugger {
-
-class ToolBarColorBox;
-
-class QmlToolBar : public QToolBar
-{
-    Q_OBJECT
-
-public:
-    explicit QmlToolBar(QWidget *parent = 0);
-    ~QmlToolBar();
-
-public slots:
-    void setDesignModeBehavior(bool inDesignMode);
-    void setColorBoxColor(const QColor &color);
-    void activateColorPicker();
-    void activateSelectTool();
-    void activateMarqueeSelectTool();
-    void activateZoom();
-
-    void setAnimationSpeed(qreal slowDownFactor);
-    void setAnimationPaused(bool paused);
-
-signals:
-    void animationSpeedChanged(qreal factor);
-    void animationPausedChanged(bool paused);
-
-    void designModeBehaviorChanged(bool inDesignMode);
-    void colorPickerSelected();
-    void selectToolSelected();
-    void marqueeSelectToolSelected();
-    void zoomToolSelected();
-
-    void applyChangesToQmlFileSelected();
-    void applyChangesFromQmlFileSelected();
-
-private slots:
-    void setDesignModeBehaviorOnClick(bool inDesignMode);
-    void activatePlayOnClick();
-    void activateColorPickerOnClick();
-    void activateSelectToolOnClick();
-    void activateMarqueeSelectToolOnClick();
-    void activateZoomOnClick();
-
-    void activateFromQml();
-    void activateToQml();
-
-    void changeAnimationSpeed();
-
-    void updatePlayAction();
-
-private:
-    class Ui {
-    public:
-        QAction *designmode;
-        QAction *play;
-        QAction *select;
-        QAction *selectMarquee;
-        QAction *zoom;
-        QAction *colorPicker;
-        QAction *toQml;
-        QAction *fromQml;
-        QIcon playIcon;
-        QIcon pauseIcon;
-        ToolBarColorBox *colorBox;
-
-        QActionGroup *playSpeedMenuActions;
-    };
-
-    bool m_emitSignals;
-    bool m_paused;
-    qreal m_animationSpeed;
-
-    Constants::DesignTool m_activeTool;
-
-    Ui *ui;
-};
-
-}
-
-#endif // QMLTOOLBAR_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.cpp
index 62b2799..4e9e91f 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.cpp
@@ -41,12 +41,13 @@
 
 #include "subcomponentmasklayeritem.h"
 
-#include "../qmlinspectorconstants.h"
-#include "../qdeclarativeviewinspector.h"
+#include "qmlinspectorconstants.h"
+#include "qdeclarativeviewinspector.h"
 
 #include <QtGui/QPolygonF>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 SubcomponentMaskLayerItem::SubcomponentMaskLayerItem(QDeclarativeViewInspector *inspector,
                                                      QGraphicsItem *parentItem) :
@@ -127,4 +128,5 @@ QGraphicsItem *SubcomponentMaskLayerItem::currentItem() const
     return m_currentItem;
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.h b/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.h
index 53864cc..f9099f9 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/subcomponentmasklayeritem.h
@@ -42,9 +42,10 @@
 #ifndef SUBCOMPONENTMASKLAYERITEM_H
 #define SUBCOMPONENTMASKLAYERITEM_H
 
-#include <QtGui/QGraphicsPolygonItem>
+#include <QtWidgets/QGraphicsPolygonItem>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class QDeclarativeViewInspector;
 
@@ -66,6 +67,7 @@ private:
     QRectF m_itemPolyRect;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // SUBCOMPONENTMASKLAYERITEM_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/toolbarcolorbox.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/toolbarcolorbox.cpp
deleted file mode 100644
index 6c56acd..0000000
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/toolbarcolorbox.cpp
+++ /dev/null
@@ -1,134 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include "toolbarcolorbox.h"
-
-#include "../qmlinspectorconstants.h"
-
-#include <QtGui/QPixmap>
-#include <QtGui/QPainter>
-#include <QtGui/QMenu>
-#include <QtGui/QAction>
-#include <QtGui/QContextMenuEvent>
-#include <QtGui/QClipboard>
-#include <QtGui/QApplication>
-#include <QtGui/QColorDialog>
-#include <QtGui/QDrag>
-
-#include <QtCore/QMimeData>
-#include <QtCore/QDebug>
-
-namespace QmlJSDebugger {
-
-ToolBarColorBox::ToolBarColorBox(QWidget *parent) :
-    QLabel(parent)
-{
-    m_copyHexColor = new QAction(QIcon(QLatin1String(":/qml/images/color-picker-hicontrast.png")),
-                                 tr("Copy Color"), this);
-    connect(m_copyHexColor, SIGNAL(triggered()), SLOT(copyColorToClipboard()));
-    setScaledContents(false);
-}
-
-void ToolBarColorBox::setColor(const QColor &color)
-{
-    m_color = color;
-
-    QPixmap pix = createDragPixmap(width());
-    setPixmap(pix);
-    update();
-}
-
-void ToolBarColorBox::mousePressEvent(QMouseEvent *event)
-{
-    m_dragBeginPoint = event->pos();
-    m_dragStarted = false;
-}
-
-void ToolBarColorBox::mouseMoveEvent(QMouseEvent *event)
-{
-
-    if (event->buttons() & Qt::LeftButton
-            && (QPoint(event->pos() - m_dragBeginPoint).manhattanLength()
-                > Constants::DragStartDistance)
-            && !m_dragStarted)
-    {
-        m_dragStarted = true;
-        QDrag *drag = new QDrag(this);
-        QMimeData *mimeData = new QMimeData;
-
-        mimeData->setText(m_color.name());
-        drag->setMimeData(mimeData);
-        drag->setPixmap(createDragPixmap());
-
-        drag->exec();
-    }
-}
-
-QPixmap ToolBarColorBox::createDragPixmap(int size) const
-{
-    QPixmap pix(size, size);
-    QPainter p(&pix);
-
-    QColor borderColor1 = QColor(143, 143 ,143);
-    QColor borderColor2 = QColor(43, 43, 43);
-
-    p.setBrush(QBrush(m_color));
-    p.setPen(QPen(QBrush(borderColor2),1));
-
-    p.fillRect(0, 0, size, size, borderColor1);
-    p.drawRect(1,1, size - 3, size - 3);
-    return pix;
-}
-
-void ToolBarColorBox::contextMenuEvent(QContextMenuEvent *ev)
-{
-    QMenu contextMenu;
-    contextMenu.addAction(m_copyHexColor);
-    contextMenu.exec(ev->globalPos());
-}
-
-void ToolBarColorBox::copyColorToClipboard()
-{
-    QClipboard *clipboard = QApplication::clipboard();
-    clipboard->setText(m_color.name());
-}
-
-} // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/toolbarcolorbox.h b/src/plugins/qmltooling/qmldbg_inspector/editor/toolbarcolorbox.h
deleted file mode 100644
index bc39fb4..0000000
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/toolbarcolorbox.h
+++ /dev/null
@@ -1,81 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef TOOLBARCOLORBOX_H
-#define TOOLBARCOLORBOX_H
-
-#include <QtGui/QLabel>
-#include <QtGui/QColor>
-#include <QtCore/QPoint>
-
-QT_FORWARD_DECLARE_CLASS(QContextMenuEvent)
-QT_FORWARD_DECLARE_CLASS(QAction)
-
-namespace QmlJSDebugger {
-
-class ToolBarColorBox : public QLabel
-{
-    Q_OBJECT
-
-public:
-    explicit ToolBarColorBox(QWidget *parent = 0);
-    void setColor(const QColor &color);
-
-protected:
-    void contextMenuEvent(QContextMenuEvent *ev);
-    void mousePressEvent(QMouseEvent *ev);
-    void mouseMoveEvent(QMouseEvent *ev);
-private slots:
-    void copyColorToClipboard();
-
-private:
-    QPixmap createDragPixmap(int size = 24) const;
-
-private:
-    bool m_dragStarted;
-    QPoint m_dragBeginPoint;
-    QAction *m_copyHexColor;
-    QColor m_color;
-};
-
-} // namespace QmlJSDebugger
-
-#endif // TOOLBARCOLORBOX_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.cpp b/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.cpp
index 3e41b3b..69d1f48 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.cpp
@@ -41,18 +41,19 @@
 
 #include "zoomtool.h"
 
-#include "../qdeclarativeviewinspector_p.h"
+#include "qdeclarativeviewinspector_p.h"
 
 #include <QtGui/QMouseEvent>
 #include <QtGui/QWheelEvent>
 #include <QtGui/QKeyEvent>
-#include <QtGui/QMenu>
-#include <QtGui/QAction>
+#include <QtWidgets/QMenu>
+#include <QtWidgets/QAction>
 
 #include <QtCore/QRectF>
 #include <QtCore/QDebug>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 ZoomTool::ZoomTool(QDeclarativeViewInspector *view) :
     AbstractLiveEditTool(view),
@@ -151,7 +152,7 @@ void ZoomTool::mouseReleaseEvent(QMouseEvent *event)
         view()->setSceneRect(sceneArea);
     } else {
         Qt::KeyboardModifier modifierKey = Qt::ControlModifier;
-#ifdef Q_WS_MAC
+#ifdef Q_OS_MAC
         modifierKey = Qt::AltModifier;
 #endif
         if (event->modifiers() & modifierKey) {
@@ -244,9 +245,7 @@ void ZoomTool::keyReleaseEvent(QKeyEvent *event)
 
 void ZoomTool::clear()
 {
-#ifndef QT_NO_CURSOR
     view()->setCursor(Qt::ArrowCursor);
-#endif
 }
 
 void ZoomTool::scaleView(const QPointF &centerPos)
@@ -327,4 +326,5 @@ qreal ZoomTool::nextZoomScale(ZoomDirection direction) const
     return 1.0f;
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.h b/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.h
index d5c4055..76bf189 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/editor/zoomtool.h
@@ -48,6 +48,7 @@
 QT_FORWARD_DECLARE_CLASS(QAction)
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class ZoomTool : public AbstractLiveEditTool
 {
@@ -102,6 +103,7 @@ private:
     qreal m_currentScale;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // ZOOMTOOL_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeinspectorplugin.cpp b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeinspectorplugin.cpp
deleted file mode 100644
index 1b74caf..0000000
--- a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeinspectorplugin.cpp
+++ /dev/null
@@ -1,80 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include "qdeclarativeinspectorplugin.h"
-
-#include "qdeclarativeviewinspector_p.h"
-
-#include <QtCore/qplugin.h>
-#include <QtDeclarative/private/qdeclarativeinspectorservice_p.h>
-
-namespace QmlJSDebugger {
-
-QDeclarativeInspectorPlugin::QDeclarativeInspectorPlugin() :
-    m_inspector(0)
-{
-}
-
-QDeclarativeInspectorPlugin::~QDeclarativeInspectorPlugin()
-{
-    delete m_inspector;
-}
-
-void QDeclarativeInspectorPlugin::activate()
-{
-    QDeclarativeInspectorService *service = QDeclarativeInspectorService::instance();
-    QList<QDeclarativeView*> views = service->views();
-    if (views.isEmpty())
-        return;
-
-    // TODO: Support multiple views
-    QDeclarativeView *view = service->views().at(0);
-    m_inspector = new QDeclarativeViewInspector(view, view);
-}
-
-void QDeclarativeInspectorPlugin::deactivate()
-{
-    delete m_inspector;
-}
-
-} // namespace QmlJSDebugger
-
-Q_EXPORT_PLUGIN2(declarativeinspector, QmlJSDebugger::QDeclarativeInspectorPlugin)
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeinspectorplugin.h b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeinspectorplugin.h
deleted file mode 100644
index a910edc..0000000
--- a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeinspectorplugin.h
+++ /dev/null
@@ -1,71 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef QDECLARATIVEINSPECTORPLUGIN_H
-#define QDECLARATIVEINSPECTORPLUGIN_H
-
-#include <QtCore/QPointer>
-#include <QtDeclarative/private/qdeclarativeinspectorinterface_p.h>
-
-namespace QmlJSDebugger {
-
-class AbstractViewInspector;
-
-class QDeclarativeInspectorPlugin : public QObject, public QDeclarativeInspectorInterface
-{
-    Q_OBJECT
-    Q_DISABLE_COPY(QDeclarativeInspectorPlugin)
-    Q_INTERFACES(QDeclarativeInspectorInterface)
-
-public:
-    QDeclarativeInspectorPlugin();
-    ~QDeclarativeInspectorPlugin();
-
-    void activate();
-    void deactivate();
-
-private:
-    QPointer<AbstractViewInspector> m_inspector;
-};
-
-} // namespace QmlJSDebugger
-
-#endif // QDECLARATIVEINSPECTORPLUGIN_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.cpp b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.cpp
index d8696c5..0293b72 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.cpp
+++ b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.cpp
@@ -48,12 +48,11 @@
 #include "editor/livelayeritem.h"
 #include "editor/boundingrecthighlighter.h"
 
-#include <QtDeclarative/QDeclarativeItem>
-#include <QtGui/QWidget>
+#include <QtQuick1/QDeclarativeItem>
 #include <QtGui/QMouseEvent>
-#include <QtGui/QGraphicsObject>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 QDeclarativeViewInspectorPrivate::QDeclarativeViewInspectorPrivate(QDeclarativeViewInspector *q) :
     q(q)
@@ -138,6 +137,17 @@ void QDeclarativeViewInspector::changeTool(InspectorProtocol::Tool tool)
     }
 }
 
+Qt::WindowFlags QDeclarativeViewInspector::windowFlags() const
+{
+    return declarativeView()->window()->windowFlags();
+}
+
+void QDeclarativeViewInspector::setWindowFlags(Qt::WindowFlags flags)
+{
+    declarativeView()->window()->setWindowFlags(flags);
+    declarativeView()->window()->show();
+}
+
 AbstractLiveEditTool *QDeclarativeViewInspector::currentTool() const
 {
     return static_cast<AbstractLiveEditTool*>(AbstractViewInspector::currentTool());
@@ -433,4 +443,5 @@ QRectF QDeclarativeViewInspector::adjustToScreenBoundaries(const QRectF &boundin
     return boundingRect;
 }
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.h b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.h
index 5fbf6c6..398ae88 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector.h
@@ -44,13 +44,13 @@
 
 #include <private/qdeclarativeglobal_p.h>
 
-#include "qmlinspectorconstants.h"
 #include "abstractviewinspector.h"
 
 #include <QtCore/QScopedPointer>
-#include <QtDeclarative/QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class AbstractLiveEditTool;
 class QDeclarativeViewInspectorPrivate;
@@ -68,7 +68,8 @@ public:
     void reloadView();
     void reparentQmlObject(QObject *object, QObject *newParent);
     void changeTool(InspectorProtocol::Tool tool);
-    QWidget *viewWidget() const { return declarativeView(); }
+    Qt::WindowFlags windowFlags() const;
+    void setWindowFlags(Qt::WindowFlags flags);
     QDeclarativeEngine *declarativeEngine() const;
 
     void setSelectedItems(QList<QGraphicsItem *> items);
@@ -95,6 +96,7 @@ private:
     friend class AbstractLiveEditTool;
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // QDECLARATIVEVIEWINSPECTOR_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector_p.h b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector_p.h
index 7093e4f..48c09aa 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector_p.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/qdeclarativeviewinspector_p.h
@@ -44,12 +44,15 @@
 
 #include "qdeclarativeviewinspector.h"
 
+#include <QtCore/QScopedPointer>
+#include <QtQuick1/QDeclarativeView>
 #include <QtCore/QWeakPointer>
 #include <QtCore/QPointF>
 
-#include "QtDeclarative/private/qdeclarativeinspectorservice_p.h"
+#include <QtQuick1/private/qdeclarativeinspectorservice_p.h>
 
 namespace QmlJSDebugger {
+namespace QtQuick1 {
 
 class QDeclarativeViewInspector;
 class LiveSelectionTool;
@@ -112,6 +115,7 @@ public:
     static QDeclarativeViewInspectorPrivate *get(QDeclarativeViewInspector *v) { return v->d_func(); }
 };
 
+} // namespace QtQuick1
 } // namespace QmlJSDebugger
 
 #endif // QDECLARATIVEVIEWINSPECTOR_P_H
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro b/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro
index e441a78..629cade 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro
+++ b/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro
@@ -1,14 +1,14 @@
 TARGET = qmldbg_inspector
-QT       += declarative
+QT       += quick1 quick1-private gui widgets core-private
 
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR  = $$QT_BUILD_TREE/plugins/qmltooling
-QTDIR_build:REQUIRES += "contains(QT_CONFIG, declarative)"
+QTDIR_build:REQUIRES += "contains(QT_CONFIG, quick1)"
 
 SOURCES += \
+    qtquick1plugin.cpp \
     abstractviewinspector.cpp \
-    qdeclarativeinspectorplugin.cpp \
     qdeclarativeviewinspector.cpp \
     editor/abstractliveedittool.cpp \
     editor/liveselectiontool.cpp \
@@ -24,8 +24,8 @@ SOURCES += \
     abstracttool.cpp
 
 HEADERS += \
+    qtquick1plugin.h \
     abstractviewinspector.h \
-    qdeclarativeinspectorplugin.h \
     qdeclarativeinspectorprotocol.h \
     qdeclarativeviewinspector.h \
     qdeclarativeviewinspector_p.h \
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qmlinspectorconstants.h b/src/plugins/qmltooling/qmldbg_inspector/qmlinspectorconstants.h
index 7377bc6..93c12ea 100644
--- a/src/plugins/qmltooling/qmldbg_inspector/qmlinspectorconstants.h
+++ b/src/plugins/qmltooling/qmldbg_inspector/qmlinspectorconstants.h
@@ -42,7 +42,7 @@
 #ifndef QMLINSPECTORCONSTANTS_H
 #define QMLINSPECTORCONSTANTS_H
 
-#include <QtDeclarative/private/qdeclarativeglobal_p.h>
+#include <QtQuick1/private/qdeclarativeglobal_p.h>
 
 namespace QmlJSDebugger {
 namespace Constants {
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qtquick1plugin.cpp b/src/plugins/qmltooling/qmldbg_inspector/qtquick1plugin.cpp
new file mode 100644
index 0000000..2008338
--- /dev/null
+++ b/src/plugins/qmltooling/qmldbg_inspector/qtquick1plugin.cpp
@@ -0,0 +1,93 @@
+/****************************************************************************
+**
+** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
+** All rights reserved.
+** Contact: Nokia Corporation (qt-info@nokia.com)
+**
+** This file is part of the QtDeclarative module of the Qt Toolkit.
+**
+** $QT_BEGIN_LICENSE:LGPL$
+** GNU Lesser General Public License Usage
+** This file may be used under the terms of the GNU Lesser General Public
+** License version 2.1 as published by the Free Software Foundation and
+** appearing in the file LICENSE.LGPL included in the packaging of this
+** file. Please review the following information to ensure the GNU Lesser
+** General Public License version 2.1 requirements will be met:
+** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
+**
+** In addition, as a special exception, Nokia gives you certain additional
+** rights. These rights are described in the Nokia Qt LGPL Exception
+** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
+**
+** GNU General Public License Usage
+** Alternatively, this file may be used under the terms of the GNU General
+** Public License version 3.0 as published by the Free Software Foundation
+** and appearing in the file LICENSE.GPL included in the packaging of this
+** file. Please review the following information to ensure the GNU General
+** Public License version 3.0 requirements will be met:
+** http://www.gnu.org/copyleft/gpl.html.
+**
+** Other Usage
+** Alternatively, this file may be used in accordance with the terms and
+** conditions contained in a signed written agreement between you and Nokia.
+**
+**
+**
+**
+**
+** $QT_END_LICENSE$
+**
+****************************************************************************/
+
+#include "qtquick1plugin.h"
+#include "qdeclarativeviewinspector.h"
+
+#include <QtCore/qplugin.h>
+#include <QtQuick1/private/qdeclarativeinspectorservice_p.h>
+#include <QtQuick1/qdeclarativeview.h>
+
+namespace QmlJSDebugger {
+namespace QtQuick1 {
+
+QtQuick1Plugin::QtQuick1Plugin() :
+    m_inspector(0)
+{
+}
+
+QtQuick1Plugin::~QtQuick1Plugin()
+{
+    delete m_inspector;
+}
+
+bool QtQuick1Plugin::canHandleView(QObject *view)
+{
+    return qobject_cast<QDeclarativeView*>(view);
+}
+
+void QtQuick1Plugin::activate()
+{
+    QDeclarativeInspectorService *service = QDeclarativeInspectorService::instance();
+    QList<QDeclarativeView*> views = service->views();
+    if (views.isEmpty())
+        return;
+
+    // TODO: Support multiple views
+    QDeclarativeView *view = service->views().at(0);
+    m_inspector = new QDeclarativeViewInspector(view, view);
+}
+
+void QtQuick1Plugin::deactivate()
+{
+    delete m_inspector;
+}
+
+void QtQuick1Plugin::clientMessage(const QByteArray &message)
+{
+    if (m_inspector)
+        m_inspector->handleMessage(message);
+}
+
+} // namespace QtQuick1
+} // namespace QmlJSDebugger
+
+Q_EXPORT_PLUGIN2(qmldbg_qtquick1, QmlJSDebugger::QtQuick1::QtQuick1Plugin)
diff --git a/src/plugins/qmltooling/qmldbg_inspector/qtquick1plugin.h b/src/plugins/qmltooling/qmldbg_inspector/qtquick1plugin.h
new file mode 100644
index 0000000..902306b
--- /dev/null
+++ b/src/plugins/qmltooling/qmldbg_inspector/qtquick1plugin.h
@@ -0,0 +1,77 @@
+/****************************************************************************
+**
+** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
+** All rights reserved.
+** Contact: Nokia Corporation (qt-info@nokia.com)
+**
+** This file is part of the QtDeclarative module of the Qt Toolkit.
+**
+** $QT_BEGIN_LICENSE:LGPL$
+** GNU Lesser General Public License Usage
+** This file may be used under the terms of the GNU Lesser General Public
+** License version 2.1 as published by the Free Software Foundation and
+** appearing in the file LICENSE.LGPL included in the packaging of this
+** file. Please review the following information to ensure the GNU Lesser
+** General Public License version 2.1 requirements will be met:
+** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
+**
+** In addition, as a special exception, Nokia gives you certain additional
+** rights. These rights are described in the Nokia Qt LGPL Exception
+** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
+**
+** GNU General Public License Usage
+** Alternatively, this file may be used under the terms of the GNU General
+** Public License version 3.0 as published by the Free Software Foundation
+** and appearing in the file LICENSE.GPL included in the packaging of this
+** file. Please review the following information to ensure the GNU General
+** Public License version 3.0 requirements will be met:
+** http://www.gnu.org/copyleft/gpl.html.
+**
+** Other Usage
+** Alternatively, this file may be used in accordance with the terms and
+** conditions contained in a signed written agreement between you and Nokia.
+**
+**
+**
+**
+**
+** $QT_END_LICENSE$
+**
+****************************************************************************/
+
+#ifndef QDECLARATIVEINSPECTORPLUGIN_H
+#define QDECLARATIVEINSPECTORPLUGIN_H
+
+#include <QtCore/QPointer>
+#include <QtQuick1/private/qdeclarativeinspectorinterface_p.h>
+
+namespace QmlJSDebugger {
+
+class AbstractViewInspector;
+
+namespace QtQuick1 {
+
+class QtQuick1Plugin : public QObject, public QDeclarativeInspectorInterface
+{
+    Q_OBJECT
+    Q_DISABLE_COPY(QtQuick1Plugin)
+    Q_INTERFACES(QDeclarativeInspectorInterface)
+
+public:
+    QtQuick1Plugin();
+    ~QtQuick1Plugin();
+
+    // QDeclarativeInspectorInterface
+    bool canHandleView(QObject *view);
+    void activate();
+    void deactivate();
+    void clientMessage(const QByteArray &message);
+
+private:
+    QPointer<AbstractViewInspector> m_inspector;
+};
+
+} // namespace QtQuick1
+} // namespace QmlJSDebugger
+
+#endif // QDECLARATIVEINSPECTORPLUGIN_H
diff --git a/src/plugins/qmltooling/qmldbg_ost/qmldbg_ost.pro b/src/plugins/qmltooling/qmldbg_ost/qmldbg_ost.pro
deleted file mode 100644
index 2748889..0000000
--- a/src/plugins/qmltooling/qmldbg_ost/qmldbg_ost.pro
+++ /dev/null
@@ -1,21 +0,0 @@
-TARGET = qmldbg_ost
-QT       += declarative network
-
-include(../../qpluginbase.pri)
-
-QTDIR_build:DESTDIR  = $$QT_BUILD_TREE/plugins/qmltooling
-QTDIR_build:REQUIRES += "contains(QT_CONFIG, declarative)"
-
-SOURCES += \
-    qmlostplugin.cpp \
-	qostdevice.cpp
-
-HEADERS += \
-    qmlostplugin.h \
-    qostdevice.h \
-    usbostcomm.h
-
-target.path += $$[QT_INSTALL_PLUGINS]/qmltooling
-INSTALLS += target
-
-symbian:TARGET.UID3=0x20031E92
diff --git a/src/plugins/qmltooling/qmldbg_ost/qmlostplugin.cpp b/src/plugins/qmltooling/qmldbg_ost/qmlostplugin.cpp
deleted file mode 100644
index d999de4..0000000
--- a/src/plugins/qmltooling/qmldbg_ost/qmlostplugin.cpp
+++ /dev/null
@@ -1,149 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include "qmlostplugin.h"
-#include "qostdevice.h"
-
-#include <private/qdeclarativedebugserver_p.h>
-#include <private/qpacketprotocol_p.h>
-
-QT_BEGIN_NAMESPACE
-
-static const TInt KQmlOstProtocolId = 0x94;
-
-class QmlOstPluginPrivate {
-public:
-    QmlOstPluginPrivate();
-
-    QOstDevice *ost;
-    QPacketProtocol *protocol;
-    QDeclarativeDebugServer *debugServer;
-};
-
-QmlOstPluginPrivate::QmlOstPluginPrivate() :
-    ost(0),
-    protocol(0),
-    debugServer(0)
-{
-}
-
-QmlOstPlugin::QmlOstPlugin() :
-    d_ptr(new QmlOstPluginPrivate)
-{
-}
-
-QmlOstPlugin::~QmlOstPlugin()
-{
-    delete d_ptr;
-}
-
-void QmlOstPlugin::setServer(QDeclarativeDebugServer *server)
-{
-    Q_D(QmlOstPlugin);
-    d->debugServer = server;
-}
-
-bool QmlOstPlugin::isConnected() const
-{
-    Q_D(const QmlOstPlugin);
-    return d->ost && d->ost->isOpen();
-}
-
-void QmlOstPlugin::send(const QByteArray &message)
-{
-    Q_D(QmlOstPlugin);
-
-    if (!isConnected())
-        return;
-
-    QPacket pack;
-    pack.writeRawData(message.data(), message.length());
-
-    d->protocol->send(pack);
-    //d->socket->flush();
-}
-
-void QmlOstPlugin::disconnect()
-{
-    Q_D(QmlOstPlugin);
-
-    delete d->protocol;
-    d->protocol = 0;
-}
-
-bool QmlOstPlugin::waitForMessage()
-{
-    Q_D(QmlOstPlugin);
-    return d->protocol->waitForReadyRead(-1);
-}
-
-void QmlOstPlugin::setPort(int port, bool block)
-{
-    Q_UNUSED(port);
-    Q_UNUSED(block);
-
-    Q_D(QmlOstPlugin);
-
-    d->ost = new QOstDevice(this);
-    bool ok = d->ost->open(KQmlOstProtocolId);
-    if (!ok) {
-        if (d->ost->errorString().length())
-            qDebug("Error from QOstDevice: %s", qPrintable(d->ost->errorString()));
-        qWarning("QDeclarativeDebugServer: Unable to listen on OST"); // This message is part of the signalling - do not change the format!
-        return;
-    }
-    d->protocol = new QPacketProtocol(d->ost, this);
-    QObject::connect(d->protocol, SIGNAL(readyRead()), this, SLOT(readyRead()));
-    qWarning("QDeclarativeDebugServer: Waiting for connection via OST"); // This message is part of the signalling - do not change the format!
-}
-
-void QmlOstPlugin::readyRead()
-{
-    Q_D(QmlOstPlugin);
-    QPacket packet = d->protocol->read();
-
-    QByteArray content = packet.data();
-    d->debugServer->receiveMessage(content);
-}
-
-Q_EXPORT_PLUGIN2(qmlostplugin, QmlOstPlugin)
-
-QT_END_NAMESPACE
diff --git a/src/plugins/qmltooling/qmldbg_ost/qmlostplugin.h b/src/plugins/qmltooling/qmldbg_ost/qmlostplugin.h
deleted file mode 100644
index dc32e2e..0000000
--- a/src/plugins/qmltooling/qmldbg_ost/qmlostplugin.h
+++ /dev/null
@@ -1,82 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef QMLOSTPLUGIN_H
-#define QMLOSTPLUGIN_H
-
-#include <QtGui/QStylePlugin>
-#include <QtDeclarative/private/qdeclarativedebugserverconnection_p.h>
-
-QT_BEGIN_NAMESPACE
-
-class QDeclarativeDebugServer;
-class QmlOstPluginPrivate;
-
-class QmlOstPlugin : public QObject, public QDeclarativeDebugServerConnection
-{
-    Q_OBJECT
-    Q_DECLARE_PRIVATE(QmlOstPlugin)
-    Q_DISABLE_COPY(QmlOstPlugin)
-    Q_INTERFACES(QDeclarativeDebugServerConnection)
-
-
-public:
-    QmlOstPlugin();
-    ~QmlOstPlugin();
-
-    void setServer(QDeclarativeDebugServer *server);
-    void setPort(int port, bool bock);
-
-    bool isConnected() const;
-    void send(const QByteArray &message);
-    void disconnect();
-    bool waitForMessage();
-
-private Q_SLOTS:
-    void readyRead();
-
-private:
-    QmlOstPluginPrivate *d_ptr;
-};
-
-QT_END_NAMESPACE
-
-#endif // QMLOSTPLUGIN_H
diff --git a/src/plugins/qmltooling/qmldbg_ost/qostdevice.cpp b/src/plugins/qmltooling/qmldbg_ost/qostdevice.cpp
deleted file mode 100644
index 3103058..0000000
--- a/src/plugins/qmltooling/qmldbg_ost/qostdevice.cpp
+++ /dev/null
@@ -1,220 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include "qostdevice.h"
-#include <e32base.h>
-
-#include "usbostcomm.h"
-
-class QOstDevicePrivate : public CActive
-{
-    QOstDevice* q_ptr;
-    Q_DECLARE_PUBLIC(QOstDevice)
-
-public:
-    QOstDevicePrivate() : CActive(CActive::EPriorityStandard) {
-        CActiveScheduler::Add(this);
-    }
-    ~QOstDevicePrivate() {
-        Cancel();
-    }
-
-    TInt& AoFlags() { return ((TInt*)&iStatus)[1]; }
-
-private:
-    void RunL();
-    void DoCancel();
-
-private:
-    RUsbOstComm ost;
-    TBuf8<4096> readBuf;
-    QByteArray dataBuf;
-    TBool inReadyRead;
-};
-
-QOstDevice::QOstDevice(QObject *parent) :
-    QIODevice(parent), d_ptr(new QOstDevicePrivate)
-{
-    d_ptr->q_ptr = this;
-}
-
-QOstDevice::~QOstDevice()
-{
-    close();
-    delete d_ptr;
-}
-
-bool QOstDevice::open(int ostProtocolId)
-{
-    if (isOpen())
-        return false;
-
-    Q_D(QOstDevice);
-    TInt err = d->ost.Connect();
-    if (!err) err = d->ost.Open();
-    const TVersion KRequiredVersion(1,1,0);
-    TVersion version = d->ost.Version();
-    if (version.iMajor < KRequiredVersion.iMajor ||
-            (version.iMajor == KRequiredVersion.iMajor && version.iMinor < KRequiredVersion.iMinor)) {
-        setErrorString("CODA version too old. At least version 4.0.18 (without TRK) is required.");
-        return false;
-    }
-
-    if (!err) err = d->ost.RegisterProtocolID((TOstProtIds)ostProtocolId, EFalse);
-    if (!err) {
-        d->ost.ReadMessage(d->iStatus, d->readBuf);
-        d->SetActive();
-        return QIODevice::open(ReadWrite | Unbuffered);
-    }
-    return false;
-}
-
-void QOstDevicePrivate::RunL()
-{
-    Q_Q(QOstDevice);
-    //qDebug("QOstDevice received %d bytes q=%x", readBuf.Size(), q);
-    if (iStatus == KErrNone) {
-        QByteArray data = QByteArray::fromRawData((const char*)readBuf.Ptr(), readBuf.Size());
-        dataBuf.append(data);
-
-        readBuf.Zero();
-        ost.ReadMessage(iStatus, readBuf);
-        SetActive();
-
-        if (!inReadyRead) {
-            inReadyRead = true;
-            emit q->readyRead();
-            inReadyRead = false;
-        }
-    } else {
-        q->setErrorString(QString("Error %1 from RUsbOstComm::ReadMessage()").arg(iStatus.Int()));
-    }
-    //qDebug("-QOstDevicePrivate RunL");
-}
-
-void QOstDevicePrivate::DoCancel()
-{
-    ost.ReadCancel();
-}
-
-void QOstDevice::close()
-{
-    Q_D(QOstDevice);
-    QIODevice::close();
-    d->Cancel();
-    // RDbgTrcComm::Close isn't safe to call when not open, sigh
-    if (d->ost.Handle()) {
-        d->ost.Close();
-    }
-}
-
-qint64 QOstDevice::readData(char *data, qint64 maxSize)
-{
-    Q_D(QOstDevice);
-    if (d->dataBuf.length() == 0 && !d->IsActive())
-        return -1;
-    qint64 available = qMin(maxSize, (qint64)d->dataBuf.length());
-    memcpy(data, d->dataBuf.constData(), available);
-    d->dataBuf.remove(0, available);
-    return available;
-}
-
-static const TInt KMaxOstPacketLen = 4096;
-
-qint64 QOstDevice::writeData(const char *data, qint64 maxSize)
-{
-    Q_D(QOstDevice);
-    TPtrC8 ptr((const TUint8*)data, (TInt)maxSize);
-    while (ptr.Length()) {
-        TPtrC8 fragment = ptr.Left(qMin(ptr.Length(), KMaxOstPacketLen));
-        //qDebug("QOstDevice writing %d bytes", fragment.Length());
-        TRequestStatus stat;
-        d->ost.WriteMessage(stat, fragment);
-        User::WaitForRequest(stat);
-        if (stat.Int() != KErrNone) {
-            setErrorString(QString("Error %1 from RUsbOstComm::WriteMessage()").arg(stat.Int()));
-            return -1;
-        }
-        ptr.Set(ptr.Mid(fragment.Length()));
-    }
-    emit bytesWritten(maxSize); //TODO does it matter this is emitted synchronously?
-    //qDebug("QOstDevice wrote %d bytes", ptr.Size());
-    return maxSize;
-}
-
-qint64 QOstDevice::bytesAvailable() const
-{
-    Q_D(const QOstDevice);
-    return d->dataBuf.length();
-}
-
-bool QOstDevice::waitForReadyRead(int msecs)
-{
-    Q_D(QOstDevice);
-    if (msecs >= 0) {
-        RTimer timer;
-        TInt err = timer.CreateLocal();
-        if (err) return false;
-        TRequestStatus timeoutStat;
-        timer.After(timeoutStat, msecs*1000);
-        User::WaitForRequest(timeoutStat, d->iStatus);
-        if (timeoutStat != KRequestPending) {
-            // Timed out
-            timer.Close();
-            return false;
-        } else {
-            // We got data, so cancel timer
-            timer.Cancel();
-            User::WaitForRequest(timeoutStat);
-            timer.Close();
-            // And drop through
-        }
-    } else {
-        // Just wait forever for data
-        User::WaitForRequest(d->iStatus);
-    }
-
-    // If we get here we have data
-    TInt err = d->iStatus.Int();
-    d->AoFlags() &= ~3; // This is necessary to clean up the scheduler as you're not supposed to bypass it like this
-    TRAP_IGNORE(d->RunL());
-    return err == KErrNone;
-}
diff --git a/src/plugins/qmltooling/qmldbg_ost/qostdevice.h b/src/plugins/qmltooling/qmldbg_ost/qostdevice.h
deleted file mode 100644
index 0601bc3..0000000
--- a/src/plugins/qmltooling/qmldbg_ost/qostdevice.h
+++ /dev/null
@@ -1,77 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef QOSTDEVICE_H
-#define QOSTDEVICE_H
-
-#include <QtCore/QIODevice>
-
-QT_BEGIN_NAMESPACE
-
-class QOstDevicePrivate;
-
-class QOstDevice : public QIODevice
-{
-    Q_OBJECT
-    Q_DECLARE_PRIVATE(QOstDevice)
-    Q_DISABLE_COPY(QOstDevice)
-
-public:
-    explicit QOstDevice(QObject *parent=0);
-    ~QOstDevice();
-
-    bool open(int ostProtocolId);
-    void close();
-
-    bool waitForReadyRead(int msecs);
-    qint64 bytesAvailable() const;
-
-protected:
-    qint64 readData(char *data, qint64 maxSize);
-    qint64 writeData(const char *data, qint64 maxSize);
-
-private:
-    QOstDevicePrivate* d_ptr;
-};
-
-QT_END_NAMESPACE
-
-#endif // QOSTDEVICE_H
diff --git a/src/plugins/qmltooling/qmldbg_ost/usbostcomm.h b/src/plugins/qmltooling/qmldbg_ost/usbostcomm.h
deleted file mode 100644
index 552543b..0000000
--- a/src/plugins/qmltooling/qmldbg_ost/usbostcomm.h
+++ /dev/null
@@ -1,191 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef USBHOSTCOMM_H
-#define USBHOSTCOMM_H
-
-// Based on the official usbostrouter header, modified to remove dependancy on
-// the client DLL
-
-#include <e32base.h>
-
-typedef int TOstProtIds;
-
-class RUsbOstComm : public RSessionBase
-{
-public:
-    RUsbOstComm();
-    TInt Connect();
-    TInt Disconnect();
-    TInt Open();
-    TInt Close();
-    TInt RegisterProtocolID(TOstProtIds aId, TBool aNeedHeader);
-    void ReadMessage(TRequestStatus& aStatus, TDes8& aDes);
-    TInt ReadCancel();
-    void WriteMessage(TRequestStatus& aStatus, const TDesC8& aDes, TBool aHasHeader=EFalse);
-    TVersion Version() const;
-
-private:
-    enum TUsbOstCmdCode
-    {
-        EUsbOstCmdCodeFirst,
-        EUsbOstCmdConnect,
-        EUsbOstCmdDisconnect,
-        EUsbOstCmdCodeGetAcmConfig,
-        EUsbOstCmdCodeSetAcmConfig,
-        EUsbOstCmdCodeOpen,
-        EUsbOstCmdCodeClose,
-        EUsbOstCmdCodeRegisterId,
-        EUsbOstCmdCodeRegisterIds,
-        EUsbOstCmdCodeUnRegisterId,
-        EUsbOstCmdCodeUnRegisterIds,
-        EUsbOstCmdCodeReadMsg,
-        EUsbOstCmdCodeReadCancel,
-        EUsbOstCmdCodeWriteMsg,
-        EUsbOstCmdCodeWriteCancel,
-        EUsbOstCmdCodeLast
-    };
-};
-
-RUsbOstComm::RUsbOstComm()
-{
-}
-
-TInt RUsbOstComm::Connect()
-{
-    _LIT(KUsbOstServerName, "!UsbOstRouter");
-    _LIT(KUsbOstServerImageName, "usbostrouter");
-    const TUid KUsbOstServerUid = { 0x200170BE };
-    TInt startupAttempts = 2;
-    for(;;) {
-        TInt ret = CreateSession(KUsbOstServerName, TVersion(1,0,0));
-        if (ret != KErrNotFound && ret != KErrServerTerminated) {
-            return ret;
-        }
-
-        if (startupAttempts-- == 0) {
-            return ret;
-        }
-
-        RProcess server;
-        ret = server.Create(KUsbOstServerImageName, KNullDesC, KUsbOstServerUid);
-        if (ret != KErrNone)
-            return ret;
-
-        TRequestStatus serverDiedRequestStatus;
-        server.Rendezvous(serverDiedRequestStatus);
-
-        if (serverDiedRequestStatus != KRequestPending) {
-            // Abort startup
-            server.Kill(KErrNone);
-        } else {
-            // Logon OK - start the server
-            server.Resume();
-        }
-        User::WaitForRequest(serverDiedRequestStatus);
-        ret = (server.ExitType() == EExitPanic) ? KErrGeneral : serverDiedRequestStatus.Int();
-        server.Close();
-
-        if (ret != KErrNone && ret != KErrAlreadyExists) {
-            return ret;
-        }
-    }
-}
-
-TInt RUsbOstComm::Disconnect()
-{
-    return SendReceive(EUsbOstCmdDisconnect);
-}
-
-TInt RUsbOstComm::Open()
-{
-    return SendReceive(EUsbOstCmdCodeOpen);
-}
-
-TInt RUsbOstComm::Close()
-{
-    TInt err = SendReceive(EUsbOstCmdCodeClose);
-    RHandleBase::Close();
-    return err;
-}
-
-TInt RUsbOstComm::RegisterProtocolID(const TOstProtIds aId, TBool aNeedHeader)
-{
-    TIpcArgs args(aId, aNeedHeader);
-    return SendReceive(EUsbOstCmdCodeRegisterId, args);
-}
-
-void RUsbOstComm::ReadMessage(TRequestStatus& aStatus, TDes8& aDes)
-{
-    TIpcArgs args(aDes.MaxLength(), &aDes);
-    SendReceive(EUsbOstCmdCodeReadMsg, args, aStatus);
-}
-
-TInt RUsbOstComm::ReadCancel()
-{
-    return SendReceive(EUsbOstCmdCodeReadCancel);
-}
-
-void RUsbOstComm::WriteMessage(TRequestStatus& aStatus, const TDesC8& aDes, TBool aHasHeader)
-{
-    TIpcArgs args(aHasHeader, aDes.Length(), &aDes);
-    SendReceive(EUsbOstCmdCodeWriteMsg, args, aStatus);
-}
-
-typedef TVersion (*TVersionFunction)(const RUsbOstComm*);
-const TInt KVersionOrdinal = 17;
-
-TVersion RUsbOstComm::Version() const
-{
-    // This function has to go to the DLL, unfortunately
-    TVersion result; // Return 0.0.0 on any error
-    RLibrary lib;
-    TInt err = lib.Load(_L("usbostcomm"));
-    if (err) return result;
-
-    TLibraryFunction fn = lib.Lookup(KVersionOrdinal);
-    if (fn)
-        result = ((TVersionFunction)fn)(this);
-    lib.Close();
-    return result;
-}
-
-#endif //USBHOSTCOMM_H
diff --git a/src/plugins/qmltooling/qmldbg_tcp/qmldbg_tcp.pro b/src/plugins/qmltooling/qmldbg_tcp/qmldbg_tcp.pro
deleted file mode 100644
index e8ab962..0000000
--- a/src/plugins/qmltooling/qmldbg_tcp/qmldbg_tcp.pro
+++ /dev/null
@@ -1,18 +0,0 @@
-TARGET = qmldbg_tcp
-QT       += declarative network
-
-include(../../qpluginbase.pri)
-
-QTDIR_build:DESTDIR  = $$QT_BUILD_TREE/plugins/qmltooling
-QTDIR_build:REQUIRES += "contains(QT_CONFIG, declarative)"
-
-SOURCES += \
-    qtcpserverconnection.cpp
-
-HEADERS += \
-    qtcpserverconnection.h
-
-target.path += $$[QT_INSTALL_PLUGINS]/qmltooling
-INSTALLS += target
-
-symbian:TARGET.UID3=0x20031E90
diff --git a/src/plugins/qmltooling/qmldbg_tcp/qtcpserverconnection.cpp b/src/plugins/qmltooling/qmldbg_tcp/qtcpserverconnection.cpp
deleted file mode 100644
index 01aa97a..0000000
--- a/src/plugins/qmltooling/qmldbg_tcp/qtcpserverconnection.cpp
+++ /dev/null
@@ -1,198 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include "qtcpserverconnection.h"
-
-#include <QtCore/qplugin.h>
-#include <QtNetwork/qtcpserver.h>
-#include <QtNetwork/qtcpsocket.h>
-
-#include <private/qdeclarativedebugserver_p.h>
-#include <private/qpacketprotocol_p.h>
-
-QT_BEGIN_NAMESPACE
-
-class QTcpServerConnectionPrivate {
-public:
-    QTcpServerConnectionPrivate();
-
-    int port;
-    bool block;
-    QTcpSocket *socket;
-    QPacketProtocol *protocol;
-    QTcpServer *tcpServer;
-
-    QDeclarativeDebugServer *debugServer;
-};
-
-QTcpServerConnectionPrivate::QTcpServerConnectionPrivate() :
-    port(0),
-    block(false),
-    socket(0),
-    protocol(0),
-    tcpServer(0),
-    debugServer(0)
-{
-}
-
-QTcpServerConnection::QTcpServerConnection() :
-    d_ptr(new QTcpServerConnectionPrivate)
-{
-
-}
-
-QTcpServerConnection::~QTcpServerConnection()
-{
-    delete d_ptr;
-}
-
-void QTcpServerConnection::setServer(QDeclarativeDebugServer *server)
-{
-    Q_D(QTcpServerConnection);
-    d->debugServer = server;
-}
-
-bool QTcpServerConnection::isConnected() const
-{
-    Q_D(const QTcpServerConnection);
-    return d->socket && d->socket->state() == QTcpSocket::ConnectedState;
-}
-
-void QTcpServerConnection::send(const QByteArray &message)
-{
-    Q_D(QTcpServerConnection);
-
-    if (!isConnected()
-            || !d->protocol || !d->socket)
-        return;
-
-    QPacket pack;
-    pack.writeRawData(message.data(), message.length());
-
-    d->protocol->send(pack);
-    d->socket->flush();
-}
-
-void QTcpServerConnection::disconnect()
-{
-    Q_D(QTcpServerConnection);
-
-    // protocol might still be processing packages at this point
-    d->protocol->deleteLater();
-    d->protocol = 0;
-    d->socket->deleteLater();
-    d->socket = 0;
-}
-
-bool QTcpServerConnection::waitForMessage()
-{
-    Q_D(QTcpServerConnection);
-    if (d->protocol->packetsAvailable() > 0) {
-        QPacket packet = d->protocol->read();
-        d->debugServer->receiveMessage(packet.data());
-        return true;
-    } else {
-        return d->protocol->waitForReadyRead(-1);
-    }
-}
-
-void QTcpServerConnection::setPort(int port, bool block)
-{
-    Q_D(QTcpServerConnection);
-    d->port = port;
-    d->block = block;
-
-    listen();
-    if (block)
-        d->tcpServer->waitForNewConnection(-1);
-}
-
-void QTcpServerConnection::listen()
-{
-    Q_D(QTcpServerConnection);
-
-    d->tcpServer = new QTcpServer(this);
-    QObject::connect(d->tcpServer, SIGNAL(newConnection()), this, SLOT(newConnection()));
-    if (d->tcpServer->listen(QHostAddress::Any, d->port)) {
-        qDebug("QDeclarativeDebugServer: Waiting for connection on port %d...", d->port);
-    } else {
-        qWarning("QDeclarativeDebugServer: Unable to listen on port %d", d->port);
-    }
-}
-
-
-void QTcpServerConnection::readyRead()
-{
-    Q_D(QTcpServerConnection);
-    if (!d->protocol)
-        return;
-
-    while (d->protocol->packetsAvailable() > 0) {
-        QPacket packet = d->protocol->read();
-        d->debugServer->receiveMessage(packet.data());
-    }
-}
-
-void QTcpServerConnection::newConnection()
-{
-    Q_D(QTcpServerConnection);
-
-    if (d->socket) {
-        qWarning("QDeclarativeDebugServer: Another client is already connected");
-        QTcpSocket *faultyConnection = d->tcpServer->nextPendingConnection();
-        delete faultyConnection;
-        return;
-    }
-
-    d->socket = d->tcpServer->nextPendingConnection();
-    d->socket->setParent(this);
-    d->protocol = new QPacketProtocol(d->socket, this);
-    QObject::connect(d->protocol, SIGNAL(readyRead()), this, SLOT(readyRead()));
-
-    if (d->block) {
-        d->protocol->waitForReadyRead(-1);
-    }
-}
-
-Q_EXPORT_PLUGIN2(tcpserver, QTcpServerConnection)
-
-QT_END_NAMESPACE
-
diff --git a/src/plugins/qmltooling/qmldbg_tcp/qtcpserverconnection.h b/src/plugins/qmltooling/qmldbg_tcp/qtcpserverconnection.h
deleted file mode 100644
index d3b2333..0000000
--- a/src/plugins/qmltooling/qmldbg_tcp/qtcpserverconnection.h
+++ /dev/null
@@ -1,84 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
-** All rights reserved.
-** Contact: Nokia Corporation (qt-info@nokia.com)
-**
-** This file is part of the QtDeclarative module of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:LGPL$
-** GNU Lesser General Public License Usage
-** This file may be used under the terms of the GNU Lesser General Public
-** License version 2.1 as published by the Free Software Foundation and
-** appearing in the file LICENSE.LGPL included in the packaging of this
-** file. Please review the following information to ensure the GNU Lesser
-** General Public License version 2.1 requirements will be met:
-** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
-**
-** In addition, as a special exception, Nokia gives you certain additional
-** rights. These rights are described in the Nokia Qt LGPL Exception
-** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
-**
-** GNU General Public License Usage
-** Alternatively, this file may be used under the terms of the GNU General
-** Public License version 3.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of this
-** file. Please review the following information to ensure the GNU General
-** Public License version 3.0 requirements will be met:
-** http://www.gnu.org/copyleft/gpl.html.
-**
-** Other Usage
-** Alternatively, this file may be used in accordance with the terms and
-** conditions contained in a signed written agreement between you and Nokia.
-**
-**
-**
-**
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef QTCPSERVERCONNECTION_H
-#define QTCPSERVERCONNECTION_H
-
-#include <QtDeclarative/private/qdeclarativedebugserverconnection_p.h>
-
-QT_BEGIN_NAMESPACE
-
-class QDeclarativeDebugServer;
-class QTcpServerConnectionPrivate;
-class QTcpServerConnection : public QObject, public QDeclarativeDebugServerConnection
-{
-    Q_OBJECT
-    Q_DECLARE_PRIVATE(QTcpServerConnection)
-    Q_DISABLE_COPY(QTcpServerConnection)
-    Q_INTERFACES(QDeclarativeDebugServerConnection)
-
-
-public:
-    QTcpServerConnection();
-    ~QTcpServerConnection();
-
-    void setServer(QDeclarativeDebugServer *server);
-    void setPort(int port, bool bock);
-
-    bool isConnected() const;
-    void send(const QByteArray &message);
-    void disconnect();
-    bool waitForMessage();
-
-    void listen();
-    void waitForConnection();
-
-private Q_SLOTS:
-    void readyRead();
-    void newConnection();
-
-private:
-    QTcpServerConnectionPrivate *d_ptr;
-};
-
-QT_END_NAMESPACE
-
-#endif // QTCPSERVERCONNECTION_H
diff --git a/src/plugins/qmltooling/qmltooling.pro b/src/plugins/qmltooling/qmltooling.pro
index 8220109..6d76f8c 100644
--- a/src/plugins/qmltooling/qmltooling.pro
+++ b/src/plugins/qmltooling/qmltooling.pro
@@ -1,4 +1,3 @@
 TEMPLATE = subdirs
 
-SUBDIRS = qmldbg_tcp qmldbg_inspector
-symbian:SUBDIRS += qmldbg_ost
+SUBDIRS = qmldbg_inspector
diff --git a/src/plugins/qpluginbase.pri b/src/plugins/qpluginbase.pri
index b2a7cf2..bcf473f 100644
--- a/src/plugins/qpluginbase.pri
+++ b/src/plugins/qpluginbase.pri
@@ -33,7 +33,7 @@ symbian: {
     else: PARTIAL_UPGRADE_UID = 0xE001E61C
 
     pu_header = "; Partial upgrade package for testing $${TARGET} changes without reinstalling everything" \
-                "$${LITERAL_HASH}{\"$${TARGET}\"}, ($$PARTIAL_UPGRADE_UID), $${QT_MAJOR_VERSION},$${QT_MINOR_VERSION},$${QT_PATCH_VERSION}, TYPE=PU,RU"
+                "$${LITERAL_HASH}{\"$${TARGET}\"}, ($$PARTIAL_UPGRADE_UID), $${QT_MAJOR_VERSION},$${QT_MINOR_VERSION},$${QT_PATCH_VERSION}, TYPE=PU"
     partial_upgrade.pkg_prerules = pu_header vendorinfo
     partial_upgrade.files = $$QMAKE_LIBDIR_QT/$${TARGET}.dll
     partial_upgrade.path = c:/sys/bin
diff --git a/src/qt_targets.pri b/src/qt_targets.pri
index ec15869..c23d63f 100644
--- a/src/qt_targets.pri
+++ b/src/qt_targets.pri
@@ -1,4 +1,4 @@
 QMAKE_TARGET_COMPANY = Nokia Corporation and/or its subsidiary(-ies)
-QMAKE_TARGET_PRODUCT = Qt4
+QMAKE_TARGET_PRODUCT = Qt5
 QMAKE_TARGET_DESCRIPTION = C++ application development framework.
 QMAKE_TARGET_COPYRIGHT = Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
diff --git a/src/src.pro b/src/src.pro
new file mode 100644
index 0000000..e3a6d02
--- /dev/null
+++ b/src/src.pro
@@ -0,0 +1,5 @@
+TEMPLATE = subdirs
+CONFIG += ordered
+
+SUBDIRS += declarative imports plugins
+
diff --git a/sync.profile b/sync.profile
new file mode 100644
index 0000000..8999a35
--- /dev/null
+++ b/sync.profile
@@ -0,0 +1,25 @@
+%modules = ( # path to module name map
+    "QtQuick1" => "$basedir/src/declarative",
+);
+%classnames = (
+    "qtquick1version.h" => "QtQuick1Version",
+);
+%mastercontent = (
+    "gui" => "#include <QtGui/QtGui>\n",
+    "script" => "#include <QtScript/QtScript>\n",
+    "network" => "#include <QtNetwork/QtNetwork>\n",
+    "testlib" => "#include <QtTest/QtTest>\n",
+);
+%modulepris = (
+    "QtQuick1" => "$basedir/modules/qt_quick1.pri",
+);
+# Module dependencies.
+# Every module that is required to build this module should have one entry.
+# Each of the module version specifiers can take one of the following values:
+#   - A specific Git revision.
+#   - any git symbolic ref resolvable from the module's repository (e.g. "refs/heads/master" to track master branch)
+#
+%dependencies = (
+    "qtbase" => "refs/heads/master",
+    "qtxmlpatterns" => "refs/heads/master",
+);
diff --git a/tests/auto/declarative/declarative.pro b/tests/auto/declarative/declarative.pro
index 08d59d3..7656c79 100644
--- a/tests/auto/declarative/declarative.pro
+++ b/tests/auto/declarative/declarative.pro
@@ -65,7 +65,6 @@ contains(QT_CONFIG, private_tests) {
            qdeclarativesmoothedanimation \
            qdeclarativespringanimation \
            qdeclarativestyledtext \
-           qdeclarativesqldatabase \
            qdeclarativestates \
            qdeclarativesystempalette \
            qdeclarativetext \
diff --git a/tests/auto/declarative/examples/examples.pro b/tests/auto/declarative/examples/examples.pro
index 1f25769..388c4ee 100644
--- a/tests/auto/declarative/examples/examples.pro
+++ b/tests/auto/declarative/examples/examples.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_examples
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_examples.cpp 
diff --git a/tests/auto/declarative/examples/tst_examples.cpp b/tests/auto/declarative/examples/tst_examples.cpp
index 790d3d9..773b93a 100644
--- a/tests/auto/declarative/examples/tst_examples.cpp
+++ b/tests/auto/declarative/examples/tst_examples.cpp
@@ -140,10 +140,8 @@ void tst_examples::namingConvention(const QDir &d)
 void tst_examples::namingConvention()
 {
     QString examples = QLibraryInfo::location(QLibraryInfo::ExamplesPath);
-    QString demos = QLibraryInfo::location(QLibraryInfo::DemosPath);
 
     namingConvention(QDir(examples));
-    namingConvention(QDir(demos));
 }
 
 QStringList tst_examples::findQmlFiles(const QDir &d)
diff --git a/tests/auto/declarative/moduleqt47/moduleqt47.pro b/tests/auto/declarative/moduleqt47/moduleqt47.pro
index ff773e8..a475cf6 100644
--- a/tests/auto/declarative/moduleqt47/moduleqt47.pro
+++ b/tests/auto/declarative/moduleqt47/moduleqt47.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_moduleqt47
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 gui
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_moduleqt47.cpp
diff --git a/tests/auto/declarative/moduleqt47/tst_moduleqt47.cpp b/tests/auto/declarative/moduleqt47/tst_moduleqt47.cpp
index 3c6cbd9..eab1bf3 100644
--- a/tests/auto/declarative/moduleqt47/tst_moduleqt47.cpp
+++ b/tests/auto/declarative/moduleqt47/tst_moduleqt47.cpp
@@ -40,8 +40,8 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QDir>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/parserstress/parserstress.pro b/tests/auto/declarative/parserstress/parserstress.pro
index 6ef2432..ace91cd 100644
--- a/tests/auto/declarative/parserstress/parserstress.pro
+++ b/tests/auto/declarative/parserstress/parserstress.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_parserstress
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_parserstress.cpp
diff --git a/tests/auto/declarative/parserstress/tst_parserstress.cpp b/tests/auto/declarative/parserstress/tst_parserstress.cpp
index 33896d5..504e09e 100644
--- a/tests/auto/declarative/parserstress/tst_parserstress.cpp
+++ b/tests/auto/declarative/parserstress/tst_parserstress.cpp
@@ -94,11 +94,7 @@ void tst_parserstress::ecmascript_data()
 #ifdef Q_OS_SYMBIAN    
     QDir dir("tests");
 #else
-    QDir dir(SRCDIR);
-    dir.cdUp();
-    dir.cdUp();
-    dir.cd("qscriptjstestsuite");
-    dir.cd("tests");
+    QDir dir(SRCDIR "../../qscriptjstestsuite/tests");
 #endif
     QStringList files = findJSFiles(dir);
 
@@ -110,6 +106,8 @@ void tst_parserstress::ecmascript_data()
 
 void tst_parserstress::ecmascript()
 {
+    QSKIP("Test data (located in the QtScript module) not currently available");
+
     QFETCH(QString, file);
 
     QFile f(file);
diff --git a/tests/auto/declarative/qdeclarativeanchors/qdeclarativeanchors.pro b/tests/auto/declarative/qdeclarativeanchors/qdeclarativeanchors.pro
index f09e8d9..e529921 100644
--- a/tests/auto/declarative/qdeclarativeanchors/qdeclarativeanchors.pro
+++ b/tests/auto/declarative/qdeclarativeanchors/qdeclarativeanchors.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativeanchors
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets widgets-private gui gui-private core-private
 SOURCES += tst_qdeclarativeanchors.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativeanchors/tst_qdeclarativeanchors.cpp b/tests/auto/declarative/qdeclarativeanchors/tst_qdeclarativeanchors.cpp
index 17e5eb0..f5aeaa1 100644
--- a/tests/auto/declarative/qdeclarativeanchors/tst_qdeclarativeanchors.cpp
+++ b/tests/auto/declarative/qdeclarativeanchors/tst_qdeclarativeanchors.cpp
@@ -40,15 +40,15 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QSignalSpy>
-#include <QtGui/QGraphicsWidget>
+#include <QtWidgets/QGraphicsWidget>
 #include <private/qgraphicsitem_p.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativetext_p.h>
-#include <QtDeclarative/private/qdeclarativeanchors_p_p.h>
-#include <QtDeclarative/private/qdeclarativeitem_p.h>
+#include <QtQuick1/private/qdeclarativeanchors_p_p.h>
+#include <QtQuick1/private/qdeclarativeitem_p.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeanimatedimage/qdeclarativeanimatedimage.pro b/tests/auto/declarative/qdeclarativeanimatedimage/qdeclarativeanimatedimage.pro
index 3d040a6..811fa4c 100644
--- a/tests/auto/declarative/qdeclarativeanimatedimage/qdeclarativeanimatedimage.pro
+++ b/tests/auto/declarative/qdeclarativeanimatedimage/qdeclarativeanimatedimage.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative network
+CONFIG += testcase
+TARGET = tst_qdeclarativeanimatedimage
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private network
 HEADERS += ../shared/testhttpserver.h
 SOURCES += tst_qdeclarativeanimatedimage.cpp ../shared/testhttpserver.cpp
 macx:CONFIG -= app_bundle
diff --git a/tests/auto/declarative/qdeclarativeanimatedimage/tst_qdeclarativeanimatedimage.cpp b/tests/auto/declarative/qdeclarativeanimatedimage/tst_qdeclarativeanimatedimage.cpp
index 19853c4..147f855 100644
--- a/tests/auto/declarative/qdeclarativeanimatedimage/tst_qdeclarativeanimatedimage.cpp
+++ b/tests/auto/declarative/qdeclarativeanimatedimage/tst_qdeclarativeanimatedimage.cpp
@@ -39,17 +39,16 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativeimage_p.h>
 #include <private/qdeclarativeanimatedimage_p.h>
 #include <QSignalSpy>
-#include <QtDeclarative/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativecontext.h>
 
 #include "../shared/testhttpserver.h"
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
@@ -191,6 +190,7 @@ void tst_qdeclarativeanimatedimage::mirror_running()
     QPixmap frame1_expected = frame1.transformed(transform);
 
     QCOMPARE(frame0_flipped, frame0_expected);
+    QEXPECT_FAIL("", "QTBUG-19538", Continue);
     QCOMPARE(frame1_flipped, frame1_expected);
 }
 
diff --git a/tests/auto/declarative/qdeclarativeanimations/qdeclarativeanimations.pro b/tests/auto/declarative/qdeclarativeanimations/qdeclarativeanimations.pro
index d00d51a..c0be301 100644
--- a/tests/auto/declarative/qdeclarativeanimations/qdeclarativeanimations.pro
+++ b/tests/auto/declarative/qdeclarativeanimations/qdeclarativeanimations.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativeanimations
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private core-private gui-private widgets-private
 SOURCES += tst_qdeclarativeanimations.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativeanimations/tst_qdeclarativeanimations.cpp b/tests/auto/declarative/qdeclarativeanimations/tst_qdeclarativeanimations.cpp
index 4da5910..e4bb7b1 100644
--- a/tests/auto/declarative/qdeclarativeanimations/tst_qdeclarativeanimations.cpp
+++ b/tests/auto/declarative/qdeclarativeanimations/tst_qdeclarativeanimations.cpp
@@ -39,17 +39,15 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativeanimation_p.h>
 #include <private/qdeclarativeitem_p.h>
 #include <QVariantAnimation>
 #include <QEasingCurve>
 
-#include "../../../shared/util.h"
-
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
 #define SRCDIR "."
diff --git a/tests/auto/declarative/qdeclarativeapplication/qdeclarativeapplication.pro b/tests/auto/declarative/qdeclarativeapplication/qdeclarativeapplication.pro
index 91e5468..aff3d64 100644
--- a/tests/auto/declarative/qdeclarativeapplication/qdeclarativeapplication.pro
+++ b/tests/auto/declarative/qdeclarativeapplication/qdeclarativeapplication.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeapplication
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 gui widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeapplication.cpp
diff --git a/tests/auto/declarative/qdeclarativeapplication/tst_qdeclarativeapplication.cpp b/tests/auto/declarative/qdeclarativeapplication/tst_qdeclarativeapplication.cpp
index bb9967d..cafcfba 100644
--- a/tests/auto/declarative/qdeclarativeapplication/tst_qdeclarativeapplication.cpp
+++ b/tests/auto/declarative/qdeclarativeapplication/tst_qdeclarativeapplication.cpp
@@ -40,12 +40,12 @@
 ****************************************************************************/
 
 #include <qtest.h>
-#include "../../../shared/util.h"
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeitem.h>
-#include <QtGui/qgraphicsview.h>
-#include <QtGui/qgraphicsscene.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeitem.h>
+#include <QtWidgets/qgraphicsview.h>
+#include <QtWidgets/qgraphicsscene.h>
+#include <QtWidgets/qapplication.h>
 
 class tst_qdeclarativeapplication : public QObject
 {
diff --git a/tests/auto/declarative/qdeclarativebehaviors/qdeclarativebehaviors.pro b/tests/auto/declarative/qdeclarativebehaviors/qdeclarativebehaviors.pro
index 7416827..f2667ac 100644
--- a/tests/auto/declarative/qdeclarativebehaviors/qdeclarativebehaviors.pro
+++ b/tests/auto/declarative/qdeclarativebehaviors/qdeclarativebehaviors.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativebehaviors
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private core-private widgets-private gui-private
 SOURCES += tst_qdeclarativebehaviors.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativebehaviors/tst_qdeclarativebehaviors.cpp b/tests/auto/declarative/qdeclarativebehaviors/tst_qdeclarativebehaviors.cpp
index 1c58ddb..e193d34 100644
--- a/tests/auto/declarative/qdeclarativebehaviors/tst_qdeclarativebehaviors.cpp
+++ b/tests/auto/declarative/qdeclarativebehaviors/tst_qdeclarativebehaviors.cpp
@@ -40,15 +40,14 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <qsignalspy.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativetext_p.h>
 #include <private/qdeclarativebehavior_p.h>
 #include <private/qdeclarativeanimation_p.h>
 #include <private/qdeclarativeitem_p.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativebinding/qdeclarativebinding.pro b/tests/auto/declarative/qdeclarativebinding/qdeclarativebinding.pro
index fe12635..e09d0a9 100644
--- a/tests/auto/declarative/qdeclarativebinding/qdeclarativebinding.pro
+++ b/tests/auto/declarative/qdeclarativebinding/qdeclarativebinding.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativebinding
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativebinding.cpp
diff --git a/tests/auto/declarative/qdeclarativebinding/tst_qdeclarativebinding.cpp b/tests/auto/declarative/qdeclarativebinding/tst_qdeclarativebinding.cpp
index 9d65255..be89fce 100644
--- a/tests/auto/declarative/qdeclarativebinding/tst_qdeclarativebinding.cpp
+++ b/tests/auto/declarative/qdeclarativebinding/tst_qdeclarativebinding.cpp
@@ -39,11 +39,10 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativebind_p.h>
 #include <private/qdeclarativerectangle_p.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeborderimage/qdeclarativeborderimage.pro b/tests/auto/declarative/qdeclarativeborderimage/qdeclarativeborderimage.pro
index c5b1bfa..96bbc7c 100644
--- a/tests/auto/declarative/qdeclarativeborderimage/qdeclarativeborderimage.pro
+++ b/tests/auto/declarative/qdeclarativeborderimage/qdeclarativeborderimage.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui network
+CONFIG += testcase
+TARGET = tst_qdeclarativeborderimage
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets network
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/testhttpserver.h
diff --git a/tests/auto/declarative/qdeclarativeborderimage/tst_qdeclarativeborderimage.cpp b/tests/auto/declarative/qdeclarativeborderimage/tst_qdeclarativeborderimage.cpp
index e8ebc34..1658f8a 100644
--- a/tests/auto/declarative/qdeclarativeborderimage/tst_qdeclarativeborderimage.cpp
+++ b/tests/auto/declarative/qdeclarativeborderimage/tst_qdeclarativeborderimage.cpp
@@ -46,16 +46,15 @@
 #include <QGraphicsScene>
 #include <QPainter>
 
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativeborderimage_p.h>
 #include <private/qdeclarativeimagebase_p.h>
 #include <private/qdeclarativescalegrid_p_p.h>
 #include <private/qdeclarativeloader_p.h>
-#include <QtDeclarative/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativecontext.h>
 
 #include "../shared/testhttpserver.h"
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
@@ -249,6 +248,7 @@ void tst_qdeclarativeborderimage::mirror()
     p_screenshot.fillRect(QRect(0, 0, width, height), Qt::white);
     scene.render(&p_screenshot, QRect(0, 0, width, height), QRect(0, 0, width, height));
 
+    QEXPECT_FAIL("", "QTBUG-19538", Continue);
     QCOMPARE(screenshot, expected);
 
     delete obj;
diff --git a/tests/auto/declarative/qdeclarativecomponent/qdeclarativecomponent.pro b/tests/auto/declarative/qdeclarativecomponent/qdeclarativecomponent.pro
index 4124f94..46914b8 100644
--- a/tests/auto/declarative/qdeclarativecomponent/qdeclarativecomponent.pro
+++ b/tests/auto/declarative/qdeclarativecomponent/qdeclarativecomponent.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativecomponent
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 QT += script network
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativecomponent/tst_qdeclarativecomponent.cpp b/tests/auto/declarative/qdeclarativecomponent/tst_qdeclarativecomponent.cpp
index 749640a..e115238 100644
--- a/tests/auto/declarative/qdeclarativecomponent/tst_qdeclarativecomponent.cpp
+++ b/tests/auto/declarative/qdeclarativecomponent/tst_qdeclarativecomponent.cpp
@@ -41,11 +41,11 @@
 #include <qtest.h>
 #include <QDebug>
 
-#include <QtGui/qgraphicsitem.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeitem.h>
-#include <QtDeclarative/qdeclarativeproperty.h>
+#include <QtWidgets/qgraphicsitem.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeitem.h>
+#include <QtQuick1/qdeclarativeproperty.h>
 #include <qcolor.h>
 
 #ifdef Q_OS_SYMBIAN
diff --git a/tests/auto/declarative/qdeclarativeconnection/qdeclarativeconnection.pro b/tests/auto/declarative/qdeclarativeconnection/qdeclarativeconnection.pro
index 6f9550d..c38b80c 100644
--- a/tests/auto/declarative/qdeclarativeconnection/qdeclarativeconnection.pro
+++ b/tests/auto/declarative/qdeclarativeconnection/qdeclarativeconnection.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeconnection
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui core-private script-private gui-private widgets-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeconnection.cpp
diff --git a/tests/auto/declarative/qdeclarativeconnection/tst_qdeclarativeconnection.cpp b/tests/auto/declarative/qdeclarativeconnection/tst_qdeclarativeconnection.cpp
index e42e906..13e9e67 100644
--- a/tests/auto/declarative/qdeclarativeconnection/tst_qdeclarativeconnection.cpp
+++ b/tests/auto/declarative/qdeclarativeconnection/tst_qdeclarativeconnection.cpp
@@ -39,12 +39,11 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativeconnections_p.h>
 #include <private/qdeclarativeitem_p.h>
-#include "../../../shared/util.h"
-#include <QtDeclarative/qdeclarativescriptstring.h>
+#include <QtQuick1/qdeclarativescriptstring.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativecontext/qdeclarativecontext.pro b/tests/auto/declarative/qdeclarativecontext/qdeclarativecontext.pro
index 74bb78c..f8856e7 100644
--- a/tests/auto/declarative/qdeclarativecontext/qdeclarativecontext.pro
+++ b/tests/auto/declarative/qdeclarativecontext/qdeclarativecontext.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativecontext
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 SOURCES += tst_qdeclarativecontext.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativedebug/qdeclarativedebug.pro b/tests/auto/declarative/qdeclarativedebug/qdeclarativedebug.pro
index d488b53..78bb8d3 100644
--- a/tests/auto/declarative/qdeclarativedebug/qdeclarativedebug.pro
+++ b/tests/auto/declarative/qdeclarativedebug/qdeclarativedebug.pro
@@ -1,10 +1,13 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += network declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativedebug
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += network quick1 quick1-private core-private script-private gui-private widgets-private
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/debugutil_p.h
 SOURCES += tst_qdeclarativedebug.cpp \
            ../shared/debugutil.cpp
 
-CONFIG += parallel_test declarative_debug
+CONFIG += parallel_test quick1_debug
 
diff --git a/tests/auto/declarative/qdeclarativedebug/tst_qdeclarativedebug.cpp b/tests/auto/declarative/qdeclarativedebug/tst_qdeclarativedebug.cpp
index 83d47fc..eb8e8d8 100644
--- a/tests/auto/declarative/qdeclarativedebug/tst_qdeclarativedebug.cpp
+++ b/tests/auto/declarative/qdeclarativedebug/tst_qdeclarativedebug.cpp
@@ -45,11 +45,11 @@
 #include <QDebug>
 #include <QThread>
 
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
-#include <QtDeclarative/qdeclarativeproperty.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeexpression.h>
+#include <QtQuick1/qdeclarativeproperty.h>
 
 #include <private/qdeclarativebinding_p.h>
 #include <private/qdeclarativeenginedebug_p.h>
@@ -59,7 +59,6 @@
 #include <private/qdeclarativemetatype_p.h>
 #include <private/qdeclarativeproperty_p.h>
 
-#include "../../../shared/util.h"
 #include "../shared/debugutil_p.h"
 
 Q_DECLARE_METATYPE(QDeclarativeDebugWatch::State)
diff --git a/tests/auto/declarative/qdeclarativedebugclient/qdeclarativedebugclient.pro b/tests/auto/declarative/qdeclarativedebugclient/qdeclarativedebugclient.pro
index 8fa87d2..db98ab0 100644
--- a/tests/auto/declarative/qdeclarativedebugclient/qdeclarativedebugclient.pro
+++ b/tests/auto/declarative/qdeclarativedebugclient/qdeclarativedebugclient.pro
@@ -1,9 +1,12 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += network declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativedebugclient
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += network quick1 quick1-private core-private gui-private widgets-private
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/debugutil_p.h
 SOURCES += tst_qdeclarativedebugclient.cpp \
            ../shared/debugutil.cpp
 
-CONFIG += declarative_debug
+CONFIG += quick1_debug
diff --git a/tests/auto/declarative/qdeclarativedebugclient/tst_qdeclarativedebugclient.cpp b/tests/auto/declarative/qdeclarativedebugclient/tst_qdeclarativedebugclient.cpp
index 43b6b65..0570e2f 100644
--- a/tests/auto/declarative/qdeclarativedebugclient/tst_qdeclarativedebugclient.cpp
+++ b/tests/auto/declarative/qdeclarativedebugclient/tst_qdeclarativedebugclient.cpp
@@ -45,11 +45,10 @@
 #include <QDebug>
 #include <QThread>
 
-#include <QtDeclarative/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeengine.h>
 
 #include <private/qdeclarativedebugclient_p.h>
 
-#include "../../../shared/util.h"
 #include "../shared/debugutil_p.h"
 
 class tst_QDeclarativeDebugClient : public QObject
diff --git a/tests/auto/declarative/qdeclarativedebughelper/qdeclarativedebughelper.pro b/tests/auto/declarative/qdeclarativedebughelper/qdeclarativedebughelper.pro
index c52c652..83fe5b6 100644
--- a/tests/auto/declarative/qdeclarativedebughelper/qdeclarativedebughelper.pro
+++ b/tests/auto/declarative/qdeclarativedebughelper/qdeclarativedebughelper.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += network declarative script
+CONFIG += testcase
+TARGET = tst_qdeclarativedebughelper
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += network quick1 quick1-private script script-private core-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativedebughelper.cpp
diff --git a/tests/auto/declarative/qdeclarativedebugjs/app/app.pro b/tests/auto/declarative/qdeclarativedebugjs/app/app.pro
index d1c0cdd..8eb3dfa 100644
--- a/tests/auto/declarative/qdeclarativedebugjs/app/app.pro
+++ b/tests/auto/declarative/qdeclarativedebugjs/app/app.pro
@@ -1,7 +1,7 @@
 TEMPLATE = app
 
-QT += declarative
-CONFIG += declarative_debug
+QT += quick1 quick1-private gui widgets
+CONFIG += quick1_debug
 
 CONFIG += console
 CONFIG -= app_bundle
diff --git a/tests/auto/declarative/qdeclarativedebugjs/app/main.cpp b/tests/auto/declarative/qdeclarativedebugjs/app/main.cpp
index 18a7a5f..8a33335 100644
--- a/tests/auto/declarative/qdeclarativedebugjs/app/main.cpp
+++ b/tests/auto/declarative/qdeclarativedebugjs/app/main.cpp
@@ -44,7 +44,7 @@
 #include <QDeclarativeComponent>
 #include <QDeclarativeEngine>
 #include <QStringList>
-#include <QtDeclarative/private/qdeclarativedebugservice_p.h>
+#include <QtQuick1/private/qdeclarativedebugservice_p.h>
 
 int main(int argc, char *argv[])
 {
diff --git a/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.cpp b/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.cpp
index 096f390..aec1dcf 100644
--- a/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.cpp
+++ b/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.cpp
@@ -40,14 +40,13 @@
 ****************************************************************************/
 
 #include <qtest.h>
-#include <QtDeclarative/QDeclarativeEngine>
-#include <QtDeclarative/private/qdeclarativedebugclient_p.h>
-#include <QtDeclarative/private/qdeclarativedebugservice_p.h>
-#include <QtDeclarative/private/qjsdebuggeragent_p.h>
+#include <QtQuick1/QDeclarativeEngine>
+#include <QtQuick1/private/qdeclarativedebugclient_p.h>
+#include <QtQuick1/private/qdeclarativedebugservice_p.h>
+#include <QtQuick1/private/qjsdebuggeragent_p.h>
 #include <QtCore/QFileInfo>
 #include <QtCore/QDir>
 #include <QtCore/QProcess>
-#include "../../../shared/util.h"
 #include "../shared/debugutil_p.h"
 
 class QJSDebugClient : public QDeclarativeDebugClient
diff --git a/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.pro b/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.pro
index c293fea..98f96f8 100644
--- a/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.pro
+++ b/tests/auto/declarative/qdeclarativedebugjs/tst_qdeclarativedebugjs.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative network script
+CONFIG += testcase
+TARGET = tst_qdeclarativedebugjs
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private network script core-private gui-private widgets-private
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/debugutil_p.h
diff --git a/tests/auto/declarative/qdeclarativedebugservice/qdeclarativedebugservice.pro b/tests/auto/declarative/qdeclarativedebugservice/qdeclarativedebugservice.pro
index ca5a398..94bbf7a 100644
--- a/tests/auto/declarative/qdeclarativedebugservice/qdeclarativedebugservice.pro
+++ b/tests/auto/declarative/qdeclarativedebugservice/qdeclarativedebugservice.pro
@@ -1,10 +1,13 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += network declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativedebugservice
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += network quick1 quick1-private core-private gui-private widgets-private
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/debugutil_p.h
 SOURCES += tst_qdeclarativedebugservice.cpp \
            ../shared/debugutil.cpp
 
-CONFIG += parallel_test declarative_debug
+CONFIG += parallel_test quick1_debug
 
diff --git a/tests/auto/declarative/qdeclarativedebugservice/tst_qdeclarativedebugservice.cpp b/tests/auto/declarative/qdeclarativedebugservice/tst_qdeclarativedebugservice.cpp
index ff73c5c..87636c8 100644
--- a/tests/auto/declarative/qdeclarativedebugservice/tst_qdeclarativedebugservice.cpp
+++ b/tests/auto/declarative/qdeclarativedebugservice/tst_qdeclarativedebugservice.cpp
@@ -45,12 +45,11 @@
 #include <QDebug>
 #include <QThread>
 
-#include <QtDeclarative/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeengine.h>
 
 #include <private/qdeclarativedebugclient_p.h>
 #include <private/qdeclarativedebugservice_p.h>
 
-#include "../../../shared/util.h"
 #include "../shared/debugutil_p.h"
 
 
diff --git a/tests/auto/declarative/qdeclarativedom/qdeclarativedom.pro b/tests/auto/declarative/qdeclarativedom/qdeclarativedom.pro
index 8ac69aa..55bbb84 100644
--- a/tests/auto/declarative/qdeclarativedom/qdeclarativedom.pro
+++ b/tests/auto/declarative/qdeclarativedom/qdeclarativedom.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativedom
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativedom.cpp
diff --git a/tests/auto/declarative/qdeclarativedom/tst_qdeclarativedom.cpp b/tests/auto/declarative/qdeclarativedom/tst_qdeclarativedom.cpp
index 14f1fb5..b8bb358 100644
--- a/tests/auto/declarative/qdeclarativedom/tst_qdeclarativedom.cpp
+++ b/tests/auto/declarative/qdeclarativedom/tst_qdeclarativedom.cpp
@@ -39,9 +39,9 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/private/qdeclarativedom_p.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/private/qdeclarativedom_p.h>
 
 #include <QtCore/QDebug>
 #include <QtCore/QFile>
diff --git a/tests/auto/declarative/qdeclarativeecmascript/qdeclarativeecmascript.pro b/tests/auto/declarative/qdeclarativeecmascript/qdeclarativeecmascript.pro
index 69d25a4..a65b723 100644
--- a/tests/auto/declarative/qdeclarativeecmascript/qdeclarativeecmascript.pro
+++ b/tests/auto/declarative/qdeclarativeecmascript/qdeclarativeecmascript.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative script network
+CONFIG += testcase
+TARGET = tst_qdeclarativeecmascript
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script script-private network widgets core-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeecmascript.cpp \
diff --git a/tests/auto/declarative/qdeclarativeecmascript/testtypes.h b/tests/auto/declarative/qdeclarativeecmascript/testtypes.h
index 8c7326f..5c696c9 100644
--- a/tests/auto/declarative/qdeclarativeecmascript/testtypes.h
+++ b/tests/auto/declarative/qdeclarativeecmascript/testtypes.h
@@ -42,19 +42,19 @@
 #define TESTTYPES_H
 
 #include <QtCore/qobject.h>
-#include <QtDeclarative/qdeclarative.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
+#include <QtQuick1/qdeclarative.h>
+#include <QtQuick1/qdeclarativeexpression.h>
 #include <QtCore/qpoint.h>
 #include <QtCore/qsize.h>
-#include <QtDeclarative/qdeclarativelist.h>
+#include <QtQuick1/qdeclarativelist.h>
 #include <QtCore/qrect.h>
 #include <QtGui/qmatrix.h>
 #include <QtGui/qcolor.h>
 #include <QtGui/qvector3d.h>
 #include <QtCore/qdatetime.h>
 #include <QtScript/qscriptvalue.h>
-#include <QtDeclarative/qdeclarativescriptstring.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativescriptstring.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 
 class MyQmlAttachedObject : public QObject
 {
diff --git a/tests/auto/declarative/qdeclarativeecmascript/tst_qdeclarativeecmascript.cpp b/tests/auto/declarative/qdeclarativeecmascript/tst_qdeclarativeecmascript.cpp
index f5b2061..f8731f9 100644
--- a/tests/auto/declarative/qdeclarativeecmascript/tst_qdeclarativeecmascript.cpp
+++ b/tests/auto/declarative/qdeclarativeecmascript/tst_qdeclarativeecmascript.cpp
@@ -39,13 +39,13 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
-#include <QtDeclarative/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeexpression.h>
+#include <QtQuick1/qdeclarativecontext.h>
 #include <QtCore/qfileinfo.h>
 #include <QtCore/qdebug.h>
-#include <QtDeclarative/private/qdeclarativeguard_p.h>
+#include <QtQuick1/private/qdeclarativeguard_p.h>
 #include <QtCore/qdir.h>
 #include <QtCore/qnumeric.h>
 #include <private/qdeclarativeengine_p.h>
@@ -53,7 +53,6 @@
 #include <private/qscriptdeclarativeclass_p.h>
 #include "testtypes.h"
 #include "testhttpserver.h"
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeengine/qdeclarativeengine.pro b/tests/auto/declarative/qdeclarativeengine/qdeclarativeengine.pro
index 7119ad9..d79d6c1 100644
--- a/tests/auto/declarative/qdeclarativeengine/qdeclarativeengine.pro
+++ b/tests/auto/declarative/qdeclarativeengine/qdeclarativeengine.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative network
+CONFIG += testcase
+TARGET = tst_qdeclarativeengine
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 network
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeengine.cpp 
diff --git a/tests/auto/declarative/qdeclarativeerror/qdeclarativeerror.pro b/tests/auto/declarative/qdeclarativeerror/qdeclarativeerror.pro
index 0c7240a..76277bd 100644
--- a/tests/auto/declarative/qdeclarativeerror/qdeclarativeerror.pro
+++ b/tests/auto/declarative/qdeclarativeerror/qdeclarativeerror.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativeerror
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 SOURCES += tst_qdeclarativeerror.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativeflickable/qdeclarativeflickable.pro b/tests/auto/declarative/qdeclarativeflickable/qdeclarativeflickable.pro
index c176e07..cfa1c50 100644
--- a/tests/auto/declarative/qdeclarativeflickable/qdeclarativeflickable.pro
+++ b/tests/auto/declarative/qdeclarativeflickable/qdeclarativeflickable.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeflickable
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui widgets script-private core-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeflickable.cpp
diff --git a/tests/auto/declarative/qdeclarativeflickable/tst_qdeclarativeflickable.cpp b/tests/auto/declarative/qdeclarativeflickable/tst_qdeclarativeflickable.cpp
index 748760a..ef715a2 100644
--- a/tests/auto/declarative/qdeclarativeflickable/tst_qdeclarativeflickable.cpp
+++ b/tests/auto/declarative/qdeclarativeflickable/tst_qdeclarativeflickable.cpp
@@ -40,14 +40,15 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativeflickable_p.h>
 #include <private/qdeclarativevaluetype_p.h>
-#include <QtGui/qgraphicswidget.h>
+#include <QtWidgets/qgraphicswidget.h>
+#include <QWindow>
+#include <QApplication>
 #include <math.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeflipable/qdeclarativeflipable.pro b/tests/auto/declarative/qdeclarativeflipable/qdeclarativeflipable.pro
index 3b6d19a..21ab151 100644
--- a/tests/auto/declarative/qdeclarativeflipable/qdeclarativeflipable.pro
+++ b/tests/auto/declarative/qdeclarativeflipable/qdeclarativeflipable.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeflipable
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui widgets core-private script-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeflipable.cpp
diff --git a/tests/auto/declarative/qdeclarativeflipable/tst_qdeclarativeflipable.cpp b/tests/auto/declarative/qdeclarativeflipable/tst_qdeclarativeflipable.cpp
index 1835c65..8b39cf7 100644
--- a/tests/auto/declarative/qdeclarativeflipable/tst_qdeclarativeflipable.cpp
+++ b/tests/auto/declarative/qdeclarativeflipable/tst_qdeclarativeflipable.cpp
@@ -39,9 +39,9 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativeflipable_p.h>
 #include <private/qdeclarativevaluetype_p.h>
 #include <QFontMetrics>
diff --git a/tests/auto/declarative/qdeclarativefocusscope/qdeclarativefocusscope.pro b/tests/auto/declarative/qdeclarativefocusscope/qdeclarativefocusscope.pro
index eab983f..0c9a16c 100644
--- a/tests/auto/declarative/qdeclarativefocusscope/qdeclarativefocusscope.pro
+++ b/tests/auto/declarative/qdeclarativefocusscope/qdeclarativefocusscope.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativefocusscope
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets
 SOURCES += tst_qdeclarativefocusscope.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativefocusscope/tst_qdeclarativefocusscope.cpp b/tests/auto/declarative/qdeclarativefocusscope/tst_qdeclarativefocusscope.cpp
index 78aa5a9..d6e7ea6 100644
--- a/tests/auto/declarative/qdeclarativefocusscope/tst_qdeclarativefocusscope.cpp
+++ b/tests/auto/declarative/qdeclarativefocusscope/tst_qdeclarativefocusscope.cpp
@@ -40,13 +40,14 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QSignalSpy>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QGuiApplication>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativetextedit_p.h>
 #include <private/qdeclarativetext_p.h>
-#include <QtDeclarative/private/qdeclarativefocusscope_p.h>
+#include <QtQuick1/private/qdeclarativefocusscope_p.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativefolderlistmodel/qdeclarativefolderlistmodel.pro b/tests/auto/declarative/qdeclarativefolderlistmodel/qdeclarativefolderlistmodel.pro
index b7e5e5f..ce5f508 100644
--- a/tests/auto/declarative/qdeclarativefolderlistmodel/qdeclarativefolderlistmodel.pro
+++ b/tests/auto/declarative/qdeclarativefolderlistmodel/qdeclarativefolderlistmodel.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativefolderlistmodel
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativefolderlistmodel.cpp
diff --git a/tests/auto/declarative/qdeclarativefolderlistmodel/tst_qdeclarativefolderlistmodel.cpp b/tests/auto/declarative/qdeclarativefolderlistmodel/tst_qdeclarativefolderlistmodel.cpp
index bfccc8a..a07cda8 100644
--- a/tests/auto/declarative/qdeclarativefolderlistmodel/tst_qdeclarativefolderlistmodel.cpp
+++ b/tests/auto/declarative/qdeclarativefolderlistmodel/tst_qdeclarativefolderlistmodel.cpp
@@ -40,9 +40,8 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
-#include "../../../shared/util.h"
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <QtCore/qdir.h>
 #include <QtCore/qfile.h>
 #include <QtCore/qabstractitemmodel.h>
diff --git a/tests/auto/declarative/qdeclarativefontloader/qdeclarativefontloader.pro b/tests/auto/declarative/qdeclarativefontloader/qdeclarativefontloader.pro
index 357268b..70e6379 100644
--- a/tests/auto/declarative/qdeclarativefontloader/qdeclarativefontloader.pro
+++ b/tests/auto/declarative/qdeclarativefontloader/qdeclarativefontloader.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui network
+CONFIG += testcase
+TARGET = tst_qdeclarativefontloader
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui network
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/testhttpserver.h
diff --git a/tests/auto/declarative/qdeclarativefontloader/tst_qdeclarativefontloader.cpp b/tests/auto/declarative/qdeclarativefontloader/tst_qdeclarativefontloader.cpp
index 4d024c7..0b71874 100644
--- a/tests/auto/declarative/qdeclarativefontloader/tst_qdeclarativefontloader.cpp
+++ b/tests/auto/declarative/qdeclarativefontloader/tst_qdeclarativefontloader.cpp
@@ -40,11 +40,10 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecontext.h>
 #include <private/qdeclarativefontloader_p.h>
-#include "../../../shared/util.h"
 #include "../shared/testhttpserver.h"
 
 #define SERVER_PORT 14448
diff --git a/tests/auto/declarative/qdeclarativegridview/qdeclarativegridview.pro b/tests/auto/declarative/qdeclarativegridview/qdeclarativegridview.pro
index bc196fb..4d86f27 100644
--- a/tests/auto/declarative/qdeclarativegridview/qdeclarativegridview.pro
+++ b/tests/auto/declarative/qdeclarativegridview/qdeclarativegridview.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativegridview
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets widgets-private gui gui-private core-private script-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativegridview.cpp
diff --git a/tests/auto/declarative/qdeclarativegridview/tst_qdeclarativegridview.cpp b/tests/auto/declarative/qdeclarativegridview/tst_qdeclarativegridview.cpp
index aa7f116..2e3b8b2 100644
--- a/tests/auto/declarative/qdeclarativegridview/tst_qdeclarativegridview.cpp
+++ b/tests/auto/declarative/qdeclarativegridview/tst_qdeclarativegridview.cpp
@@ -40,18 +40,17 @@
 ****************************************************************************/
 
 #include <QtTest/QtTest>
-#include <QtGui/qstringlistmodel.h>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
-#include <QtDeclarative/private/qdeclarativeitem_p.h>
-#include <QtDeclarative/private/qlistmodelinterface_p.h>
-#include <QtDeclarative/private/qdeclarativegridview_p.h>
-#include <QtDeclarative/private/qdeclarativetext_p.h>
-#include <QtDeclarative/private/qdeclarativelistmodel_p.h>
-#include "../../../shared/util.h"
+#include <QtCore/qstringlistmodel.h>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeexpression.h>
+#include <QtQuick1/private/qdeclarativeitem_p.h>
+#include <QtQuick1/private/qlistmodelinterface_p.h>
+#include <QtQuick1/private/qdeclarativegridview_p.h>
+#include <QtQuick1/private/qdeclarativetext_p.h>
+#include <QtQuick1/private/qdeclarativelistmodel_p.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeimage/data/heart.png b/tests/auto/declarative/qdeclarativeimage/data/heart.png
index abe97fe..45db733 100644
Binary files a/tests/auto/declarative/qdeclarativeimage/data/heart.png and b/tests/auto/declarative/qdeclarativeimage/data/heart.png differ
diff --git a/tests/auto/declarative/qdeclarativeimage/data/heart200.png b/tests/auto/declarative/qdeclarativeimage/data/heart200.png
index 7fbb13c..e125d3a 100644
Binary files a/tests/auto/declarative/qdeclarativeimage/data/heart200.png and b/tests/auto/declarative/qdeclarativeimage/data/heart200.png differ
diff --git a/tests/auto/declarative/qdeclarativeimage/qdeclarativeimage.pro b/tests/auto/declarative/qdeclarativeimage/qdeclarativeimage.pro
index 5bf8095..650b25d 100644
--- a/tests/auto/declarative/qdeclarativeimage/qdeclarativeimage.pro
+++ b/tests/auto/declarative/qdeclarativeimage/qdeclarativeimage.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui network
+CONFIG += testcase
+TARGET = tst_qdeclarativeimage
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui widgets network
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/testhttpserver.h
diff --git a/tests/auto/declarative/qdeclarativeimage/tst_qdeclarativeimage.cpp b/tests/auto/declarative/qdeclarativeimage/tst_qdeclarativeimage.cpp
index 48e8151..ab82f80 100644
--- a/tests/auto/declarative/qdeclarativeimage/tst_qdeclarativeimage.cpp
+++ b/tests/auto/declarative/qdeclarativeimage/tst_qdeclarativeimage.cpp
@@ -44,17 +44,16 @@
 #include <QTcpSocket>
 #include <QDir>
 
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativeimage_p.h>
 #include <private/qdeclarativeimagebase_p.h>
 #include <private/qdeclarativeloader_p.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeexpression.h>
 #include <QtTest/QSignalSpy>
 
-#include "../../../shared/util.h"
 #include "../shared/testhttpserver.h"
 
 #ifdef Q_OS_SYMBIAN
@@ -327,6 +326,7 @@ void tst_qdeclarativeimage::mirror()
             p_e.drawPixmap(QRect(0, 0, width, height), srcPixmap, QRect(0, 0, srcPixmap.width(), srcPixmap.height()));
             break;
         case QDeclarativeImage::PreserveAspectFit:
+            QEXPECT_FAIL("", "QTBUG-19538", Continue);
             p_e.drawPixmap(QRect(25, 0, width / (width/height), height), srcPixmap, QRect(0, 0, srcPixmap.width(), srcPixmap.height()));
             break;
         case QDeclarativeImage::PreserveAspectCrop:
diff --git a/tests/auto/declarative/qdeclarativeimageprovider/qdeclarativeimageprovider.pro b/tests/auto/declarative/qdeclarativeimageprovider/qdeclarativeimageprovider.pro
index 3bf0ea1..29a9ea9 100644
--- a/tests/auto/declarative/qdeclarativeimageprovider/qdeclarativeimageprovider.pro
+++ b/tests/auto/declarative/qdeclarativeimageprovider/qdeclarativeimageprovider.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativeimageprovider
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private
 QT += network
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativeimageprovider/tst_qdeclarativeimageprovider.cpp b/tests/auto/declarative/qdeclarativeimageprovider/tst_qdeclarativeimageprovider.cpp
index b2e5c4e..4d32e33 100644
--- a/tests/auto/declarative/qdeclarativeimageprovider/tst_qdeclarativeimageprovider.cpp
+++ b/tests/auto/declarative/qdeclarativeimageprovider/tst_qdeclarativeimageprovider.cpp
@@ -40,12 +40,11 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QtTest>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeimageprovider.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeimageprovider.h>
 #include <private/qdeclarativeimage_p.h>
 #include <QImageReader>
 #include <QWaitCondition>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeinfo/qdeclarativeinfo.pro b/tests/auto/declarative/qdeclarativeinfo/qdeclarativeinfo.pro
index 423390f..e464fa8 100644
--- a/tests/auto/declarative/qdeclarativeinfo/qdeclarativeinfo.pro
+++ b/tests/auto/declarative/qdeclarativeinfo/qdeclarativeinfo.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativeinfo
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeinfo.cpp
diff --git a/tests/auto/declarative/qdeclarativeinstruction/qdeclarativeinstruction.pro b/tests/auto/declarative/qdeclarativeinstruction/qdeclarativeinstruction.pro
index c8a48c9..de77b72 100644
--- a/tests/auto/declarative/qdeclarativeinstruction/qdeclarativeinstruction.pro
+++ b/tests/auto/declarative/qdeclarativeinstruction/qdeclarativeinstruction.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative script
+CONFIG += testcase
+TARGET = tst_qdeclarativeinstruction
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script script-private core-private
 SOURCES += tst_qdeclarativeinstruction.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativeitem/qdeclarativeitem.pro b/tests/auto/declarative/qdeclarativeitem/qdeclarativeitem.pro
index d8007a0..4620817 100644
--- a/tests/auto/declarative/qdeclarativeitem/qdeclarativeitem.pro
+++ b/tests/auto/declarative/qdeclarativeitem/qdeclarativeitem.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeitem
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui gui-private widgets-private core-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeitem.cpp
diff --git a/tests/auto/declarative/qdeclarativeitem/tst_qdeclarativeitem.cpp b/tests/auto/declarative/qdeclarativeitem/tst_qdeclarativeitem.cpp
index 80a2233..daa195b 100644
--- a/tests/auto/declarative/qdeclarativeitem/tst_qdeclarativeitem.cpp
+++ b/tests/auto/declarative/qdeclarativeitem/tst_qdeclarativeitem.cpp
@@ -40,13 +40,12 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativeitem_p.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativelanguage/qdeclarativelanguage.pro b/tests/auto/declarative/qdeclarativelanguage/qdeclarativelanguage.pro
index cae85a7..14439a3 100644
--- a/tests/auto/declarative/qdeclarativelanguage/qdeclarativelanguage.pro
+++ b/tests/auto/declarative/qdeclarativelanguage/qdeclarativelanguage.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativelanguage
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script-private core-private
 QT += script network
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativelanguage/testtypes.h b/tests/auto/declarative/qdeclarativelanguage/testtypes.h
index 6f21e48..3438d1d 100644
--- a/tests/auto/declarative/qdeclarativelanguage/testtypes.h
+++ b/tests/auto/declarative/qdeclarativelanguage/testtypes.h
@@ -47,12 +47,12 @@
 #include <QtGui/qmatrix.h>
 #include <QtGui/qcolor.h>
 #include <QtGui/qvector3d.h>
-#include <QtDeclarative/qdeclarative.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeparserstatus.h>
-#include <QtDeclarative/qdeclarativepropertyvaluesource.h>
-#include <QtDeclarative/qdeclarativescriptstring.h>
-#include <QtDeclarative/qdeclarativeproperty.h>
+#include <QtQuick1/qdeclarative.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeparserstatus.h>
+#include <QtQuick1/qdeclarativepropertyvaluesource.h>
+#include <QtQuick1/qdeclarativescriptstring.h>
+#include <QtQuick1/qdeclarativeproperty.h>
 
 #include <private/qdeclarativecustomparser_p.h>
 
diff --git a/tests/auto/declarative/qdeclarativelanguage/tst_qdeclarativelanguage.cpp b/tests/auto/declarative/qdeclarativelanguage/tst_qdeclarativelanguage.cpp
index bfc0a5f..e62d5db 100644
--- a/tests/auto/declarative/qdeclarativelanguage/tst_qdeclarativelanguage.cpp
+++ b/tests/auto/declarative/qdeclarativelanguage/tst_qdeclarativelanguage.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <QtCore/qfile.h>
 #include <QtCore/qdebug.h>
 #include <QtCore/qfileinfo.h>
@@ -52,7 +52,6 @@
 
 #include "testtypes.h"
 
-#include "../../../shared/util.h"
 #include "testhttpserver.h"
 
 #ifdef Q_OS_SYMBIAN
diff --git a/tests/auto/declarative/qdeclarativelayoutitem/qdeclarativelayoutitem.pro b/tests/auto/declarative/qdeclarativelayoutitem/qdeclarativelayoutitem.pro
index d89f16c..d07cdad 100644
--- a/tests/auto/declarative/qdeclarativelayoutitem/qdeclarativelayoutitem.pro
+++ b/tests/auto/declarative/qdeclarativelayoutitem/qdeclarativelayoutitem.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativelayoutitem
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativelayoutitem.cpp
diff --git a/tests/auto/declarative/qdeclarativelayoutitem/tst_qdeclarativelayoutitem.cpp b/tests/auto/declarative/qdeclarativelayoutitem/tst_qdeclarativelayoutitem.cpp
index 83848b3..a194e86 100644
--- a/tests/auto/declarative/qdeclarativelayoutitem/tst_qdeclarativelayoutitem.cpp
+++ b/tests/auto/declarative/qdeclarativelayoutitem/tst_qdeclarativelayoutitem.cpp
@@ -47,7 +47,6 @@
 #include <qgraphicsscene.h>
 #include <qgraphicswidget.h>
 #include <qgraphicslinearlayout.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativelistmodel/qdeclarativelistmodel.pro b/tests/auto/declarative/qdeclarativelistmodel/qdeclarativelistmodel.pro
index b5c5cf2..9c27e63 100644
--- a/tests/auto/declarative/qdeclarativelistmodel/qdeclarativelistmodel.pro
+++ b/tests/auto/declarative/qdeclarativelistmodel/qdeclarativelistmodel.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativelistmodel
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script-private core-private gui-private widgets-private
 QT += script
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativelistmodel/tst_qdeclarativelistmodel.cpp b/tests/auto/declarative/qdeclarativelistmodel/tst_qdeclarativelistmodel.cpp
index 3c41002..b0f6019 100644
--- a/tests/auto/declarative/qdeclarativelistmodel/tst_qdeclarativelistmodel.cpp
+++ b/tests/auto/declarative/qdeclarativelistmodel/tst_qdeclarativelistmodel.cpp
@@ -39,11 +39,11 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/private/qdeclarativeitem_p.h>
-#include <QtDeclarative/private/qdeclarativetext_p.h>
-#include <QtDeclarative/private/qdeclarativeengine_p.h>
-#include <QtDeclarative/private/qdeclarativelistmodel_p.h>
-#include <QtDeclarative/private/qdeclarativeexpression_p.h>
+#include <QtQuick1/private/qdeclarativeitem_p.h>
+#include <QtQuick1/private/qdeclarativetext_p.h>
+#include <QtQuick1/private/qdeclarativeengine_p.h>
+#include <QtQuick1/private/qdeclarativelistmodel_p.h>
+#include <QtQuick1/private/qdeclarativeexpression_p.h>
 #include <QDeclarativeComponent>
 
 #include <QtCore/qtimer.h>
@@ -51,8 +51,6 @@
 #include <QtCore/qtranslator.h>
 #include <QSignalSpy>
 
-#include "../../../shared/util.h"
-
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
 #define SRCDIR "."
diff --git a/tests/auto/declarative/qdeclarativelistreference/qdeclarativelistreference.pro b/tests/auto/declarative/qdeclarativelistreference/qdeclarativelistreference.pro
index f3e6f52..cc87f2d 100644
--- a/tests/auto/declarative/qdeclarativelistreference/qdeclarativelistreference.pro
+++ b/tests/auto/declarative/qdeclarativelistreference/qdeclarativelistreference.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativelistreference
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativelistreference.cpp
diff --git a/tests/auto/declarative/qdeclarativelistreference/tst_qdeclarativelistreference.cpp b/tests/auto/declarative/qdeclarativelistreference/tst_qdeclarativelistreference.cpp
index 4d3a057..d47bdab 100644
--- a/tests/auto/declarative/qdeclarativelistreference/tst_qdeclarativelistreference.cpp
+++ b/tests/auto/declarative/qdeclarativelistreference/tst_qdeclarativelistreference.cpp
@@ -45,9 +45,9 @@
 #include <QDir>
 #include <QDeclarativeEngine>
 #include <QDeclarativeComponent>
-#include <QtDeclarative/qdeclarative.h>
-#include <QtDeclarative/qdeclarativeprivate.h>
-#include <QtDeclarative/qdeclarativeproperty.h>
+#include <QtQuick1/qdeclarative.h>
+#include <QtQuick1/qdeclarativeprivate.h>
+#include <QtQuick1/qdeclarativeproperty.h>
 #include <QDebug>
 
 inline QUrl TEST_FILE(const QString &filename)
diff --git a/tests/auto/declarative/qdeclarativelistview/qdeclarativelistview.pro b/tests/auto/declarative/qdeclarativelistview/qdeclarativelistview.pro
index 1633ffc..74525de 100644
--- a/tests/auto/declarative/qdeclarativelistview/qdeclarativelistview.pro
+++ b/tests/auto/declarative/qdeclarativelistview/qdeclarativelistview.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativelistview
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets widgets-private gui-private core-private script-private
 macx:CONFIG -= app_bundle
 
 HEADERS += incrementalmodel.h
diff --git a/tests/auto/declarative/qdeclarativelistview/tst_qdeclarativelistview.cpp b/tests/auto/declarative/qdeclarativelistview/tst_qdeclarativelistview.cpp
index 31a8e2d..08a3e00 100644
--- a/tests/auto/declarative/qdeclarativelistview/tst_qdeclarativelistview.cpp
+++ b/tests/auto/declarative/qdeclarativelistview/tst_qdeclarativelistview.cpp
@@ -40,18 +40,17 @@
 ****************************************************************************/
 
 #include <QtTest/QtTest>
-#include <QtGui/QStringListModel>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
-#include <QtDeclarative/private/qdeclarativeitem_p.h>
-#include <QtDeclarative/private/qdeclarativelistview_p.h>
-#include <QtDeclarative/private/qdeclarativetext_p.h>
-#include <QtDeclarative/private/qdeclarativevisualitemmodel_p.h>
-#include <QtDeclarative/private/qdeclarativelistmodel_p.h>
-#include <QtDeclarative/private/qlistmodelinterface_p.h>
-#include "../../../shared/util.h"
+#include <QtCore/QStringListModel>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeexpression.h>
+#include <QtQuick1/private/qdeclarativeitem_p.h>
+#include <QtQuick1/private/qdeclarativelistview_p.h>
+#include <QtQuick1/private/qdeclarativetext_p.h>
+#include <QtQuick1/private/qdeclarativevisualitemmodel_p.h>
+#include <QtQuick1/private/qdeclarativelistmodel_p.h>
+#include <QtQuick1/private/qlistmodelinterface_p.h>
 #include "incrementalmodel.h"
 
 #ifdef Q_OS_SYMBIAN
diff --git a/tests/auto/declarative/qdeclarativeloader/qdeclarativeloader.pro b/tests/auto/declarative/qdeclarativeloader/qdeclarativeloader.pro
index 1ede509..f75dc60 100644
--- a/tests/auto/declarative/qdeclarativeloader/qdeclarativeloader.pro
+++ b/tests/auto/declarative/qdeclarativeloader/qdeclarativeloader.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui network
+CONFIG += testcase
+TARGET = tst_qdeclarativeloader
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui network
 macx:CONFIG -= app_bundle
 
 INCLUDEPATH += ../shared/
diff --git a/tests/auto/declarative/qdeclarativeloader/tst_qdeclarativeloader.cpp b/tests/auto/declarative/qdeclarativeloader/tst_qdeclarativeloader.cpp
index 186926e..2b93a05 100644
--- a/tests/auto/declarative/qdeclarativeloader/tst_qdeclarativeloader.cpp
+++ b/tests/auto/declarative/qdeclarativeloader/tst_qdeclarativeloader.cpp
@@ -39,15 +39,14 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtGui/QGraphicsWidget>
-#include <QtGui/QGraphicsScene>
+#include <QtWidgets/QGraphicsWidget>
+#include <QtWidgets/QGraphicsScene>
 
 #include <QSignalSpy>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativeloader_p.h>
 #include "testhttpserver.h"
-#include "../../../shared/util.h"
 
 #define SERVER_PORT 14450
 
diff --git a/tests/auto/declarative/qdeclarativemetatype/qdeclarativemetatype.pro b/tests/auto/declarative/qdeclarativemetatype/qdeclarativemetatype.pro
index f13250e..87f95ed 100644
--- a/tests/auto/declarative/qdeclarativemetatype/qdeclarativemetatype.pro
+++ b/tests/auto/declarative/qdeclarativemetatype/qdeclarativemetatype.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativemetatype
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets
 SOURCES += tst_qdeclarativemetatype.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativemetatype/tst_qdeclarativemetatype.cpp b/tests/auto/declarative/qdeclarativemetatype/tst_qdeclarativemetatype.cpp
index e8ca444..38d5adb 100644
--- a/tests/auto/declarative/qdeclarativemetatype/tst_qdeclarativemetatype.cpp
+++ b/tests/auto/declarative/qdeclarativemetatype/tst_qdeclarativemetatype.cpp
@@ -50,6 +50,9 @@
 #include <QVector3D>
 #include <QVector4D>
 #include <QQuaternion>
+#include <QPalette>
+#include <QIcon>
+#include <QCursor>
 #include <qdeclarative.h>
 
 #include <private/qdeclarativemetatype_p.h>
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.2.1.pro b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.2.1.pro
index 661675a..e9dcb87 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.2.1.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.2.1.pro
@@ -1,7 +1,7 @@
 TEMPLATE = lib
 CONFIG += plugin
 SOURCES = plugin.cpp
-QT = core declarative
+QT = core quick1
 DESTDIR = ../imports/com/nokia/AutoTestQmlPluginType.2.1
 
 symbian: {
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.cpp
index 4774c32..fd349c3 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2.1/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <QStringList>
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 #include <QDebug>
 
 class MyPluginType : public QObject
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.2.pro b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.2.pro
index d254642..ff667b8 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.2.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.2.pro
@@ -1,7 +1,7 @@
 TEMPLATE = lib
 CONFIG += plugin
 SOURCES = plugin.cpp
-QT = core declarative
+QT = core quick1
 DESTDIR = ../imports/com/nokia/AutoTestQmlPluginType.2
 
 symbian: {
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.cpp
index 271c59e..cf0ce7d 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/plugin.2/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <QStringList>
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 #include <QDebug>
 
 class MyPluginType : public QObject
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.cpp
index f023963..355e085 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <QStringList>
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 #include <QDebug>
 
 class MyPluginType : public QObject
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.pro b/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.pro
index 173a302..5ccaf8d 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/plugin/plugin.pro
@@ -1,7 +1,7 @@
 TEMPLATE = lib
 CONFIG += plugin
 SOURCES = plugin.cpp
-QT = core declarative
+QT = core quick1
 DESTDIR = ../imports/com/nokia/AutoTestQmlPluginType
 
 symbian: {
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/plugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/plugin.cpp
index 460bcf8..aeff685 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/plugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <QStringList>
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 #include <QDebug>
 
 class BarPluginType : public QObject
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/pluginMixed.pro b/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/pluginMixed.pro
index 9766003..d83ab1e 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/pluginMixed.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginMixed/pluginMixed.pro
@@ -1,7 +1,7 @@
 TEMPLATE = lib
 CONFIG += plugin
 SOURCES = plugin.cpp
-QT = core declarative
+QT = core quick1
 DESTDIR = ../imports/com/nokia/AutoTestQmlMixedPluginType
 
 symbian: {
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/plugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/plugin.cpp
index 427bf64..21e3ba6 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/plugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <QStringList>
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 #include <QDebug>
 
 class FloorPluginType : public QObject
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/pluginVersion.pro b/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/pluginVersion.pro
index 70a38b9..33334d9 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/pluginVersion.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginVersion/pluginVersion.pro
@@ -1,7 +1,7 @@
 TEMPLATE = lib
 CONFIG += plugin
 SOURCES = plugin.cpp
-QT = core declarative
+QT = core quick1
 DESTDIR = ../imports/com/nokia/AutoTestQmlVersionPluginType
 
 symbian: {
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/plugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/plugin.cpp
index 1b5a9d8..da05e47 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/plugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <QStringList>
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 #include <QDebug>
 
 class MyPlugin : public QDeclarativeExtensionPlugin
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/pluginWithQmlFile.pro b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/pluginWithQmlFile.pro
index aa9c95c..62f090a 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/pluginWithQmlFile.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWithQmlFile/pluginWithQmlFile.pro
@@ -1,7 +1,7 @@
 TEMPLATE = lib
 CONFIG += plugin
 SOURCES = plugin.cpp
-QT = core declarative
+QT = core quick1
 DESTDIR = ../imports/com/nokia/AutoTestPluginWithQmlFile
 
 symbian: {
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/plugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/plugin.cpp
index 8397dbf..f0a1527 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/plugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/plugin.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <QStringList>
-#include <QtDeclarative/qdeclarativeextensionplugin.h>
-#include <QtDeclarative/qdeclarative.h>
+#include <QtQuick1/qdeclarativeextensionplugin.h>
+#include <QtQuick1/qdeclarative.h>
 #include <QDebug>
 
 class MyPluginType : public QObject
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/pluginWrongCase.pro b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/pluginWrongCase.pro
index c7337ca..31a4464 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/pluginWrongCase.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/pluginWrongCase/pluginWrongCase.pro
@@ -1,7 +1,7 @@
 TEMPLATE = lib
 CONFIG += plugin
 SOURCES = plugin.cpp
-QT = core declarative
+QT = core quick1
 TARGET = Plugin
 DESTDIR = ../imports/com/nokia/WrongCase
 
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/qdeclarativemoduleplugin.pro b/tests/auto/declarative/qdeclarativemoduleplugin/qdeclarativemoduleplugin.pro
index 6e72d98..248da33 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/qdeclarativemoduleplugin.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/qdeclarativemoduleplugin.pro
@@ -1,4 +1,4 @@
-QT = core
+QT = core testlib
 TEMPLATE = subdirs
 SUBDIRS = plugin plugin.2 plugin.2.1 pluginWrongCase pluginWithQmlFile pluginMixed pluginVersion
 tst_qdeclarativemoduleplugin_pro.depends += plugin
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.cpp b/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.cpp
index cc22da4..f7a4075 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.cpp
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.cpp
@@ -40,13 +40,12 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <qdir.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <QDebug>
 #include <QtCore/qlibraryinfo.h>
 
 #include "../shared/testhttpserver.h"
-#include "../../../shared/util.h"
 
 #define SERVER_ADDR "http://127.0.0.1:14450"
 #define SERVER_PORT 14450
diff --git a/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.pro b/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.pro
index 98cd472..7911605 100644
--- a/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.pro
+++ b/tests/auto/declarative/qdeclarativemoduleplugin/tst_qdeclarativemoduleplugin.pro
@@ -1,10 +1,12 @@
-load(qttest_p4)
+CONFIG += testcase
+TARGET = tst_qdeclarativemoduleplugin
+
+QT += quick1 network testlib
+CONFIG -= app_bundle
 
 HEADERS = ../shared/testhttpserver.h
 SOURCES = tst_qdeclarativemoduleplugin.cpp \
           ../shared/testhttpserver.cpp
-QT += declarative network
-CONFIG -= app_bundle
 
 symbian: {
     importFiles.files = data
diff --git a/tests/auto/declarative/qdeclarativemousearea/qdeclarativemousearea.pro b/tests/auto/declarative/qdeclarativemousearea/qdeclarativemousearea.pro
index ed9313f..731b090 100644
--- a/tests/auto/declarative/qdeclarativemousearea/qdeclarativemousearea.pro
+++ b/tests/auto/declarative/qdeclarativemousearea/qdeclarativemousearea.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui network
+CONFIG += testcase
+TARGET = tst_qdeclarativemousearea
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private widgets gui network
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/testhttpserver.h
diff --git a/tests/auto/declarative/qdeclarativemousearea/tst_qdeclarativemousearea.cpp b/tests/auto/declarative/qdeclarativemousearea/tst_qdeclarativemousearea.cpp
index 078fa12..1da7c21 100644
--- a/tests/auto/declarative/qdeclarativemousearea/tst_qdeclarativemousearea.cpp
+++ b/tests/auto/declarative/qdeclarativemousearea/tst_qdeclarativemousearea.cpp
@@ -41,13 +41,14 @@
 
 #include <QtTest/QtTest>
 #include <QtTest/QSignalSpy>
+#include <QApplication>
 #include <private/qdeclarativemousearea_p.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativeflickable_p.h>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeproperty.h>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeproperty.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeparticles/qdeclarativeparticles.pro b/tests/auto/declarative/qdeclarativeparticles/qdeclarativeparticles.pro
index 2cf8268..3b43ef6 100644
--- a/tests/auto/declarative/qdeclarativeparticles/qdeclarativeparticles.pro
+++ b/tests/auto/declarative/qdeclarativeparticles/qdeclarativeparticles.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeparticles
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeparticles.cpp
diff --git a/tests/auto/declarative/qdeclarativepathview/qdeclarativepathview.pro b/tests/auto/declarative/qdeclarativepathview/qdeclarativepathview.pro
index e0404c5..e4cccef 100644
--- a/tests/auto/declarative/qdeclarativepathview/qdeclarativepathview.pro
+++ b/tests/auto/declarative/qdeclarativepathview/qdeclarativepathview.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativepathview
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui widgets core-private script-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativepathview.cpp
diff --git a/tests/auto/declarative/qdeclarativepathview/tst_qdeclarativepathview.cpp b/tests/auto/declarative/qdeclarativepathview/tst_qdeclarativepathview.cpp
index cb5b135..1d40520 100644
--- a/tests/auto/declarative/qdeclarativepathview/tst_qdeclarativepathview.cpp
+++ b/tests/auto/declarative/qdeclarativepathview/tst_qdeclarativepathview.cpp
@@ -40,24 +40,22 @@
 ****************************************************************************/
 
 #include <QtTest/QtTest>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
-#include <QtDeclarative/private/qdeclarativepathview_p.h>
-#include <QtDeclarative/private/qdeclarativepath_p.h>
-#include <QtDeclarative/private/qdeclarativetext_p.h>
-#include <QtDeclarative/private/qdeclarativerectangle_p.h>
-#include <QtDeclarative/private/qdeclarativelistmodel_p.h>
-#include <QtDeclarative/private/qdeclarativevaluetype_p.h>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeexpression.h>
+#include <QtQuick1/private/qdeclarativepathview_p.h>
+#include <QtQuick1/private/qdeclarativepath_p.h>
+#include <QtQuick1/private/qdeclarativetext_p.h>
+#include <QtQuick1/private/qdeclarativerectangle_p.h>
+#include <QtQuick1/private/qdeclarativelistmodel_p.h>
+#include <QtQuick1/private/qdeclarativevaluetype_p.h>
 #include <QAbstractListModel>
 #include <QStringListModel>
 #include <QStandardItemModel>
 #include <QFile>
 
-#include "../../../shared/util.h"
-
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
 #define SRCDIR "."
diff --git a/tests/auto/declarative/qdeclarativepincharea/qdeclarativepincharea.pro b/tests/auto/declarative/qdeclarativepincharea/qdeclarativepincharea.pro
index 3bdb3fc..d2bf988 100644
--- a/tests/auto/declarative/qdeclarativepincharea/qdeclarativepincharea.pro
+++ b/tests/auto/declarative/qdeclarativepincharea/qdeclarativepincharea.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativepincharea
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativepincharea.cpp
diff --git a/tests/auto/declarative/qdeclarativepincharea/tst_qdeclarativepincharea.cpp b/tests/auto/declarative/qdeclarativepincharea/tst_qdeclarativepincharea.cpp
index 4f63240..bab6079 100644
--- a/tests/auto/declarative/qdeclarativepincharea/tst_qdeclarativepincharea.cpp
+++ b/tests/auto/declarative/qdeclarativepincharea/tst_qdeclarativepincharea.cpp
@@ -41,11 +41,12 @@
 
 #include <QtTest/QtTest>
 #include <QtTest/QSignalSpy>
+#include <QWidget>
 #include <private/qdeclarativepincharea_p.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativeflickable_p.h>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativecontext.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
@@ -55,7 +56,16 @@
 class tst_QDeclarativePinchArea: public QObject
 {
     Q_OBJECT
+public:
+    tst_QDeclarativePinchArea() : device(0) { }
 private slots:
+    void initTestCase() {
+        if (!device) {
+            device = new QTouchDevice;
+            device->setType(QTouchDevice::TouchScreen);
+            QWindowSystemInterface::registerTouchDevice(device);
+        }
+    }
     void pinchProperties();
     void scale();
     void pan();
@@ -63,6 +73,7 @@ private slots:
 
 private:
     QDeclarativeView *createView();
+    QTouchDevice *device;
 };
 
 void tst_QDeclarativePinchArea::pinchProperties()
@@ -218,17 +229,17 @@ void tst_QDeclarativePinchArea::scale()
     QPoint p1(80, 80);
     QPoint p2(100, 100);
 
-    QTest::touchEvent(vp).press(0, p1);
-    QTest::touchEvent(vp).stationary(0).press(1, p2);
+    QTest::touchEvent(vp, device).press(0, p1, canvas);
+    QTest::touchEvent(vp, device).stationary(0).press(1, p2, canvas);
     p1 -= QPoint(10,10);
     p2 += QPoint(10,10);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     QCOMPARE(root->property("scale").toReal(), 1.0);
 
     p1 -= QPoint(10,10);
     p2 += QPoint(10,10);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     QCOMPARE(root->property("scale").toReal(), 1.5);
     QCOMPARE(root->property("center").toPointF(), QPointF(40, 40)); // blackrect is at 50,50
@@ -237,11 +248,11 @@ void tst_QDeclarativePinchArea::scale()
     // scale beyond bound
     p1 -= QPoint(50,50);
     p2 += QPoint(50,50);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     QCOMPARE(blackRect->scale(), 2.0);
 
-    QTest::touchEvent(vp).release(0, p1).release(1, p2);
+    QTest::touchEvent(vp, device).release(0, p1, canvas).release(1, p2, canvas);
 
     delete canvas;
 }
@@ -273,17 +284,17 @@ void tst_QDeclarativePinchArea::pan()
     QPoint p1(80, 80);
     QPoint p2(100, 100);
 
-    QTest::touchEvent(vp).press(0, p1);
-    QTest::touchEvent(vp).stationary(0).press(1, p2);
+    QTest::touchEvent(vp, device).press(0, p1, canvas);
+    QTest::touchEvent(vp, device).stationary(0).press(1, p2, canvas);
     p1 += QPoint(10,10);
     p2 += QPoint(10,10);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     QCOMPARE(root->property("scale").toReal(), 1.0);
 
     p1 += QPoint(10,10);
     p2 += QPoint(10,10);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     QCOMPARE(root->property("center").toPointF(), QPointF(60, 60)); // blackrect is at 50,50
 
@@ -293,12 +304,12 @@ void tst_QDeclarativePinchArea::pan()
     // pan x beyond bound
     p1 += QPoint(100,100);
     p2 += QPoint(100,100);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     QCOMPARE(blackRect->x(), 140.0);
     QCOMPARE(blackRect->y(), 160.0);
 
-    QTest::touchEvent(vp).release(0, p1).release(1, p2);
+    QTest::touchEvent(vp, device).release(0, p1, canvas).release(1, p2, canvas);
 
     delete canvas;
 }
@@ -328,24 +339,24 @@ void tst_QDeclarativePinchArea::flickable()
 
     // begin by moving one touch point (mouse)
     QTest::mousePress(vp, Qt::LeftButton, 0, canvas->mapFromScene(p1));
-    QTest::touchEvent(vp).press(0, p1);
+    QTest::touchEvent(vp, device).press(0, p1, canvas);
     {
         p1 -= QPoint(10,10);
         QMouseEvent mv(QEvent::MouseMove, canvas->mapFromScene(p1), Qt::LeftButton, Qt::LeftButton,Qt::NoModifier);
         QApplication::sendEvent(canvas->viewport(), &mv);
-        QTest::touchEvent(vp).move(0, p1);
+        QTest::touchEvent(vp, device).move(0, p1, canvas);
     }
     {
         p1 -= QPoint(10,10);
         QMouseEvent mv(QEvent::MouseMove, canvas->mapFromScene(p1), Qt::LeftButton, Qt::LeftButton,Qt::NoModifier);
         QApplication::sendEvent(vp, &mv);
-        QTest::touchEvent(vp).move(0, p1);
+        QTest::touchEvent(vp, device).move(0, p1, canvas);
     }
     {
         p1 -= QPoint(10,10);
         QMouseEvent mv(QEvent::MouseMove, canvas->mapFromScene(p1), Qt::LeftButton, Qt::LeftButton,Qt::NoModifier);
         QApplication::sendEvent(vp, &mv);
-        QTest::touchEvent(vp).move(0, p1);
+        QTest::touchEvent(vp, device).move(0, p1, canvas);
     }
 
     // Flickable has reacted to the gesture
@@ -353,23 +364,23 @@ void tst_QDeclarativePinchArea::flickable()
     QVERIFY(root->property("scale").toReal() == 1.0);
 
     // add another touch point and continue moving
-    QTest::touchEvent(vp).stationary(0).press(1, p2);
+    QTest::touchEvent(vp, device).stationary(0).press(1, p2, canvas);
     p1 -= QPoint(10,10);
     p2 += QPoint(10,10);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     QCOMPARE(root->property("scale").toReal(), 1.0);
 
     p1 -= QPoint(10,10);
     p2 += QPoint(10,10);
-    QTest::touchEvent(vp).move(0, p1).move(1, p2);
+    QTest::touchEvent(vp, device).move(0, p1, canvas).move(1, p2, canvas);
 
     // PinchArea has stolen the gesture.
     QVERIFY(!root->isMoving());
     QVERIFY(root->property("scale").toReal() > 1.0);
 
     QTest::mouseRelease(vp, Qt::LeftButton, 0, canvas->mapFromScene(p1));
-    QTest::touchEvent(vp).release(0, p1).release(1, p2);
+    QTest::touchEvent(vp, device).release(0, p1, canvas).release(1, p2, canvas);
 
     delete canvas;
 }
diff --git a/tests/auto/declarative/qdeclarativepixmapcache/qdeclarativepixmapcache.pro b/tests/auto/declarative/qdeclarativepixmapcache/qdeclarativepixmapcache.pro
index 88871e9..153833c 100644
--- a/tests/auto/declarative/qdeclarativepixmapcache/qdeclarativepixmapcache.pro
+++ b/tests/auto/declarative/qdeclarativepixmapcache/qdeclarativepixmapcache.pro
@@ -1,6 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
-QT += network
+CONFIG += testcase
+TARGET = tst_qdeclarativeviewer
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private network
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativepixmapcache.cpp
diff --git a/tests/auto/declarative/qdeclarativepixmapcache/tst_qdeclarativepixmapcache.cpp b/tests/auto/declarative/qdeclarativepixmapcache/tst_qdeclarativepixmapcache.cpp
index 6609485..68f1ef8 100644
--- a/tests/auto/declarative/qdeclarativepixmapcache/tst_qdeclarativepixmapcache.cpp
+++ b/tests/auto/declarative/qdeclarativepixmapcache/tst_qdeclarativepixmapcache.cpp
@@ -41,11 +41,10 @@
 #include <qtest.h>
 #include <QtTest/QtTest>
 #include <private/qdeclarativepixmapcache_p.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeimageprovider.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeimageprovider.h>
 #include <QNetworkReply>
 #include "testhttpserver.h"
-#include "../../../shared/util.h"
 
 #ifndef QT_NO_CONCURRENT
 #include <qtconcurrentrun.h>
diff --git a/tests/auto/declarative/qdeclarativepositioners/qdeclarativepositioners.pro b/tests/auto/declarative/qdeclarativepositioners/qdeclarativepositioners.pro
index 27e5948..7249c2d 100644
--- a/tests/auto/declarative/qdeclarativepositioners/qdeclarativepositioners.pro
+++ b/tests/auto/declarative/qdeclarativepositioners/qdeclarativepositioners.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativepositioners
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private core-private gui-private widgets-private
 SOURCES += tst_qdeclarativepositioners.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativepositioners/tst_qdeclarativepositioners.cpp b/tests/auto/declarative/qdeclarativepositioners/tst_qdeclarativepositioners.cpp
index 31a4939..e0b5310 100644
--- a/tests/auto/declarative/qdeclarativepositioners/tst_qdeclarativepositioners.cpp
+++ b/tests/auto/declarative/qdeclarativepositioners/tst_qdeclarativepositioners.cpp
@@ -47,8 +47,7 @@
 #include <private/qdeclarativetransition_p.h>
 #include <private/qdeclarativeitem_p.h>
 #include <qdeclarativeexpression.h>
-#include <QtGui/qgraphicswidget.h>
-#include "../../../shared/util.h"
+#include <QtWidgets/qgraphicswidget.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeproperty/qdeclarativeproperty.pro b/tests/auto/declarative/qdeclarativeproperty/qdeclarativeproperty.pro
index 1750860..6c4d560 100644
--- a/tests/auto/declarative/qdeclarativeproperty/qdeclarativeproperty.pro
+++ b/tests/auto/declarative/qdeclarativeproperty/qdeclarativeproperty.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativeproperty
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script-private core-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeproperty.cpp
diff --git a/tests/auto/declarative/qdeclarativeproperty/tst_qdeclarativeproperty.cpp b/tests/auto/declarative/qdeclarativeproperty/tst_qdeclarativeproperty.cpp
index 1f464bf..3b524a4 100644
--- a/tests/auto/declarative/qdeclarativeproperty/tst_qdeclarativeproperty.cpp
+++ b/tests/auto/declarative/qdeclarativeproperty/tst_qdeclarativeproperty.cpp
@@ -39,12 +39,12 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeproperty.h>
-#include <QtDeclarative/private/qdeclarativeproperty_p.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeproperty.h>
+#include <QtQuick1/private/qdeclarativeproperty_p.h>
 #include <private/qdeclarativebinding_p.h>
-#include <QtGui/QLineEdit>
+#include <QtWidgets/QLineEdit>
 #include <QtCore/qfileinfo.h>
 #include <QtCore/qdir.h>
 
diff --git a/tests/auto/declarative/qdeclarativepropertymap/qdeclarativepropertymap.pro b/tests/auto/declarative/qdeclarativepropertymap/qdeclarativepropertymap.pro
index 3c0f7b3..f8ffe29 100644
--- a/tests/auto/declarative/qdeclarativepropertymap/qdeclarativepropertymap.pro
+++ b/tests/auto/declarative/qdeclarativepropertymap/qdeclarativepropertymap.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativepropertymap
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativepropertymap.cpp
diff --git a/tests/auto/declarative/qdeclarativepropertymap/tst_qdeclarativepropertymap.cpp b/tests/auto/declarative/qdeclarativepropertymap/tst_qdeclarativepropertymap.cpp
index 33a6689..66b3d6e 100644
--- a/tests/auto/declarative/qdeclarativepropertymap/tst_qdeclarativepropertymap.cpp
+++ b/tests/auto/declarative/qdeclarativepropertymap/tst_qdeclarativepropertymap.cpp
@@ -39,10 +39,10 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativepropertymap.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativepropertymap.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativetext_p.h>
 #include <QSignalSpy>
 
diff --git a/tests/auto/declarative/qdeclarativeqt/qdeclarativeqt.pro b/tests/auto/declarative/qdeclarativeqt/qdeclarativeqt.pro
index 4b197eb..7344860 100644
--- a/tests/auto/declarative/qdeclarativeqt/qdeclarativeqt.pro
+++ b/tests/auto/declarative/qdeclarativeqt/qdeclarativeqt.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative script
+CONFIG += testcase
+TARGET = tst_qdeclarativeqt
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script script-private core-private
 SOURCES += tst_qdeclarativeqt.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativerepeater/qdeclarativerepeater.pro b/tests/auto/declarative/qdeclarativerepeater/qdeclarativerepeater.pro
index 5230f69..dcedb15 100644
--- a/tests/auto/declarative/qdeclarativerepeater/qdeclarativerepeater.pro
+++ b/tests/auto/declarative/qdeclarativerepeater/qdeclarativerepeater.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativerepeater
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativerepeater.cpp
diff --git a/tests/auto/declarative/qdeclarativerepeater/tst_qdeclarativerepeater.cpp b/tests/auto/declarative/qdeclarativerepeater/tst_qdeclarativerepeater.cpp
index 1e2a4ad..db94f0e 100644
--- a/tests/auto/declarative/qdeclarativerepeater/tst_qdeclarativerepeater.cpp
+++ b/tests/auto/declarative/qdeclarativerepeater/tst_qdeclarativerepeater.cpp
@@ -42,10 +42,10 @@
 #include <QtTest/QtTest>
 #include <QtTest/QSignalSpy>
 #include <private/qlistmodelinterface_p.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeexpression.h>
 #include <private/qdeclarativerepeater_p.h>
 #include <private/qdeclarativetext_p.h>
 
diff --git a/tests/auto/declarative/qdeclarativesmoothedanimation/qdeclarativesmoothedanimation.pro b/tests/auto/declarative/qdeclarativesmoothedanimation/qdeclarativesmoothedanimation.pro
index 1e77d6e..b230d80 100644
--- a/tests/auto/declarative/qdeclarativesmoothedanimation/qdeclarativesmoothedanimation.pro
+++ b/tests/auto/declarative/qdeclarativesmoothedanimation/qdeclarativesmoothedanimation.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativesmoothedanimation
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui core-private script-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativesmoothedanimation.cpp
diff --git a/tests/auto/declarative/qdeclarativesmoothedanimation/tst_qdeclarativesmoothedanimation.cpp b/tests/auto/declarative/qdeclarativesmoothedanimation/tst_qdeclarativesmoothedanimation.cpp
index c779c8f..eae5119 100644
--- a/tests/auto/declarative/qdeclarativesmoothedanimation/tst_qdeclarativesmoothedanimation.cpp
+++ b/tests/auto/declarative/qdeclarativesmoothedanimation/tst_qdeclarativesmoothedanimation.cpp
@@ -39,12 +39,11 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativesmoothedanimation_p.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativevaluetype_p.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativespringanimation/qdeclarativespringanimation.pro b/tests/auto/declarative/qdeclarativespringanimation/qdeclarativespringanimation.pro
index da477fc..cc96cf2 100644
--- a/tests/auto/declarative/qdeclarativespringanimation/qdeclarativespringanimation.pro
+++ b/tests/auto/declarative/qdeclarativespringanimation/qdeclarativespringanimation.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativespringanimation
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui core-private script-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativespringanimation.cpp
diff --git a/tests/auto/declarative/qdeclarativespringanimation/tst_qdeclarativespringanimation.cpp b/tests/auto/declarative/qdeclarativespringanimation/tst_qdeclarativespringanimation.cpp
index d97705a..053bafd 100644
--- a/tests/auto/declarative/qdeclarativespringanimation/tst_qdeclarativespringanimation.cpp
+++ b/tests/auto/declarative/qdeclarativespringanimation/tst_qdeclarativespringanimation.cpp
@@ -39,11 +39,10 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativespringanimation_p.h>
 #include <private/qdeclarativevaluetype_p.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativestates/qdeclarativestates.pro b/tests/auto/declarative/qdeclarativestates/qdeclarativestates.pro
index 4a0cc24..2c4c63b 100644
--- a/tests/auto/declarative/qdeclarativestates/qdeclarativestates.pro
+++ b/tests/auto/declarative/qdeclarativestates/qdeclarativestates.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativestates
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private core-private script-private widgets-private gui-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativestates.cpp
diff --git a/tests/auto/declarative/qdeclarativestates/tst_qdeclarativestates.cpp b/tests/auto/declarative/qdeclarativestates/tst_qdeclarativestates.cpp
index eb2558b..1cf8453 100644
--- a/tests/auto/declarative/qdeclarativestates/tst_qdeclarativestates.cpp
+++ b/tests/auto/declarative/qdeclarativestates/tst_qdeclarativestates.cpp
@@ -39,8 +39,8 @@
 **
 ****************************************************************************/
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativeanchors_p_p.h>
 #include <private/qdeclarativerectangle_p.h>
 #include <private/qdeclarativeimage_p.h>
diff --git a/tests/auto/declarative/qdeclarativestyledtext/qdeclarativestyledtext.pro b/tests/auto/declarative/qdeclarativestyledtext/qdeclarativestyledtext.pro
index 87d0e5b..120f731 100644
--- a/tests/auto/declarative/qdeclarativestyledtext/qdeclarativestyledtext.pro
+++ b/tests/auto/declarative/qdeclarativestyledtext/qdeclarativestyledtext.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativestyledtext
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private
 QT += network
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativesystempalette/qdeclarativesystempalette.pro b/tests/auto/declarative/qdeclarativesystempalette/qdeclarativesystempalette.pro
index 0062688..3e2a44e 100644
--- a/tests/auto/declarative/qdeclarativesystempalette/qdeclarativesystempalette.pro
+++ b/tests/auto/declarative/qdeclarativesystempalette/qdeclarativesystempalette.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativesystempalette
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativesystempalette.cpp
diff --git a/tests/auto/declarative/qdeclarativesystempalette/tst_qdeclarativesystempalette.cpp b/tests/auto/declarative/qdeclarativesystempalette/tst_qdeclarativesystempalette.cpp
index 99490c2..6ee3fd4 100644
--- a/tests/auto/declarative/qdeclarativesystempalette/tst_qdeclarativesystempalette.cpp
+++ b/tests/auto/declarative/qdeclarativesystempalette/tst_qdeclarativesystempalette.cpp
@@ -41,11 +41,10 @@
 
 #include <qtest.h>
 #include <QDebug>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativesystempalette_p.h>
 #include <qpalette.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativetext/qdeclarativetext.pro b/tests/auto/declarative/qdeclarativetext/qdeclarativetext.pro
index c0831f7..b015593 100644
--- a/tests/auto/declarative/qdeclarativetext/qdeclarativetext.pro
+++ b/tests/auto/declarative/qdeclarativetext/qdeclarativetext.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativetext
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui gui-private widgets widgets-private core-private script-private
 QT += network
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/qdeclarativetext/tst_qdeclarativetext.cpp b/tests/auto/declarative/qdeclarativetext/tst_qdeclarativetext.cpp
index af35416..0d0eb63 100644
--- a/tests/auto/declarative/qdeclarativetext/tst_qdeclarativetext.cpp
+++ b/tests/auto/declarative/qdeclarativetext/tst_qdeclarativetext.cpp
@@ -40,8 +40,8 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QTextDocument>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativetext_p.h>
 #include <private/qdeclarativetext_p_p.h>
 #include <private/qdeclarativevaluetype_p.h>
@@ -52,7 +52,6 @@
 #include <private/qapplication_p.h>
 #include <limits.h>
 
-#include "../../../shared/util.h"
 #include "testhttpserver.h"
 
 #ifdef Q_OS_SYMBIAN
diff --git a/tests/auto/declarative/qdeclarativetextedit/qdeclarativetextedit.pro b/tests/auto/declarative/qdeclarativetextedit/qdeclarativetextedit.pro
index aaf753e..af7f989 100644
--- a/tests/auto/declarative/qdeclarativetextedit/qdeclarativetextedit.pro
+++ b/tests/auto/declarative/qdeclarativetextedit/qdeclarativetextedit.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui network
+CONFIG += testcase
+TARGET = tst_qdeclarativetextedit
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui gui-private widgets widgets-private network core-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativetextedit.cpp ../shared/testhttpserver.cpp
diff --git a/tests/auto/declarative/qdeclarativetextedit/tst_qdeclarativetextedit.cpp b/tests/auto/declarative/qdeclarativetextedit/tst_qdeclarativetextedit.cpp
index 31da832..c165e62 100644
--- a/tests/auto/declarative/qdeclarativetextedit/tst_qdeclarativetextedit.cpp
+++ b/tests/auto/declarative/qdeclarativetextedit/tst_qdeclarativetextedit.cpp
@@ -40,26 +40,26 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
-#include "../../../shared/util.h"
 #include "../shared/testhttpserver.h"
 #include <math.h>
 #include <QFile>
 #include <QTextDocument>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeexpression.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativetextedit_p.h>
 #include <private/qdeclarativetextedit_p_p.h>
 #include <QFontMetrics>
-#include <QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 #include <QDir>
 #include <QStyle>
-#include <QInputContext>
 #include <QClipboard>
 #include <QMimeData>
 #include <private/qapplication_p.h>
+#include <private/qinputpanel_p.h>
 #include <private/qtextcontrol_p.h>
+#include "../shared/platforminputcontext.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
@@ -84,6 +84,15 @@ QString createExpectedFileIfNotFound(const QString& filebasename, const QImage&
     return expectfile;
 }
 
+void sendPreeditText(const QString &text, int cursor)
+{
+    QList<QInputMethodEvent::Attribute> attributes;
+    attributes.append(QInputMethodEvent::Attribute(QInputMethodEvent::Cursor, cursor,
+                                                   text.length(), QVariant()));
+    QInputMethodEvent event(text, attributes);
+    QApplication::sendEvent(qApp->inputPanel()->inputItem(), &event);
+}
+
 
 class tst_qdeclarativetextedit : public QObject
 
@@ -93,6 +102,8 @@ public:
     tst_qdeclarativetextedit();
 
 private slots:
+    void cleanup();
+
     void text();
     void width();
     void wrap();
@@ -221,6 +232,13 @@ tst_qdeclarativetextedit::tst_qdeclarativetextedit()
                  // 
 }
 
+void tst_qdeclarativetextedit::cleanup()
+{
+    // ensure not even skipped tests with custom input context leave it dangling
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = 0;
+}
+
 void tst_qdeclarativetextedit::text()
 {
     {
@@ -547,11 +565,11 @@ void tst_qdeclarativetextedit::hAlign_RightToLeft()
 
 #ifndef Q_OS_MAC    // QTBUG-18040
     // empty text with implicit alignment follows the system locale-based
-    // keyboard input direction from QApplication::keyboardInputDirection
+    // keyboard input direction from QInputPanel::inputDirection
     textEdit->setText("");
-    QCOMPARE(textEdit->hAlign(), QApplication::keyboardInputDirection() == Qt::LeftToRight ?
+    QCOMPARE(textEdit->hAlign(), qApp->inputPanel()->inputDirection() == Qt::LeftToRight ?
                                   QDeclarativeTextEdit::AlignLeft : QDeclarativeTextEdit::AlignRight);
-    if (QApplication::keyboardInputDirection() == Qt::LeftToRight)
+    if (qApp->inputPanel()->inputDirection() == Qt::LeftToRight)
         QVERIFY(textEdit->positionToRectangle(0).x() < canvas->width()/2);
     else
         QVERIFY(textEdit->positionToRectangle(0).x() > canvas->width()/2);
@@ -568,7 +586,7 @@ void tst_qdeclarativetextedit::hAlign_RightToLeft()
     QDeclarativeComponent textComponent(&engine);
     textComponent.setData(componentStr.toLatin1(), QUrl::fromLocalFile(""));
     QDeclarativeTextEdit *textObject = qobject_cast<QDeclarativeTextEdit*>(textComponent.create());
-    QCOMPARE(textObject->hAlign(), QApplication::keyboardInputDirection() == Qt::LeftToRight ?
+    QCOMPARE(textObject->hAlign(), qApp->inputPanel()->inputDirection() == Qt::LeftToRight ?
                                   QDeclarativeTextEdit::AlignLeft : QDeclarativeTextEdit::AlignRight);
     delete textObject;
 #endif
@@ -1632,6 +1650,7 @@ void tst_qdeclarativetextedit::positionAt()
     QDeclarativeTextEdit *texteditObject = qobject_cast<QDeclarativeTextEdit *>(canvas->rootObject());
     QVERIFY(texteditObject != 0);
 
+    /*
     QFontMetrics fm(texteditObject->font());
     const int y0 = fm.height() / 2;
     const int y1 = fm.height() * 3 / 2;
@@ -1645,6 +1664,24 @@ void tst_qdeclarativetextedit::positionAt()
 #else
     QVERIFY(diff < 5);
 #endif
+    */
+    QTextLayout layout(texteditObject->text());
+    layout.setFont(texteditObject->font());
+
+    layout.beginLayout();
+    QTextLine line = layout.createLine();
+    layout.endLayout();
+
+    const int y0 = line.height() / 2;
+    const int y1 = line.height() * 3 / 2;
+
+    int pos = texteditObject->positionAt(texteditObject->width()/2, y0);
+
+    int widthBegin = floor(line.cursorToX(pos - 1));
+    int widthEnd = ceil(line.cursorToX(pos + 1));
+
+    QVERIFY(widthBegin <= texteditObject->width() / 2);
+    QVERIFY(widthEnd >= texteditObject->width() / 2);
 
     const qreal x0 = texteditObject->positionToRectangle(pos).x();
     const qreal x1 = texteditObject->positionToRectangle(pos + 1).x();
@@ -1923,7 +1960,7 @@ void tst_qdeclarativetextedit::copyAndPaste() {
         if (status == noErr)
             CFRelease(pasteboard);
         else
-            QSKIP("This machine doesn't support the clipboard", SkipAll);
+            QSKIP("This machine doesn't support the clipboard");
     }
 #endif
 
@@ -2050,63 +2087,6 @@ QDeclarativeView *tst_qdeclarativetextedit::createView(const QString &filename)
     return canvas;
 }
 
-class MyInputContext : public QInputContext
-{
-public:
-    MyInputContext() : openInputPanelReceived(false), closeInputPanelReceived(false), updateReceived(false), eventType(QEvent::None) {}
-    ~MyInputContext() {}
-
-    QString identifierName() { return QString(); }
-    QString language() { return QString(); }
-
-    void reset() {}
-
-    bool isComposing() const { return false; }
-
-    bool filterEvent( const QEvent *event )
-    {
-        if (event->type() == QEvent::RequestSoftwareInputPanel)
-            openInputPanelReceived = true;
-        if (event->type() == QEvent::CloseSoftwareInputPanel)
-            closeInputPanelReceived = true;
-        return QInputContext::filterEvent(event);
-    }
-
-    void update() { updateReceived = true; }
-
-    void sendPreeditText(const QString &text, int cursor)
-    {
-        QList<QInputMethodEvent::Attribute> attributes;
-        attributes.append(QInputMethodEvent::Attribute(
-                QInputMethodEvent::Cursor, cursor, text.length(), QVariant()));
-
-        QInputMethodEvent event(text, attributes);
-        sendEvent(event);
-    }
-
-    void mouseHandler(int x, QMouseEvent *event)
-    {
-        cursor = x;
-        eventType = event->type();
-        eventPosition = event->pos();
-        eventGlobalPosition = event->globalPos();
-        eventButton = event->button();
-        eventButtons = event->buttons();
-        eventModifiers = event->modifiers();
-    }
-
-    bool openInputPanelReceived;
-    bool closeInputPanelReceived;
-    bool updateReceived;
-    int cursor;
-    QEvent::Type eventType;
-    QPoint eventPosition;
-    QPoint eventGlobalPosition;
-    Qt::MouseButton eventButton;
-    Qt::MouseButtons eventButtons;
-    Qt::KeyboardModifiers eventModifiers;
-};
-
 void tst_qdeclarativetextedit::textInput()
 {
     QGraphicsScene scene;
@@ -2136,10 +2116,12 @@ void tst_qdeclarativetextedit::textInput()
 
 void tst_qdeclarativetextedit::openInputPanelOnClick()
 {
+    PlatformInputContext ic;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &ic;
+
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextEdit edit;
     QSignalSpy focusOnPressSpy(&edit, SIGNAL(activeFocusOnPressChanged(bool)));
     edit.setText("Hello world");
@@ -2162,14 +2144,14 @@ void tst_qdeclarativetextedit::openInputPanelOnClick()
     QTest::mouseClick(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(edit.scenePos()));
     QApplication::processEvents();
     if (behavior == QStyle::RSIP_OnMouseClickAndAlreadyFocused) {
-        QCOMPARE(ic.openInputPanelReceived, false);
+        QCOMPARE(ic.isInputPanelVisible(), false);
         QTest::mouseClick(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(edit.scenePos()));
         QApplication::processEvents();
-        QCOMPARE(ic.openInputPanelReceived, true);
+        QCOMPARE(ic.isInputPanelVisible(), true);
     } else if (behavior == QStyle::RSIP_OnMouseClick) {
-        QCOMPARE(ic.openInputPanelReceived, true);
+        QCOMPARE(ic.isInputPanelVisible(), true);
     }
-    ic.openInputPanelReceived = false;
+    ic.clear();
 
     // focus should not cause input panels to open or close
     edit.setFocus(false);
@@ -2178,16 +2160,18 @@ void tst_qdeclarativetextedit::openInputPanelOnClick()
     edit.setFocus(true);
     edit.setFocus(false);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
 }
 
 void tst_qdeclarativetextedit::openInputPanelOnFocus()
 {
+    PlatformInputContext ic;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &ic;
+
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextEdit edit;
     QSignalSpy focusOnPressSpy(&edit, SIGNAL(activeFocusOnPressChanged(bool)));
     edit.setText("Hello world");
@@ -2205,27 +2189,27 @@ void tst_qdeclarativetextedit::openInputPanelOnFocus()
 
     // test default values
     QVERIFY(edit.focusOnPress());
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
 
     // focus on press, input panel on focus
     QTest::mousePress(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(edit.scenePos()));
     QApplication::processEvents();
     QVERIFY(edit.hasActiveFocus());
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
 
     // no events on release
     QTest::mouseRelease(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(edit.scenePos()));
-    QCOMPARE(ic.openInputPanelReceived, false);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), false);
+    ic.clear();
 
     // if already focused, input panel can be opened on press
     QVERIFY(edit.hasActiveFocus());
     QTest::mousePress(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(edit.scenePos()));
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
 
     // input method should stay enabled if focus
     // is lost to an item that also accepts inputs
@@ -2233,9 +2217,8 @@ void tst_qdeclarativetextedit::openInputPanelOnFocus()
     scene.addItem(&anotherEdit);
     anotherEdit.setFocus(true);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
-    QCOMPARE(view.inputContext(), (QInputContext*)&ic);
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
     QVERIFY(view.testAttribute(Qt::WA_InputMethodEnabled));
 
     // input method should be disabled if focus
@@ -2244,8 +2227,7 @@ void tst_qdeclarativetextedit::openInputPanelOnFocus()
     scene.addItem(&item);
     item.setFocus(true);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QVERIFY(view.inputContext() == 0);
+    QCOMPARE(ic.isInputPanelVisible(), false);
     QVERIFY(!view.testAttribute(Qt::WA_InputMethodEnabled));
 
     // no automatic input panel events should
@@ -2259,22 +2241,22 @@ void tst_qdeclarativetextedit::openInputPanelOnFocus()
     QTest::mousePress(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(edit.scenePos()));
     QTest::mouseRelease(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(edit.scenePos()));
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
 
     // one show input panel event should
     // be set when openSoftwareInputPanel is called
     edit.openSoftwareInputPanel();
-    QCOMPARE(ic.openInputPanelReceived, true);
-    QCOMPARE(ic.closeInputPanelReceived, false);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
+    ic.clear();
 
     // one close input panel event should
     // be sent when closeSoftwareInputPanel is called
     edit.closeSoftwareInputPanel();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, true);
-    ic.closeInputPanelReceived = false;
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QVERIFY(ic.m_hideInputPanelCallCount > 0);
+    ic.clear();
 
     // set activeFocusOnPress back to true
     edit.setFocusOnPress(true);
@@ -2283,33 +2265,31 @@ void tst_qdeclarativetextedit::openInputPanelOnFocus()
     QCOMPARE(focusOnPressSpy.count(),2);
     edit.setFocus(false);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
-    ic.closeInputPanelReceived = false;
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
+    ic.clear();
 
     // input panel should not re-open
     // if focus has already been set
     edit.setFocus(true);
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
     edit.setFocus(true);
-    QCOMPARE(ic.openInputPanelReceived, false);
+    QCOMPARE(ic.isInputPanelVisible(), false);
 
     // input method should be disabled
     // if TextEdit loses focus
     edit.setFocus(false);
     QApplication::processEvents();
-    QVERIFY(view.inputContext() == 0);
     QVERIFY(!view.testAttribute(Qt::WA_InputMethodEnabled));
 
     // input method should not be enabled
     // if TextEdit is read only.
     edit.setReadOnly(true);
-    ic.openInputPanelReceived = false;
+    ic.clear();
     edit.setFocus(true);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QVERIFY(view.inputContext() == 0);
+    QCOMPARE(ic.isInputPanelVisible(), false);
     QVERIFY(!view.testAttribute(Qt::WA_InputMethodEnabled));
 }
 
@@ -2466,12 +2446,12 @@ void tst_qdeclarativetextedit::testQtQuick11Attributes_data()
 
 void tst_qdeclarativetextedit::preeditMicroFocus()
 {
-    QString preeditText = "super";
+    PlatformInputContext ic;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &ic;
 
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextEdit edit;
     edit.setFocus(true);
     scene.addItem(&edit);
@@ -2485,26 +2465,28 @@ void tst_qdeclarativetextedit::preeditMicroFocus()
     QRect currentRect;
     QRect previousRect = edit.inputMethodQuery(Qt::ImMicroFocus).toRect();
 
+    QString preeditText = "super";
+
     // Verify that the micro focus rect is positioned the same for position 0 as
     // it would be if there was no preedit text.
-    ic.updateReceived = false;
-    ic.sendPreeditText(preeditText, 0);
+    ic.clear();
+    sendPreeditText(preeditText, 0);
     currentRect = edit.inputMethodQuery(Qt::ImMicroFocus).toRect();
     QCOMPARE(currentRect, previousRect);
-#if defined(Q_WS_X11) || defined(Q_WS_QWS) || defined(Q_OS_SYMBIAN)
-    QCOMPARE(ic.updateReceived, false); // The cursor position hasn't changed.
+#if defined(Q_WS_X11) || defined(Q_WS_QWS)
+    QCOMPARE(ic.updateCallCount, 0); // The cursor position hasn't changed.
 #endif
     QCOMPARE(cursorRectangleSpy.count(), 0);
 
     // Verify that the micro focus rect moves to the left as the cursor position
     // is incremented.
     for (int i = 1; i <= 5; ++i) {
-        ic.updateReceived = false;
-        ic.sendPreeditText(preeditText, i);
+        ic.clear();
+        sendPreeditText(preeditText, i);
         currentRect = edit.inputMethodQuery(Qt::ImMicroFocus).toRect();
         QVERIFY(previousRect.left() < currentRect.left());
-#if defined(Q_WS_X11) || defined(Q_WS_QWS) || defined(Q_OS_SYMBIAN)
-        QCOMPARE(ic.updateReceived, true);
+#if defined(Q_WS_X11) || defined(Q_WS_QWS)
+        QVERIFY(ic.updateCallCount > 0);
 #endif
         QVERIFY(cursorRectangleSpy.count() > 0);
         cursorRectangleSpy.clear();
@@ -2513,25 +2495,28 @@ void tst_qdeclarativetextedit::preeditMicroFocus()
 
     // Verify that if there is no preedit cursor then the micro focus rect is the
     // same as it would be if it were positioned at the end of the preedit text.
-    ic.sendPreeditText(preeditText, 0);
-    ic.updateReceived = false;
-    ic.sendEvent(QInputMethodEvent(preeditText, QList<QInputMethodEvent::Attribute>()));
+    sendPreeditText(preeditText, 0);
+    ic.clear();
+    QInputMethodEvent imEvent(preeditText, QList<QInputMethodEvent::Attribute>());
+    QApplication::sendEvent(qApp->inputPanel()->inputItem(), &imEvent);
     currentRect = edit.inputMethodQuery(Qt::ImMicroFocus).toRect();
     QCOMPARE(currentRect, previousRect);
-#if defined(Q_WS_X11) || defined(Q_WS_QWS) || defined(Q_OS_SYMBIAN)
-    QCOMPARE(ic.updateReceived, true);
+#if defined(Q_WS_X11) || defined(Q_WS_QWS)
+    QVERIFY(ic.updateCallCount > 0);
 #endif
     QVERIFY(cursorRectangleSpy.count() > 0);
 }
 
 void tst_qdeclarativetextedit::inputContextMouseHandler()
 {
+    PlatformInputContext ic;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &ic;
+
     QString text = "supercalifragisiticexpialidocious!";
 
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextEdit edit;
     edit.setPos(0, 0);
     edit.setWidth(200);
@@ -2550,98 +2535,17 @@ void tst_qdeclarativetextedit::inputContextMouseHandler()
     const qreal y = fm.height() / 2;
 
     QPoint position2 = view.mapFromScene(edit.mapToScene(QPointF(fm.width(text.mid(0, 2)), y)));
-    QPoint position8 = view.mapFromScene(edit.mapToScene(QPointF(fm.width(text.mid(0, 8)), y)));
-    QPoint position20 = view.mapFromScene(edit.mapToScene(QPointF(fm.width(text.mid(0, 20)), y)));
-    QPoint position27 = view.mapFromScene(edit.mapToScene(QPointF(fm.width(text.mid(0, 27)), y)));
-    QPoint globalPosition2 = view.viewport()->mapToGlobal(position2);
-    QPoint globalposition8 = view.viewport()->mapToGlobal(position8);
-    QPoint globalposition20 = view.viewport()->mapToGlobal(position20);
-    QPoint globalposition27 = view.viewport()->mapToGlobal(position27);
-
-    ic.sendEvent(QInputMethodEvent(text.mid(12), QList<QInputMethodEvent::Attribute>()));
-
-    QTest::mouseDClick(view.viewport(), Qt::LeftButton, Qt::NoModifier, position2);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonDblClick);
-    QCOMPARE(ic.eventPosition, position2);
-    QCOMPARE(ic.eventGlobalPosition, globalPosition2);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor < 0);
-    ic.eventType = QEvent::None;
 
-    QTest::mousePress(view.viewport(), Qt::LeftButton, Qt::NoModifier, position2);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonPress);
-    QCOMPARE(ic.eventPosition, position2);
-    QCOMPARE(ic.eventGlobalPosition, globalPosition2);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor < 0);
-    ic.eventType = QEvent::None;
-
-    {   QMouseEvent mv(QEvent::MouseMove, position8, globalposition8, Qt::LeftButton, Qt::LeftButton,Qt::NoModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::None);
-
-    {   QMouseEvent mv(QEvent::MouseMove, position27, globalposition27, Qt::LeftButton, Qt::LeftButton,Qt::NoModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::MouseMove);
-    QCOMPARE(ic.eventPosition, position27);
-        QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);    // 15 is expected but some platforms may be off by one.
-    ic.eventType = QEvent::None;
-
-    QTest::mouseRelease(view.viewport(), Qt::LeftButton, Qt::NoModifier, position27);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonRelease);
-    QCOMPARE(ic.eventPosition, position27);
-    QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);
-    ic.eventType = QEvent::None;
-
-    // And in the other direction.
-    QTest::mouseDClick(view.viewport(), Qt::LeftButton, Qt::ControlModifier, position27);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonDblClick);
-    QCOMPARE(ic.eventPosition, position27);
-    QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);
-    ic.eventType = QEvent::None;
-
-    QTest::mousePress(view.viewport(), Qt::RightButton, Qt::ControlModifier, position27);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonPress);
-    QCOMPARE(ic.eventPosition, position27);
-    QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::RightButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);
-    ic.eventType = QEvent::None;
-
-    {   QMouseEvent mv(QEvent::MouseMove, position20, globalposition20, Qt::RightButton, Qt::RightButton,Qt::ControlModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::MouseMove);
-    QCOMPARE(ic.eventPosition, position20);
-    QCOMPARE(ic.eventGlobalPosition, globalposition20);
-    QCOMPARE(ic.eventButton, Qt::RightButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor >= 7 && ic.cursor <= 9);
-    ic.eventType = QEvent::None;
-
-    {   QMouseEvent mv(QEvent::MouseMove, position2, globalPosition2, Qt::RightButton, Qt::RightButton,Qt::ControlModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::None);
+    QInputMethodEvent inputEvent(text.mid(0, 12), QList<QInputMethodEvent::Attribute>());
+    QApplication::sendEvent(&view, &inputEvent);
 
+    QTest::mousePress(view.viewport(), Qt::LeftButton, Qt::NoModifier, position2);
     QTest::mouseRelease(view.viewport(), Qt::RightButton, Qt::ControlModifier, position2);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonRelease);
-    QCOMPARE(ic.eventPosition, position2);
-    QCOMPARE(ic.eventGlobalPosition, globalPosition2);
-    QCOMPARE(ic.eventButton, Qt::RightButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor < 0);
-    ic.eventType = QEvent::None;
+    QApplication::processEvents();
+
+    QCOMPARE(ic.m_action, QInputPanel::Click);
+    QCOMPARE(ic.m_invokeActionCallCount, 1);
+    QCOMPARE(ic.m_cursorPosition, 2);
 }
 
 void tst_qdeclarativetextedit::inputMethodComposing()
@@ -2650,8 +2554,6 @@ void tst_qdeclarativetextedit::inputMethodComposing()
 
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextEdit edit;
     edit.setWidth(200);
     edit.setText(text.mid(0, 12));
@@ -2668,15 +2570,24 @@ void tst_qdeclarativetextedit::inputMethodComposing()
 
     QCOMPARE(edit.isInputMethodComposing(), false);
 
-    ic.sendEvent(QInputMethodEvent(text.mid(3), QList<QInputMethodEvent::Attribute>()));
+    {
+        QInputMethodEvent imEvent(text.mid(3), QList<QInputMethodEvent::Attribute>());
+        QApplication::sendEvent(&view, &imEvent);
+    }
     QCOMPARE(edit.isInputMethodComposing(), true);
     QCOMPARE(spy.count(), 1);
 
-    ic.sendEvent(QInputMethodEvent(text.mid(12), QList<QInputMethodEvent::Attribute>()));
+    {
+        QInputMethodEvent imEvent(text.mid(12), QList<QInputMethodEvent::Attribute>());
+        QApplication::sendEvent(&view, &imEvent);
+    }
     QCOMPARE(edit.isInputMethodComposing(), true);
     QCOMPARE(spy.count(), 1);
 
-    ic.sendEvent(QInputMethodEvent());
+    {
+        QInputMethodEvent imEvent;
+        QApplication::sendEvent(&view, &imEvent);
+    }
     QCOMPARE(edit.isInputMethodComposing(), false);
     QCOMPARE(spy.count(), 2);
 }
diff --git a/tests/auto/declarative/qdeclarativetextinput/qdeclarativetextinput.pro b/tests/auto/declarative/qdeclarativetextinput/qdeclarativetextinput.pro
index 0fee1c9..c375ccc 100644
--- a/tests/auto/declarative/qdeclarativetextinput/qdeclarativetextinput.pro
+++ b/tests/auto/declarative/qdeclarativetextinput/qdeclarativetextinput.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativetextinput
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui gui-private widgets widgets-private core-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativetextinput.cpp
diff --git a/tests/auto/declarative/qdeclarativetextinput/tst_qdeclarativetextinput.cpp b/tests/auto/declarative/qdeclarativetextinput/tst_qdeclarativetextinput.cpp
index df598be..ee81e4c 100644
--- a/tests/auto/declarative/qdeclarativetextinput/tst_qdeclarativetextinput.cpp
+++ b/tests/auto/declarative/qdeclarativetextinput/tst_qdeclarativetextinput.cpp
@@ -40,10 +40,9 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
-#include "../../../shared/util.h"
-#include <QtDeclarative/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeengine.h>
 #include <QFile>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativetextinput_p.h>
 #include <private/qdeclarativetextinput_p_p.h>
 #include <QDebug>
@@ -51,6 +50,9 @@
 #include <QStyle>
 #include <QInputContext>
 #include <private/qapplication_p.h>
+#include <private/qinputpanel_p.h>
+#include <private/qlinecontrol_p.h>
+#include "../shared/platforminputcontext.h"
 
 #include "qplatformdefs.h"
 
@@ -77,6 +79,16 @@ QString createExpectedFileIfNotFound(const QString& filebasename, const QImage&
     return expectfile;
 }
 
+void sendPreeditText(const QString &text, int cursor)
+{
+    QList<QInputMethodEvent::Attribute> attributes;
+    attributes.append(QInputMethodEvent::Attribute(QInputMethodEvent::Cursor, cursor,
+                                                   text.length(), QVariant()));
+    QInputMethodEvent event(text, attributes);
+    QApplication::sendEvent(qApp->inputPanel()->inputItem(), &event);
+}
+
+
 class tst_qdeclarativetextinput : public QObject
 
 {
@@ -2143,69 +2155,15 @@ QDeclarativeView *tst_qdeclarativetextinput::createView(const QString &filename)
 
     return canvas;
 }
-class MyInputContext : public QInputContext
-{
-public:
-    MyInputContext() : openInputPanelReceived(false), closeInputPanelReceived(false), updateReceived(false), eventType(QEvent::None) {}
-    ~MyInputContext() {}
-
-    QString identifierName() { return QString(); }
-    QString language() { return QString(); }
-
-    void reset() {}
-
-    bool isComposing() const { return false; }
-
-    bool filterEvent( const QEvent *event )
-    {
-        if (event->type() == QEvent::RequestSoftwareInputPanel)
-            openInputPanelReceived = true;
-        if (event->type() == QEvent::CloseSoftwareInputPanel)
-            closeInputPanelReceived = true;
-        return QInputContext::filterEvent(event);
-    }
-
-    void update() { updateReceived = true; }
-
-    void mouseHandler(int x, QMouseEvent *event)
-    {
-        cursor = x;
-        eventType = event->type();
-        eventPosition = event->pos();
-        eventGlobalPosition = event->globalPos();
-        eventButton = event->button();
-        eventButtons = event->buttons();
-        eventModifiers = event->modifiers();
-    }
-
-    void sendPreeditText(const QString &text, int cursor)
-    {
-        QList<QInputMethodEvent::Attribute> attributes;
-        attributes.append(QInputMethodEvent::Attribute(
-                QInputMethodEvent::Cursor, cursor, text.length(), QVariant()));
-
-        QInputMethodEvent event(text, attributes);
-        sendEvent(event);
-    }
-
-    bool openInputPanelReceived;
-    bool closeInputPanelReceived;
-    bool updateReceived;
-    int cursor;
-    QEvent::Type eventType;
-    QPoint eventPosition;
-    QPoint eventGlobalPosition;
-    Qt::MouseButton eventButton;
-    Qt::MouseButtons eventButtons;
-    Qt::KeyboardModifiers eventModifiers;
-};
 
 void tst_qdeclarativetextinput::openInputPanelOnClick()
 {
+    PlatformInputContext ic;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &ic;
+
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextInput input;
     QSignalSpy focusOnPressSpy(&input, SIGNAL(activeFocusOnPressChanged(bool)));
     input.setText("Hello world");
@@ -2228,14 +2186,16 @@ void tst_qdeclarativetextinput::openInputPanelOnClick()
     QTest::mouseClick(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(input.scenePos()));
     QApplication::processEvents();
     if (behavior == QStyle::RSIP_OnMouseClickAndAlreadyFocused) {
-        QCOMPARE(ic.openInputPanelReceived, false);
+        QCOMPARE(ic.isInputPanelVisible(), false);
         QTest::mouseClick(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(input.scenePos()));
         QApplication::processEvents();
-        QCOMPARE(ic.openInputPanelReceived, true);
+        QCOMPARE(ic.isInputPanelVisible(), true);
     } else if (behavior == QStyle::RSIP_OnMouseClick) {
-        QCOMPARE(ic.openInputPanelReceived, true);
+        QCOMPARE(ic.isInputPanelVisible(), true);
     }
-    ic.openInputPanelReceived = false;
+
+    ic.m_showInputPanelCallCount = 0;
+    ic.m_hideInputPanelCallCount = 0;
 
     // focus should not cause input panels to open or close
     input.setFocus(false);
@@ -2243,16 +2203,20 @@ void tst_qdeclarativetextinput::openInputPanelOnClick()
     input.setFocus(false);
     input.setFocus(true);
     input.setFocus(false);
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
 }
 
 void tst_qdeclarativetextinput::openInputPanelOnFocus()
 {
+    PlatformInputContext ic;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &ic;
+
+    ic.clear();
+
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextInput input;
     QSignalSpy focusOnPressSpy(&input, SIGNAL(activeFocusOnPressChanged(bool)));
     input.setText("Hello world");
@@ -2270,27 +2234,27 @@ void tst_qdeclarativetextinput::openInputPanelOnFocus()
 
     // test default values
     QVERIFY(input.focusOnPress());
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
 
     // focus on press, input panel on focus
     QTest::mousePress(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(input.scenePos()));
     QApplication::processEvents();
     QVERIFY(input.hasActiveFocus());
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
 
     // no events on release
     QTest::mouseRelease(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(input.scenePos()));
-    QCOMPARE(ic.openInputPanelReceived, false);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), false);
+    ic.clear();
 
     // if already focused, input panel can be opened on press
     QVERIFY(input.hasActiveFocus());
     QTest::mousePress(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(input.scenePos()));
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
 
     // input method should stay enabled if focus
     // is lost to an item that also accepts inputs
@@ -2298,9 +2262,8 @@ void tst_qdeclarativetextinput::openInputPanelOnFocus()
     scene.addItem(&anotherInput);
     anotherInput.setFocus(true);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
-    QCOMPARE(view.inputContext(), (QInputContext*)&ic);
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
     QVERIFY(view.testAttribute(Qt::WA_InputMethodEnabled));
 
     // input method should be disabled if focus
@@ -2309,9 +2272,9 @@ void tst_qdeclarativetextinput::openInputPanelOnFocus()
     scene.addItem(&item);
     item.setFocus(true);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QVERIFY(view.inputContext() == 0);
+    QCOMPARE(ic.isInputPanelVisible(), false);
     QVERIFY(!view.testAttribute(Qt::WA_InputMethodEnabled));
+    ic.clear();
 
     // no automatic input panel events should
     // be sent if activeFocusOnPress is false
@@ -2324,22 +2287,22 @@ void tst_qdeclarativetextinput::openInputPanelOnFocus()
     QTest::mousePress(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(input.scenePos()));
     QTest::mouseRelease(view.viewport(), Qt::LeftButton, 0, view.mapFromScene(input.scenePos()));
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
 
     // one show input panel event should
     // be set when openSoftwareInputPanel is called
     input.openSoftwareInputPanel();
-    QCOMPARE(ic.openInputPanelReceived, true);
-    QCOMPARE(ic.closeInputPanelReceived, false);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
+    ic.clear();
 
     // one close input panel event should
     // be sent when closeSoftwareInputPanel is called
     input.closeSoftwareInputPanel();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, true);
-    ic.closeInputPanelReceived = false;
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QVERIFY(ic.m_hideInputPanelCallCount > 0);
+    ic.clear();
 
     // set activeFocusOnPress back to true
     input.setFocusOnPress(true);
@@ -2348,17 +2311,17 @@ void tst_qdeclarativetextinput::openInputPanelOnFocus()
     QCOMPARE(focusOnPressSpy.count(),2);
     input.setFocus(false);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
-    QCOMPARE(ic.closeInputPanelReceived, false);
-    ic.closeInputPanelReceived = false;
+    QCOMPARE(ic.m_showInputPanelCallCount, 0);
+    QCOMPARE(ic.m_hideInputPanelCallCount, 0);
+    ic.clear();
 
     // input panel should not re-open
     // if focus has already been set
     input.setFocus(true);
-    QCOMPARE(ic.openInputPanelReceived, true);
-    ic.openInputPanelReceived = false;
+    QCOMPARE(ic.isInputPanelVisible(), true);
+    ic.clear();
     input.setFocus(true);
-    QCOMPARE(ic.openInputPanelReceived, false);
+    QCOMPARE(ic.isInputPanelVisible(), false);
 
     // input method should be disabled
     // if TextInput loses focus
@@ -2370,10 +2333,10 @@ void tst_qdeclarativetextinput::openInputPanelOnFocus()
     // input method should not be enabled
     // if TextInput is read only.
     input.setReadOnly(true);
-    ic.openInputPanelReceived = false;
+    ic.clear();
     input.setFocus(true);
     QApplication::processEvents();
-    QCOMPARE(ic.openInputPanelReceived, false);
+    QCOMPARE(ic.isInputPanelVisible(), false);
     QVERIFY(view.inputContext() == 0);
     QVERIFY(!view.testAttribute(Qt::WA_InputMethodEnabled));
 }
@@ -2492,8 +2455,6 @@ void tst_qdeclarativetextinput::preeditAutoScroll()
 
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextInput input;
     QFontMetricsF fm(input.font());
     input.setWidth(fm.width(committedText));
@@ -2510,13 +2471,14 @@ void tst_qdeclarativetextinput::preeditAutoScroll()
     int cursorRectangleChanges = 0;
 
     // test the text is scrolled so the preedit is visible.
-    ic.sendPreeditText(preeditText.mid(0, 3), 1);
+    sendPreeditText(preeditText.mid(0, 3), 1);
     QVERIFY(input.positionAt(0) != 0);
     QVERIFY(input.cursorRectangle().left() < input.boundingRect().width());
     QCOMPARE(cursorRectangleSpy.count(), ++cursorRectangleChanges);
 
     // test the text is scrolled back when the preedit is removed.
-    ic.sendEvent(QInputMethodEvent());
+    QInputMethodEvent emptyEvent;
+    QApplication::sendEvent(&view, &emptyEvent);
     QCOMPARE(input.positionAt(0), 0);
     QCOMPARE(input.positionAt(input.width()), 5);
     QCOMPARE(cursorRectangleSpy.count(), ++cursorRectangleChanges);
@@ -2532,14 +2494,14 @@ void tst_qdeclarativetextinput::preeditAutoScroll()
     // character preceding the cursor is still visible.
     qreal x = input.positionToRectangle(0).x();
     for (int i = 0; i < 3; ++i) {
-        ic.sendPreeditText(preeditText, i + 1);
+        sendPreeditText(preeditText, i + 1);
         QVERIFY(input.cursorRectangle().right() >= fm.width(preeditText.at(i)) - error);
         QVERIFY(input.positionToRectangle(0).x() < x);
         QCOMPARE(cursorRectangleSpy.count(), ++cursorRectangleChanges);
         x = input.positionToRectangle(0).x();
     }
     for (int i = 1; i >= 0; --i) {
-        ic.sendPreeditText(preeditText, i + 1);
+        sendPreeditText(preeditText, i + 1);
         QVERIFY(input.cursorRectangle().right() >= fm.width(preeditText.at(i)) - error);
         QVERIFY(input.positionToRectangle(0).x() > x);
         QCOMPARE(cursorRectangleSpy.count(), ++cursorRectangleChanges);
@@ -2548,38 +2510,38 @@ void tst_qdeclarativetextinput::preeditAutoScroll()
 
     // Test incrementing the preedit cursor doesn't cause further
     // scrolling when right most text is visible.
-    ic.sendPreeditText(preeditText, preeditText.length() - 3);
+    sendPreeditText(preeditText, preeditText.length() - 3);
     QCOMPARE(cursorRectangleSpy.count(), ++cursorRectangleChanges);
     x = input.positionToRectangle(0).x();
     for (int i = 2; i >= 0; --i) {
-        ic.sendPreeditText(preeditText, preeditText.length() - i);
+        sendPreeditText(preeditText, preeditText.length() - i);
         QCOMPARE(input.positionToRectangle(0).x(), x);
         QCOMPARE(cursorRectangleSpy.count(), ++cursorRectangleChanges);
     }
     for (int i = 1; i <  3; ++i) {
-        ic.sendPreeditText(preeditText, preeditText.length() - i);
+        sendPreeditText(preeditText, preeditText.length() - i);
         QCOMPARE(input.positionToRectangle(0).x(), x);
         QCOMPARE(cursorRectangleSpy.count(), ++cursorRectangleChanges);
     }
 
     // Test disabling auto scroll.
-    ic.sendEvent(QInputMethodEvent());
+    QApplication::sendEvent(&view, &emptyEvent);
 
     input.setAutoScroll(false);
-    ic.sendPreeditText(preeditText.mid(0, 3), 1);
+    sendPreeditText(preeditText.mid(0, 3), 1);
     QCOMPARE(input.positionAt(0), 0);
     QCOMPARE(input.positionAt(input.width()), 5);
 
-    ic.sendEvent(QInputMethodEvent());
+    QApplication::sendEvent(&view, &emptyEvent);
     input.setAutoScroll(true);
     // Test committing pre-edit text at the start of the string. QTBUG-18789
     input.setCursorPosition(0);
-    ic.sendPreeditText(input.text(), 5);
+    sendPreeditText(input.text(), 5);
     QCOMPARE(input.positionAt(0), 0);
 
     QInputMethodEvent event;
     event.setCommitString(input.text());
-    ic.sendEvent(event);
+    QApplication::sendEvent(&view, &emptyEvent);
 
     QCOMPARE(input.positionAt(0), 0);
     QCOMPARE(input.positionAt(input.width()), 5);
@@ -2587,12 +2549,14 @@ void tst_qdeclarativetextinput::preeditAutoScroll()
 
 void tst_qdeclarativetextinput::preeditMicroFocus()
 {
+    PlatformInputContext ic;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &ic;
+
     QString preeditText = "super";
 
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextInput input;
     input.setPos(0, 0);
     input.setAutoScroll(false);
@@ -2608,47 +2572,49 @@ void tst_qdeclarativetextinput::preeditMicroFocus()
 
     // Verify that the micro focus rect is positioned the same for position 0 as
     // it would be if there was no preedit text.
-    ic.updateReceived = false;
-    ic.sendPreeditText(preeditText, 0);
+    ic.clear();
+    sendPreeditText(preeditText, 0);
     currentRect = input.inputMethodQuery(Qt::ImMicroFocus).toRect();
     QCOMPARE(currentRect, previousRect);
 #if defined(Q_WS_X11) || defined(Q_WS_QWS) || defined(Q_OS_SYMBIAN)
-    QCOMPARE(ic.updateReceived, true);
+    QVERIFY(ic.updateCallCount > 0);
 #endif
 
     // Verify that the micro focus rect moves to the left as the cursor position
     // is incremented.
     for (int i = 1; i <= 5; ++i) {
-        ic.updateReceived = false;
-        ic.sendPreeditText(preeditText, i);
+        ic.clear();
+        sendPreeditText(preeditText, i);
         currentRect = input.inputMethodQuery(Qt::ImMicroFocus).toRect();
         QVERIFY(previousRect.left() < currentRect.left());
 #if defined(Q_WS_X11) || defined(Q_WS_QWS) || defined(Q_OS_SYMBIAN)
-        QCOMPARE(ic.updateReceived, true);
+        QVERIFY(ic.updateCallCount > 0);
 #endif
         previousRect = currentRect;
     }
 
     // Verify that if there is no preedit cursor then the micro focus rect is the
     // same as it would be if it were positioned at the end of the preedit text.
-    ic.sendPreeditText(preeditText, 0);
-    ic.updateReceived = false;
-    ic.sendEvent(QInputMethodEvent(preeditText, QList<QInputMethodEvent::Attribute>()));
+    sendPreeditText(preeditText, 0);
+    ic.clear();
+    QInputMethodEvent imEvent(preeditText, QList<QInputMethodEvent::Attribute>());
     currentRect = input.inputMethodQuery(Qt::ImMicroFocus).toRect();
     QCOMPARE(currentRect, previousRect);
 #if defined(Q_WS_X11) || defined(Q_WS_QWS) || defined(Q_OS_SYMBIAN)
-    QCOMPARE(ic.updateReceived, true);
+    QVERIFY(ic.updateCallCount > 0);
 #endif
 }
 
 void tst_qdeclarativetextinput::inputContextMouseHandler()
 {
+    PlatformInputContext platformInputContext;
+    QInputPanelPrivate *inputPanelPrivate = QInputPanelPrivate::get(qApp->inputPanel());
+    inputPanelPrivate->testContext = &platformInputContext;
+
     QString text = "supercalifragisiticexpialidocious!";
 
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextInput input;
     input.setWidth(200);
     input.setText(text.mid(0, 12));
@@ -2665,98 +2631,17 @@ void tst_qdeclarativetextinput::inputContextMouseHandler()
     const qreal y = fm.height() / 2;
 
     QPoint position2 = view.mapFromScene(input.mapToScene(QPointF(fm.width(text.mid(0, 2)), y)));
-    QPoint position8 = view.mapFromScene(input.mapToScene(QPointF(fm.width(text.mid(0, 8)), y)));
-    QPoint position20 = view.mapFromScene(input.mapToScene(QPointF(fm.width(text.mid(0, 20)), y)));
-    QPoint position27 = view.mapFromScene(input.mapToScene(QPointF(fm.width(text.mid(0, 27)), y)));
-    QPoint globalPosition2 = view.viewport()->mapToGlobal(position2);
-    QPoint globalposition8 = view.viewport()->mapToGlobal(position8);
-    QPoint globalposition20 = view.viewport()->mapToGlobal(position20);
-    QPoint globalposition27 = view.viewport()->mapToGlobal(position27);
-
-    ic.sendEvent(QInputMethodEvent(text.mid(12), QList<QInputMethodEvent::Attribute>()));
-
-    QTest::mouseDClick(view.viewport(), Qt::LeftButton, Qt::NoModifier, position2);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonDblClick);
-    QCOMPARE(ic.eventPosition, position2);
-    QCOMPARE(ic.eventGlobalPosition, globalPosition2);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor < 0);
-    ic.eventType = QEvent::None;
+
+    QInputMethodEvent inputEvent(text.mid(0, 5), QList<QInputMethodEvent::Attribute>());
+    QApplication::sendEvent(&view, &inputEvent);
 
     QTest::mousePress(view.viewport(), Qt::LeftButton, Qt::NoModifier, position2);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonPress);
-    QCOMPARE(ic.eventPosition, position2);
-    QCOMPARE(ic.eventGlobalPosition, globalPosition2);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor < 0);
-    ic.eventType = QEvent::None;
-
-    {   QMouseEvent mv(QEvent::MouseMove, position8, globalposition8, Qt::LeftButton, Qt::LeftButton,Qt::NoModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::None);
-
-    {   QMouseEvent mv(QEvent::MouseMove, position27, globalposition27, Qt::LeftButton, Qt::LeftButton,Qt::NoModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::MouseMove);
-    QCOMPARE(ic.eventPosition, position27);
-    QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);    // 15 is expected but some platforms may be off by one.
-    ic.eventType = QEvent::None;
-
-    QTest::mouseRelease(view.viewport(), Qt::LeftButton, Qt::NoModifier, position27);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonRelease);
-    QCOMPARE(ic.eventPosition, position27);
-    QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::NoModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);
-    ic.eventType = QEvent::None;
-
-    // And in the other direction.
-    QTest::mouseDClick(view.viewport(), Qt::LeftButton, Qt::ControlModifier, position27);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonDblClick);
-    QCOMPARE(ic.eventPosition, position27);
-    QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::LeftButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);
-    ic.eventType = QEvent::None;
-
-    QTest::mousePress(view.viewport(), Qt::RightButton, Qt::ControlModifier, position27);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonPress);
-    QCOMPARE(ic.eventPosition, position27);
-    QCOMPARE(ic.eventGlobalPosition, globalposition27);
-    QCOMPARE(ic.eventButton, Qt::RightButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor >= 14 && ic.cursor <= 16);
-    ic.eventType = QEvent::None;
-
-    {   QMouseEvent mv(QEvent::MouseMove, position20, globalposition20, Qt::RightButton, Qt::RightButton,Qt::ControlModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::MouseMove);
-    QCOMPARE(ic.eventPosition, position20);
-    QCOMPARE(ic.eventGlobalPosition, globalposition20);
-    QCOMPARE(ic.eventButton, Qt::RightButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor >= 7 && ic.cursor <= 9);
-    ic.eventType = QEvent::None;
-
-    {   QMouseEvent mv(QEvent::MouseMove, position2, globalPosition2, Qt::RightButton, Qt::RightButton,Qt::ControlModifier);
-        QApplication::sendEvent(view.viewport(), &mv); }
-    QCOMPARE(ic.eventType, QEvent::None);
-
-    QTest::mouseRelease(view.viewport(), Qt::RightButton, Qt::ControlModifier, position2);
-    QCOMPARE(ic.eventType, QEvent::MouseButtonRelease);
-    QCOMPARE(ic.eventPosition, position2);
-    QCOMPARE(ic.eventGlobalPosition, globalPosition2);
-    QCOMPARE(ic.eventButton, Qt::RightButton);
-    QCOMPARE(ic.eventModifiers, Qt::ControlModifier);
-    QVERIFY(ic.cursor < 0);
-    ic.eventType = QEvent::None;
+    QTest::mouseRelease(view.viewport(), Qt::LeftButton, Qt::NoModifier, position2);
+    QApplication::processEvents();
+
+    QCOMPARE(platformInputContext.m_action, QInputPanel::Click);
+    QCOMPARE(platformInputContext.m_invokeActionCallCount, 1);
+    QCOMPARE(platformInputContext.m_cursorPosition, 2);
 }
 
 void tst_qdeclarativetextinput::inputMethodComposing()
@@ -2765,8 +2650,6 @@ void tst_qdeclarativetextinput::inputMethodComposing()
 
     QGraphicsScene scene;
     QGraphicsView view(&scene);
-    MyInputContext ic;
-    view.setInputContext(&ic);
     QDeclarativeTextInput input;
     input.setWidth(200);
     input.setText(text.mid(0, 12));
@@ -2783,15 +2666,26 @@ void tst_qdeclarativetextinput::inputMethodComposing()
 
     QCOMPARE(input.isInputMethodComposing(), false);
 
-    ic.sendEvent(QInputMethodEvent(text.mid(3), QList<QInputMethodEvent::Attribute>()));
+    {
+        QInputMethodEvent inputEvent(text.mid(3), QList<QInputMethodEvent::Attribute>());
+        QApplication::sendEvent(qApp->inputPanel()->inputItem(), &inputEvent);
+    }
+
     QCOMPARE(input.isInputMethodComposing(), true);
     QCOMPARE(spy.count(), 1);
 
-    ic.sendEvent(QInputMethodEvent(text.mid(12), QList<QInputMethodEvent::Attribute>()));
+    {
+        QInputMethodEvent inputEvent(text.mid(12), QList<QInputMethodEvent::Attribute>());
+        QApplication::sendEvent(qApp->inputPanel()->inputItem(), &inputEvent);
+    }
+
     QCOMPARE(input.isInputMethodComposing(), true);
     QCOMPARE(spy.count(), 1);
 
-    ic.sendEvent(QInputMethodEvent());
+    {
+        QInputMethodEvent inputEvent;
+        QApplication::sendEvent(qApp->inputPanel()->inputItem(), &inputEvent);
+    }
     QCOMPARE(input.isInputMethodComposing(), false);
     QCOMPARE(spy.count(), 2);
 }
diff --git a/tests/auto/declarative/qdeclarativetimer/qdeclarativetimer.pro b/tests/auto/declarative/qdeclarativetimer/qdeclarativetimer.pro
index 5a9e7f7..0d4e164 100644
--- a/tests/auto/declarative/qdeclarativetimer/qdeclarativetimer.pro
+++ b/tests/auto/declarative/qdeclarativetimer/qdeclarativetimer.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativetimer
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativetimer.cpp
diff --git a/tests/auto/declarative/qdeclarativetimer/tst_qdeclarativetimer.cpp b/tests/auto/declarative/qdeclarativetimer/tst_qdeclarativetimer.cpp
index 15d6319..79c14db 100644
--- a/tests/auto/declarative/qdeclarativetimer/tst_qdeclarativetimer.cpp
+++ b/tests/auto/declarative/qdeclarativetimer/tst_qdeclarativetimer.cpp
@@ -40,10 +40,10 @@
 ****************************************************************************/
 #include <QtTest/QSignalSpy>
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativetimer_p.h>
-#include <QtDeclarative/qdeclarativeitem.h>
+#include <QtQuick1/qdeclarativeitem.h>
 #include <QDebug>
 
 #ifdef Q_OS_SYMBIAN
diff --git a/tests/auto/declarative/qdeclarativevaluetypes/qdeclarativevaluetypes.pro b/tests/auto/declarative/qdeclarativevaluetypes/qdeclarativevaluetypes.pro
index 59b3526..f2193bc 100644
--- a/tests/auto/declarative/qdeclarativevaluetypes/qdeclarativevaluetypes.pro
+++ b/tests/auto/declarative/qdeclarativevaluetypes/qdeclarativevaluetypes.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qdeclarativevaluetypes
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private core-private script-private
 macx:CONFIG -= app_bundle
 
 HEADERS += testtypes.h
diff --git a/tests/auto/declarative/qdeclarativeview/qdeclarativeview.pro b/tests/auto/declarative/qdeclarativeview/qdeclarativeview.pro
index fc4790d..e5b64c6 100644
--- a/tests/auto/declarative/qdeclarativeview/qdeclarativeview.pro
+++ b/tests/auto/declarative/qdeclarativeview/qdeclarativeview.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeview
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 gui widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeview.cpp
diff --git a/tests/auto/declarative/qdeclarativeview/tst_qdeclarativeview.cpp b/tests/auto/declarative/qdeclarativeview/tst_qdeclarativeview.cpp
index 1a2fba2..785050c 100644
--- a/tests/auto/declarative/qdeclarativeview/tst_qdeclarativeview.cpp
+++ b/tests/auto/declarative/qdeclarativeview/tst_qdeclarativeview.cpp
@@ -40,12 +40,11 @@
 ****************************************************************************/
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativeitem.h>
-#include <QtGui/qgraphicswidget.h>
-#include "../../../shared/util.h"
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeitem.h>
+#include <QtWidgets/qgraphicswidget.h>
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qdeclarativeviewer/qdeclarativeviewer.pro b/tests/auto/declarative/qdeclarativeviewer/qdeclarativeviewer.pro
index 8d4b410..a059fa3 100644
--- a/tests/auto/declarative/qdeclarativeviewer/qdeclarativeviewer.pro
+++ b/tests/auto/declarative/qdeclarativeviewer/qdeclarativeviewer.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativeviewer
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 gui
 macx:CONFIG -= app_bundle
 
 include(../../../../tools/qml/qml.pri)
diff --git a/tests/auto/declarative/qdeclarativeviewer/tst_qdeclarativeviewer.cpp b/tests/auto/declarative/qdeclarativeviewer/tst_qdeclarativeviewer.cpp
index 6a38ac8..fb2cddc 100644
--- a/tests/auto/declarative/qdeclarativeviewer/tst_qdeclarativeviewer.cpp
+++ b/tests/auto/declarative/qdeclarativeviewer/tst_qdeclarativeviewer.cpp
@@ -40,16 +40,14 @@
 ****************************************************************************/
 
 #include <qtest.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeview.h>
-#include <QtDeclarative/qdeclarativeitem.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtGui/qmenubar.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeitem.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtWidgets/qmenubar.h>
 #include <QSignalSpy>
-#include "../../../shared/util.h"
 #include "qmlruntime.h"
 #include "deviceorientation.h"
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
@@ -114,8 +112,10 @@ void tst_QDeclarativeViewer::runtimeContextProperty()
     
     viewer->show();
     QApplication::setActiveWindow(viewer);
+    //viewer->requestActivateWindow();
     QTest::qWaitForWindowShown(viewer);
     QTRY_COMPARE(QApplication::activeWindow(), static_cast<QWidget *>(viewer));
+    //QTRY_VERIFY(viewer == qGuiApp->focusWindow());
 
     QVERIFY(runtimeObject->property("isActiveWindow").toBool());
     
diff --git a/tests/auto/declarative/qdeclarativevisualdatamodel/qdeclarativevisualdatamodel.pro b/tests/auto/declarative/qdeclarativevisualdatamodel/qdeclarativevisualdatamodel.pro
index fe3d794..349d750 100644
--- a/tests/auto/declarative/qdeclarativevisualdatamodel/qdeclarativevisualdatamodel.pro
+++ b/tests/auto/declarative/qdeclarativevisualdatamodel/qdeclarativevisualdatamodel.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative gui
+CONFIG += testcase
+TARGET = tst_qdeclarativevisualdatamodel
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private gui widgets core-private script-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativevisualdatamodel.cpp
diff --git a/tests/auto/declarative/qdeclarativevisualdatamodel/tst_qdeclarativevisualdatamodel.cpp b/tests/auto/declarative/qdeclarativevisualdatamodel/tst_qdeclarativevisualdatamodel.cpp
index 28de5bd..7bf2cbd 100644
--- a/tests/auto/declarative/qdeclarativevisualdatamodel/tst_qdeclarativevisualdatamodel.cpp
+++ b/tests/auto/declarative/qdeclarativevisualdatamodel/tst_qdeclarativevisualdatamodel.cpp
@@ -38,15 +38,14 @@
 ** $QT_END_LICENSE$
 **
 ****************************************************************************/
-#include "../../../shared/util.h"
 #include <qtest.h>
 #include <QtTest/QSignalSpy>
 #include <QStandardItemModel>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativecontext.h>
-#include <QtDeclarative/qdeclarativeexpression.h>
-#include <QtDeclarative/qdeclarativeview.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativecontext.h>
+#include <QtQuick1/qdeclarativeexpression.h>
+#include <QtQuick1/qdeclarativeview.h>
 #include <private/qdeclarativelistview_p.h>
 #include <private/qdeclarativetext_p.h>
 #include <private/qdeclarativevisualitemmodel_p.h>
@@ -215,6 +214,7 @@ void tst_qdeclarativevisualdatamodel::updateLayout()
     view.rootContext()->setContextProperty("myModel", &model);
 
     view.setSource(QUrl::fromLocalFile(SRCDIR "/data/datalist.qml"));
+    qDebug() << "setSource";
 
     QDeclarativeListView *listview = qobject_cast<QDeclarativeListView*>(view.rootObject());
     QVERIFY(listview != 0);
diff --git a/tests/auto/declarative/qdeclarativeworkerscript/qdeclarativeworkerscript.pro b/tests/auto/declarative/qdeclarativeworkerscript/qdeclarativeworkerscript.pro
index e20c3e6..f86dcb0 100644
--- a/tests/auto/declarative/qdeclarativeworkerscript/qdeclarativeworkerscript.pro
+++ b/tests/auto/declarative/qdeclarativeworkerscript/qdeclarativeworkerscript.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative script
+CONFIG += testcase
+TARGET = tst_qdeclarativeworkerscript
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script core-private script-private
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qdeclarativeworkerscript.cpp
diff --git a/tests/auto/declarative/qdeclarativeworkerscript/tst_qdeclarativeworkerscript.cpp b/tests/auto/declarative/qdeclarativeworkerscript/tst_qdeclarativeworkerscript.cpp
index 0fbdd0a..6ead2c4 100644
--- a/tests/auto/declarative/qdeclarativeworkerscript/tst_qdeclarativeworkerscript.cpp
+++ b/tests/auto/declarative/qdeclarativeworkerscript/tst_qdeclarativeworkerscript.cpp
@@ -45,13 +45,12 @@
 #include <QtCore/qfileinfo.h>
 #include <QtScript/qscriptengine.h>
 
-#include <QtDeclarative/qdeclarativecomponent.h>
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativeitem.h>
+#include <QtQuick1/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeitem.h>
 
 #include <private/qdeclarativeworkerscript_p.h>
 #include <private/qdeclarativeengine_p.h>
-#include "../../../shared/util.h"
 
 Q_DECLARE_METATYPE(QScriptValue)
 
diff --git a/tests/auto/declarative/qdeclarativexmlhttprequest/qdeclarativexmlhttprequest.pro b/tests/auto/declarative/qdeclarativexmlhttprequest/qdeclarativexmlhttprequest.pro
index 4b5bf6e..0c1347e 100644
--- a/tests/auto/declarative/qdeclarativexmlhttprequest/qdeclarativexmlhttprequest.pro
+++ b/tests/auto/declarative/qdeclarativexmlhttprequest/qdeclarativexmlhttprequest.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative network
+CONFIG += testcase
+TARGET = tst_qdeclarativexmlhttprequest
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 network
 macx:CONFIG -= app_bundle
 
 INCLUDEPATH += ../shared/
diff --git a/tests/auto/declarative/qdeclarativexmlhttprequest/tst_qdeclarativexmlhttprequest.cpp b/tests/auto/declarative/qdeclarativexmlhttprequest/tst_qdeclarativexmlhttprequest.cpp
index 879910d..3fbda08 100644
--- a/tests/auto/declarative/qdeclarativexmlhttprequest/tst_qdeclarativexmlhttprequest.cpp
+++ b/tests/auto/declarative/qdeclarativexmlhttprequest/tst_qdeclarativexmlhttprequest.cpp
@@ -45,7 +45,6 @@
 #include <QDebug>
 #include <QNetworkCookieJar>
 #include "testhttpserver.h"
-#include "../../../shared/util.h"
 
 #define SERVER_PORT 14445
 
diff --git a/tests/auto/declarative/qdeclarativexmllistmodel/qdeclarativexmllistmodel.pro b/tests/auto/declarative/qdeclarativexmllistmodel/qdeclarativexmllistmodel.pro
index 64b8267..a3dfd64 100644
--- a/tests/auto/declarative/qdeclarativexmllistmodel/qdeclarativexmllistmodel.pro
+++ b/tests/auto/declarative/qdeclarativexmllistmodel/qdeclarativexmllistmodel.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative script gui network
+CONFIG += testcase
+TARGET = tst_qdeclarativexmllistmodel
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private script gui network core-private script-private
 contains(QT_CONFIG,xmlpatterns) {
     QT += xmlpatterns
     DEFINES += QTEST_XMLPATTERNS
diff --git a/tests/auto/declarative/qdeclarativexmllistmodel/tst_qdeclarativexmllistmodel.cpp b/tests/auto/declarative/qdeclarativexmllistmodel/tst_qdeclarativexmllistmodel.cpp
index 6a7ae44..d59b38e 100644
--- a/tests/auto/declarative/qdeclarativexmllistmodel/tst_qdeclarativexmllistmodel.cpp
+++ b/tests/auto/declarative/qdeclarativexmllistmodel/tst_qdeclarativexmllistmodel.cpp
@@ -46,7 +46,7 @@
 
 #include <qtest.h>
 #include <QtTest/qsignalspy.h>
-#include <QtDeclarative/qdeclarativenetworkaccessmanagerfactory.h>
+#include <QtQuick1/qdeclarativenetworkaccessmanagerfactory.h>
 #include <QtNetwork/qnetworkaccessmanager.h>
 #include <QtNetwork/qnetworkrequest.h>
 #include <QtCore/qtimer.h>
@@ -54,10 +54,9 @@
 #include <QtCore/qtemporaryfile.h>
 
 #ifdef QTEST_XMLPATTERNS
-#include <QtDeclarative/qdeclarativeengine.h>
-#include <QtDeclarative/qdeclarativecomponent.h>
+#include <QtQuick1/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativecomponent.h>
 #include <private/qdeclarativexmllistmodel_p.h>
-#include "../../../shared/util.h"
 
 #ifdef Q_OS_SYMBIAN
 // In Symbian OS test data is located in applications private dir
diff --git a/tests/auto/declarative/qmetaobjectbuilder/qmetaobjectbuilder.pro b/tests/auto/declarative/qmetaobjectbuilder/qmetaobjectbuilder.pro
index 988177e..736fe66 100644
--- a/tests/auto/declarative/qmetaobjectbuilder/qmetaobjectbuilder.pro
+++ b/tests/auto/declarative/qmetaobjectbuilder/qmetaobjectbuilder.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qmetaobjectbuilder
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 quick1-private
 macx:CONFIG -= app_bundle
 
 SOURCES += \
diff --git a/tests/auto/declarative/qmlshadersplugin/qmlshadersplugin.pro b/tests/auto/declarative/qmlshadersplugin/qmlshadersplugin.pro
index aa0e07a..fdd2d78 100644
--- a/tests/auto/declarative/qmlshadersplugin/qmlshadersplugin.pro
+++ b/tests/auto/declarative/qmlshadersplugin/qmlshadersplugin.pro
@@ -1,6 +1,8 @@
-load(qttest_p4)
+CONFIG += testcase
+TARGET = tst_qmlshadersplugin
 
-QT += opengl declarative
+QT += testlib
+QT += opengl quick1 gui widgets
 SOURCES += tst_qmlshadersplugin.cpp
 
 SOURCES += \
diff --git a/tests/auto/declarative/qmlshadersplugin/tst_qmlshadersplugin.cpp b/tests/auto/declarative/qmlshadersplugin/tst_qmlshadersplugin.cpp
index ba7f795..6c8d2f1 100644
--- a/tests/auto/declarative/qmlshadersplugin/tst_qmlshadersplugin.cpp
+++ b/tests/auto/declarative/qmlshadersplugin/tst_qmlshadersplugin.cpp
@@ -40,7 +40,7 @@
 ****************************************************************************/
 
 #include <qtest.h>
-#include <QtDeclarative>
+#include <QtQuick1>
 #include "../../../../src/imports/shaders/shadereffectitem.h"
 #include "../../../../src/imports/shaders/shadereffectsource.h"
 #include "../../../../src/imports/shaders/shadereffect.h"
diff --git a/tests/auto/declarative/qmlvisual/qmlvisual.pro b/tests/auto/declarative/qmlvisual/qmlvisual.pro
index 36d2600..319f1b5 100644
--- a/tests/auto/declarative/qmlvisual/qmlvisual.pro
+++ b/tests/auto/declarative/qmlvisual/qmlvisual.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qmlvisual
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1 gui widgets
 macx:CONFIG -= app_bundle
 
 SOURCES += tst_qmlvisual.cpp
diff --git a/tests/auto/declarative/qpacketprotocol/qpacketprotocol.pro b/tests/auto/declarative/qpacketprotocol/qpacketprotocol.pro
index 7ffda93..263598a 100644
--- a/tests/auto/declarative/qpacketprotocol/qpacketprotocol.pro
+++ b/tests/auto/declarative/qpacketprotocol/qpacketprotocol.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += network declarative
+CONFIG += testcase
+TARGET = tst_qpacketprotocol
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += network quick1 quick1-private core-private gui-private widgets-private
 macx:CONFIG -= app_bundle
 
 HEADERS += ../shared/debugutil_p.h
diff --git a/tests/auto/declarative/qperformancetimer/qperformancetimer.pro b/tests/auto/declarative/qperformancetimer/qperformancetimer.pro
index 656bf68..beb8a8e 100644
--- a/tests/auto/declarative/qperformancetimer/qperformancetimer.pro
+++ b/tests/auto/declarative/qperformancetimer/qperformancetimer.pro
@@ -1,5 +1,8 @@
-load(qttest_p4)
-contains(QT_CONFIG,declarative): QT += declarative
+CONFIG += testcase
+TARGET = tst_qperformancetimer
+
+QT += testlib
+contains(QT_CONFIG,quick1): QT += quick1
 SOURCES += tst_qperformancetimer.cpp
 macx:CONFIG -= app_bundle
 
diff --git a/tests/auto/declarative/shared/debugutil_p.h b/tests/auto/declarative/shared/debugutil_p.h
index 61e4928..4ce9589 100644
--- a/tests/auto/declarative/shared/debugutil_p.h
+++ b/tests/auto/declarative/shared/debugutil_p.h
@@ -45,7 +45,7 @@
 #include <QThread>
 #include <QTest>
 
-#include <QtDeclarative/qdeclarativeengine.h>
+#include <QtQuick1/qdeclarativeengine.h>
 
 #include <private/qdeclarativedebugclient_p.h>
 #include <private/qdeclarativedebugservice_p.h>
diff --git a/tests/auto/declarative/shared/platforminputcontext.h b/tests/auto/declarative/shared/platforminputcontext.h
new file mode 100644
index 0000000..0c23db4
--- /dev/null
+++ b/tests/auto/declarative/shared/platforminputcontext.h
@@ -0,0 +1,116 @@
+/****************************************************************************
+**
+** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies).
+** All rights reserved.
+** Contact: Nokia Corporation (qt-info@nokia.com)
+**
+** This file is part of the test suite of the Qt Toolkit.
+**
+** $QT_BEGIN_LICENSE:LGPL$
+** GNU Lesser General Public License Usage
+** This file may be used under the terms of the GNU Lesser General Public
+** License version 2.1 as published by the Free Software Foundation and
+** appearing in the file LICENSE.LGPL included in the packaging of this
+** file. Please review the following information to ensure the GNU Lesser
+** General Public License version 2.1 requirements will be met:
+** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
+**
+** In addition, as a special exception, Nokia gives you certain additional
+** rights. These rights are described in the Nokia Qt LGPL Exception
+** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
+**
+** GNU General Public License Usage
+** Alternatively, this file may be used under the terms of the GNU General
+** Public License version 3.0 as published by the Free Software Foundation
+** and appearing in the file LICENSE.GPL included in the packaging of this
+** file. Please review the following information to ensure the GNU General
+** Public License version 3.0 requirements will be met:
+** http://www.gnu.org/copyleft/gpl.html.
+**
+** Other Usage
+** Alternatively, this file may be used in accordance with the terms and
+** conditions contained in a signed written agreement between you and Nokia.
+**
+**
+**
+**
+**
+** $QT_END_LICENSE$
+**
+****************************************************************************/
+
+#include <qplatforminputcontext_qpa.h>
+#include <QtGui/QInputPanel>
+
+class PlatformInputContext : public QPlatformInputContext
+{
+public:
+    PlatformInputContext()
+        : m_visible(false), m_action(QInputPanel::Click), m_cursorPosition(0),
+          m_invokeActionCallCount(0), m_showInputPanelCallCount(0), m_hideInputPanelCallCount(0),
+          m_updateCallCount(0), m_direction(Qt::LeftToRight)
+    {
+    }
+
+    virtual void showInputPanel()
+    {
+        m_visible = true;
+        m_showInputPanelCallCount++;
+    }
+    virtual void hideInputPanel()
+    {
+        m_visible = false;
+        m_hideInputPanelCallCount++;
+    }
+    virtual bool isInputPanelVisible() const
+    {
+        return m_visible;
+    }
+    virtual void invokeAction(QInputPanel::Action action, int cursorPosition)
+    {
+        m_invokeActionCallCount++;
+        m_action = action;
+        m_cursorPosition = cursorPosition;
+    }
+    virtual void update(Qt::InputMethodQueries)
+    {
+        m_updateCallCount++;
+    }
+
+    virtual QLocale locale() const
+    {
+        if (m_direction == Qt::RightToLeft)
+            return QLocale(QLocale::Arabic);
+        else
+            return QLocale(QLocale::English);
+    }
+
+    virtual Qt::LayoutDirection inputDirection() const
+    {
+        return m_direction;
+    }
+
+    void setInputDirection(Qt::LayoutDirection direction) {
+        m_direction = direction;
+        emitLocaleChanged();
+        emitInputDirectionChanged(inputDirection());
+    }
+
+    void clear() {
+        m_cursorPosition = 0;
+        m_invokeActionCallCount = 0;
+        m_visible = false;
+        m_showInputPanelCallCount = 0;
+        m_hideInputPanelCallCount = 0;
+        m_updateCallCount = 0;
+    }
+
+    bool m_visible;
+    QInputPanel::Action m_action;
+    int m_cursorPosition;
+    int m_invokeActionCallCount;
+    int m_showInputPanelCallCount;
+    int m_hideInputPanelCallCount;
+    int m_updateCallCount;
+    Qt::LayoutDirection m_direction;
+};
diff --git a/tests/manual/declarative/qmlshadersplugin/main.cpp b/tests/manual/declarative/qmlshadersplugin/main.cpp
index d0f15ca..1dcb6e6 100644
--- a/tests/manual/declarative/qmlshadersplugin/main.cpp
+++ b/tests/manual/declarative/qmlshadersplugin/main.cpp
@@ -39,7 +39,7 @@
 **
 ****************************************************************************/
 
-#include <QtGui/QApplication>
+#include <QtWidgets/QApplication>
 #include <QtOpenGL>
 #include "qmlapplicationviewer.h"
 
diff --git a/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.cpp b/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.cpp
index b49fe0e..7c0788a 100644
--- a/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.cpp
+++ b/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.cpp
@@ -45,9 +45,9 @@
 #include <QtCore/QCoreApplication>
 #include <QtCore/QDir>
 #include <QtCore/QFileInfo>
-#include <QtDeclarative/QDeclarativeComponent>
-#include <QtDeclarative/QDeclarativeEngine>
-#include <QtDeclarative/QDeclarativeContext>
+#include <QtQuick1/QDeclarativeComponent>
+#include <QtQuick1/QDeclarativeEngine>
+#include <QtQuick1/QDeclarativeContext>
 
 #if defined(QMLJSDEBUGGER)
 #include <jsdebuggeragent.h>
diff --git a/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.h b/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.h
index 8ba35e9..09c75a1 100644
--- a/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.h
+++ b/tests/manual/declarative/qmlshadersplugin/qmlapplicationviewer/qmlapplicationviewer.h
@@ -43,7 +43,7 @@
 #ifndef QMLAPPLICATIONVIEWER_H
 #define QMLAPPLICATIONVIEWER_H
 
-#include <QtDeclarative/QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 
 class QmlApplicationViewer : public QDeclarativeView
 {
diff --git a/tools/designer/src/plugins/plugins.pro b/tools/designer/src/plugins/plugins.pro
index bcebb82..b9a497c 100644
--- a/tools/designer/src/plugins/plugins.pro
+++ b/tools/designer/src/plugins/plugins.pro
@@ -2,9 +2,4 @@ TEMPLATE = subdirs
 CONFIG += ordered
 
 REQUIRES = !CONFIG(static,shared|static)
-contains(QT_CONFIG, qt3support): SUBDIRS += widgets
-win32: SUBDIRS += activeqt
-# contains(QT_CONFIG, opengl): SUBDIRS += tools/view3d
-contains(QT_CONFIG, webkit): SUBDIRS += qwebview
-contains(QT_CONFIG, phonon): SUBDIRS += phononwidgets
 contains(QT_CONFIG, declarative): SUBDIRS += qdeclarativeview
diff --git a/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview.pro b/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview.pro
index b8abe87..cbe3ebe 100644
--- a/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview.pro
+++ b/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview.pro
@@ -1,7 +1,7 @@
 TEMPLATE    = lib
 TARGET      = qdeclarativeview
 CONFIG     += qt warn_on plugin designer
-QT         += declarative
+QT         += quick1
 
 include(../plugins.pri)
 build_all:!build_pass {
diff --git a/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview_plugin.cpp b/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview_plugin.cpp
index d35df04..f6c4fd6 100644
--- a/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview_plugin.cpp
+++ b/tools/designer/src/plugins/qdeclarativeview/qdeclarativeview_plugin.cpp
@@ -45,7 +45,7 @@
 #include <QtDesigner/QExtensionManager>
 
 #include <QtCore/qplugin.h>
-#include <QtDeclarative/QDeclarativeView>
+#include <QtQuick1/QDeclarativeView>
 
 static const char toolTipC[] = "QtDeclarative view widget";
 
diff --git a/tools/qml/qml.pri b/tools/qml/qml.pri
index cfc74af..f118bb2 100644
--- a/tools/qml/qml.pri
+++ b/tools/qml/qml.pri
@@ -1,4 +1,4 @@
-QT += declarative script network sql
+QT += quick1 quick1-private script network sql core-private gui-private widgets-private
 contains(QT_CONFIG, opengl) {
     QT += opengl
     DEFINES += GL_SUPPORTED
diff --git a/tools/qml/qml.pro b/tools/qml/qml.pro
index 3d1b84b..05b9436 100644
--- a/tools/qml/qml.pro
+++ b/tools/qml/qml.pro
@@ -1,5 +1,5 @@
 TEMPLATE = app
-CONFIG += qt uic declarative_debug
+CONFIG += qt uic quick1_debug
 DESTDIR = ../../bin
 
 include(qml.pri)
diff --git a/tools/qml/qmlruntime.cpp b/tools/qml/qmlruntime.cpp
index 9f79f3b..a5fe860 100644
--- a/tools/qml/qmlruntime.cpp
+++ b/tools/qml/qmlruntime.cpp
@@ -92,6 +92,7 @@
 #include <QKeyEvent>
 #include <QMutex>
 #include <QMutexLocker>
+#include <QMimeData>
 #include "proxysettings.h"
 #include "deviceorientation.h"
 
diff --git a/tools/tools.pro b/tools/tools.pro
new file mode 100644
index 0000000..f17f4cb
--- /dev/null
+++ b/tools/tools.pro
@@ -0,0 +1,2 @@
+TEMPLATE = subdirs
+SUBDIRS += qml