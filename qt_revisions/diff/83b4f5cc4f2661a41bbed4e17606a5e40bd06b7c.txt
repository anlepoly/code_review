diff --git a/tests/auto/particles/qquickage/qquickage.pro b/tests/auto/particles/qquickage/qquickage.pro
index 6616ec4..99c768f 100644
--- a/tests/auto/particles/qquickage/qquickage.pro
+++ b/tests/auto/particles/qquickage/qquickage.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickage
 SOURCES += tst_qquickage.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickage/tst_qquickage.cpp b/tests/auto/particles/qquickage/tst_qquickage.cpp
index 78b8ae5..d3562c2 100644
--- a/tests/auto/particles/qquickage/tst_qquickage.cpp
+++ b/tests/auto/particles/qquickage/tst_qquickage.cpp
@@ -44,27 +44,32 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickage : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickage : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickage();
+    tst_qquickage() {}
 
 private slots:
+    void initTestCase();
+
     void test_kill();
     void test_jump();
     void test_onceOff();
     void test_sustained();
 };
 
-tst_qquickage::tst_qquickage()
+void tst_qquickage::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickage::test_kill()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/kill.qml", 600);
+    QQuickView* view = createView(testFileUrl("kill.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -89,7 +94,7 @@ void tst_qquickage::test_kill()
 
 void tst_qquickage::test_jump()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/jump.qml", 600);
+    QQuickView* view = createView(testFileUrl("jump.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -115,7 +120,7 @@ void tst_qquickage::test_jump()
 
 void tst_qquickage::test_onceOff()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/onceoff.qml", 600);
+    QQuickView* view = createView(testFileUrl("onceoff.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -140,7 +145,7 @@ void tst_qquickage::test_onceOff()
 
 void tst_qquickage::test_sustained()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/sustained.qml", 600);
+    QQuickView* view = createView(testFileUrl("sustained.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
     //TODO: Ensure some particles have lived to 0.4s point despite unified timer
diff --git a/tests/auto/particles/qquickangleddirection/qquickangleddirection.pro b/tests/auto/particles/qquickangleddirection/qquickangleddirection.pro
index ac37973..6899ee6 100644
--- a/tests/auto/particles/qquickangleddirection/qquickangleddirection.pro
+++ b/tests/auto/particles/qquickangleddirection/qquickangleddirection.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickangleddirection
 SOURCES += tst_qquickangleddirection.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickangleddirection/tst_qquickangleddirection.cpp b/tests/auto/particles/qquickangleddirection/tst_qquickangleddirection.cpp
index d916efc..24828d9 100644
--- a/tests/auto/particles/qquickangleddirection/tst_qquickangleddirection.cpp
+++ b/tests/auto/particles/qquickangleddirection/tst_qquickangleddirection.cpp
@@ -45,24 +45,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickangleddirection : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickangleddirection : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickangleddirection();
+    tst_qquickangleddirection() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickangleddirection::tst_qquickangleddirection()
+void tst_qquickangleddirection::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickangleddirection::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickcumulativedirection/qquickcumulativedirection.pro b/tests/auto/particles/qquickcumulativedirection/qquickcumulativedirection.pro
index 42029ce..b5d3efa 100644
--- a/tests/auto/particles/qquickcumulativedirection/qquickcumulativedirection.pro
+++ b/tests/auto/particles/qquickcumulativedirection/qquickcumulativedirection.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickcumulativedirection
 SOURCES += tst_qquickcumulativedirection.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickcumulativedirection/tst_qquickcumulativedirection.cpp b/tests/auto/particles/qquickcumulativedirection/tst_qquickcumulativedirection.cpp
index aaa89ec..3fad1b8 100644
--- a/tests/auto/particles/qquickcumulativedirection/tst_qquickcumulativedirection.cpp
+++ b/tests/auto/particles/qquickcumulativedirection/tst_qquickcumulativedirection.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickcumulativedirection : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickcumulativedirection : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickcumulativedirection();
+    tst_qquickcumulativedirection() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickcumulativedirection::tst_qquickcumulativedirection()
+void tst_qquickcumulativedirection::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickcumulativedirection::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickcustomaffector/qquickcustomaffector.pro b/tests/auto/particles/qquickcustomaffector/qquickcustomaffector.pro
index fdc2445..b1533d6 100644
--- a/tests/auto/particles/qquickcustomaffector/qquickcustomaffector.pro
+++ b/tests/auto/particles/qquickcustomaffector/qquickcustomaffector.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickcustomaffector
 SOURCES += tst_qquickcustomaffector.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickcustomaffector/tst_qquickcustomaffector.cpp b/tests/auto/particles/qquickcustomaffector/tst_qquickcustomaffector.cpp
index c854ebe..b63cde1 100644
--- a/tests/auto/particles/qquickcustomaffector/tst_qquickcustomaffector.cpp
+++ b/tests/auto/particles/qquickcustomaffector/tst_qquickcustomaffector.cpp
@@ -44,25 +44,29 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickcustomaffector : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickcustomaffector : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickcustomaffector();
+    tst_qquickcustomaffector() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
     void test_move();
 };
 
-tst_qquickcustomaffector::tst_qquickcustomaffector()
+void tst_qquickcustomaffector::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickcustomaffector::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -95,7 +99,7 @@ void tst_qquickcustomaffector::test_basic()
 
 void tst_qquickcustomaffector::test_move()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/move.qml", 600);
+    QQuickView* view = createView(testFileUrl("move.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickcustomparticle/qquickcustomparticle.pro b/tests/auto/particles/qquickcustomparticle/qquickcustomparticle.pro
index a12c1af..6666c91 100644
--- a/tests/auto/particles/qquickcustomparticle/qquickcustomparticle.pro
+++ b/tests/auto/particles/qquickcustomparticle/qquickcustomparticle.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickcustomparticle
 SOURCES += tst_qquickcustomparticle.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickcustomparticle/tst_qquickcustomparticle.cpp b/tests/auto/particles/qquickcustomparticle/tst_qquickcustomparticle.cpp
index 237fc30..a54e10a 100644
--- a/tests/auto/particles/qquickcustomparticle/tst_qquickcustomparticle.cpp
+++ b/tests/auto/particles/qquickcustomparticle/tst_qquickcustomparticle.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickcustomparticle : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickcustomparticle : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickcustomparticle();
+    tst_qquickcustomparticle() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickcustomparticle::tst_qquickcustomparticle()
+void tst_qquickcustomparticle::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickcustomparticle::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QVERIFY(view);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
diff --git a/tests/auto/particles/qquickellipseextruder/qquickellipseextruder.pro b/tests/auto/particles/qquickellipseextruder/qquickellipseextruder.pro
index 48d0120..b7eedb0 100644
--- a/tests/auto/particles/qquickellipseextruder/qquickellipseextruder.pro
+++ b/tests/auto/particles/qquickellipseextruder/qquickellipseextruder.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickellipseextruder
 SOURCES += tst_qquickellipseextruder.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickellipseextruder/tst_qquickellipseextruder.cpp b/tests/auto/particles/qquickellipseextruder/tst_qquickellipseextruder.cpp
index 4fbc656..2d86233 100644
--- a/tests/auto/particles/qquickellipseextruder/tst_qquickellipseextruder.cpp
+++ b/tests/auto/particles/qquickellipseextruder/tst_qquickellipseextruder.cpp
@@ -45,20 +45,24 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickellipseextruder : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickellipseextruder : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickellipseextruder();
+    tst_qquickellipseextruder() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 private:
     bool inCircle(qreal x, qreal y, qreal r, bool borderOnly=false);
 };
 
-tst_qquickellipseextruder::tst_qquickellipseextruder()
+void tst_qquickellipseextruder::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
@@ -77,7 +81,7 @@ bool tst_qquickellipseextruder::inCircle(qreal x, qreal y, qreal r, bool borderO
 
 void tst_qquickellipseextruder::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickfriction/qquickfriction.pro b/tests/auto/particles/qquickfriction/qquickfriction.pro
index 85b5263..19c789d 100644
--- a/tests/auto/particles/qquickfriction/qquickfriction.pro
+++ b/tests/auto/particles/qquickfriction/qquickfriction.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickfriction
 SOURCES += tst_qquickfriction.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickfriction/tst_qquickfriction.cpp b/tests/auto/particles/qquickfriction/tst_qquickfriction.cpp
index 210e7d7..c3559fa 100644
--- a/tests/auto/particles/qquickfriction/tst_qquickfriction.cpp
+++ b/tests/auto/particles/qquickfriction/tst_qquickfriction.cpp
@@ -44,25 +44,29 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickfriction : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickfriction : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickfriction();
+    tst_qquickfriction() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
     void test_threshold();
 };
 
-tst_qquickfriction::tst_qquickfriction()
+void tst_qquickfriction::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickfriction::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -106,7 +110,7 @@ void tst_qquickfriction::test_basic()
 
 void tst_qquickfriction::test_threshold()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/threshold.qml", 600);
+    QQuickView* view = createView(testFileUrl("threshold.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickgravity/qquickgravity.pro b/tests/auto/particles/qquickgravity/qquickgravity.pro
index 5340b32..a3fab38 100644
--- a/tests/auto/particles/qquickgravity/qquickgravity.pro
+++ b/tests/auto/particles/qquickgravity/qquickgravity.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickgravity
 SOURCES += tst_qquickgravity.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickgravity/tst_qquickgravity.cpp b/tests/auto/particles/qquickgravity/tst_qquickgravity.cpp
index 2f6df5f..04998d3 100644
--- a/tests/auto/particles/qquickgravity/tst_qquickgravity.cpp
+++ b/tests/auto/particles/qquickgravity/tst_qquickgravity.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickgravity : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickgravity : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickgravity();
+    tst_qquickgravity() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickgravity::tst_qquickgravity()
+void tst_qquickgravity::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickgravity::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickgroupgoal/qquickgroupgoal.pro b/tests/auto/particles/qquickgroupgoal/qquickgroupgoal.pro
index 623993c..b97549e 100644
--- a/tests/auto/particles/qquickgroupgoal/qquickgroupgoal.pro
+++ b/tests/auto/particles/qquickgroupgoal/qquickgroupgoal.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickgroupgoal
 SOURCES += tst_qquickgroupgoal.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickgroupgoal/tst_qquickgroupgoal.cpp b/tests/auto/particles/qquickgroupgoal/tst_qquickgroupgoal.cpp
index c1cb8bc..97c095e 100644
--- a/tests/auto/particles/qquickgroupgoal/tst_qquickgroupgoal.cpp
+++ b/tests/auto/particles/qquickgroupgoal/tst_qquickgroupgoal.cpp
@@ -44,25 +44,29 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickgroupgoal : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickgroupgoal : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickgroupgoal();
+    tst_qquickgroupgoal() {}
 
 private slots:
+    void initTestCase();
     void test_instantTransition();
 };
 
-tst_qquickgroupgoal::tst_qquickgroupgoal()
+void tst_qquickgroupgoal::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickgroupgoal::test_instantTransition()
 {
     //Note: Does not go through sprite engine
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickimageparticle/qquickimageparticle.pro b/tests/auto/particles/qquickimageparticle/qquickimageparticle.pro
index 1241467..590f698 100644
--- a/tests/auto/particles/qquickimageparticle/qquickimageparticle.pro
+++ b/tests/auto/particles/qquickimageparticle/qquickimageparticle.pro
@@ -3,8 +3,7 @@ TARGET = tst_qquickimageparticle
 SOURCES += tst_qquickimageparticle.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
diff --git a/tests/auto/particles/qquickimageparticle/tst_qquickimageparticle.cpp b/tests/auto/particles/qquickimageparticle/tst_qquickimageparticle.cpp
index 4d8a2e9..b953859 100644
--- a/tests/auto/particles/qquickimageparticle/tst_qquickimageparticle.cpp
+++ b/tests/auto/particles/qquickimageparticle/tst_qquickimageparticle.cpp
@@ -44,16 +44,19 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
+#include "../../shared/util.h"
+
 const double CONV_FACTOR = 0.017453292519943295;//Degrees to radians
 
-class tst_qquickimageparticle : public QObject
+class tst_qquickimageparticle : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickimageparticle();
+    tst_qquickimageparticle() {}
     ~tst_qquickimageparticle();
 
 private slots:
+    void initTestCase();
     void test_basic();
     void test_colored();
     void test_colorVariance();
@@ -62,8 +65,9 @@ private slots:
     void test_sprite();
 };
 
-tst_qquickimageparticle::tst_qquickimageparticle()
+void tst_qquickimageparticle::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
     setenv("QML_PARTICLES_DEBUG","please",0);//QQuickImageParticle has several debug statements, with possible pointer dereferences
 }
@@ -75,7 +79,7 @@ tst_qquickimageparticle::~tst_qquickimageparticle()
 
 void tst_qquickimageparticle::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -119,7 +123,7 @@ void tst_qquickimageparticle::test_basic()
 
 void tst_qquickimageparticle::test_colored()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/colored.qml", 600);
+    QQuickView* view = createView(testFileUrl("colored.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -163,7 +167,7 @@ void tst_qquickimageparticle::test_colored()
 
 void tst_qquickimageparticle::test_colorVariance()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/colorVariance.qml", 600);
+    QQuickView* view = createView(testFileUrl("colorVariance.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -208,7 +212,7 @@ void tst_qquickimageparticle::test_colorVariance()
 
 void tst_qquickimageparticle::test_deformed()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/deformed.qml", 600);
+    QQuickView* view = createView(testFileUrl("deformed.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -252,7 +256,7 @@ void tst_qquickimageparticle::test_deformed()
 
 void tst_qquickimageparticle::test_tabled()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/tabled.qml", 600);
+    QQuickView* view = createView(testFileUrl("tabled.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
@@ -297,7 +301,7 @@ void tst_qquickimageparticle::test_tabled()
 
 void tst_qquickimageparticle::test_sprite()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/sprite.qml", 600);
+    QQuickView* view = createView(testFileUrl("sprite.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickitemparticle/qquickitemparticle.pro b/tests/auto/particles/qquickitemparticle/qquickitemparticle.pro
index 262ebdd..b275e4b 100644
--- a/tests/auto/particles/qquickitemparticle/qquickitemparticle.pro
+++ b/tests/auto/particles/qquickitemparticle/qquickitemparticle.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickitemparticle
 SOURCES += tst_qquickitemparticle.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickitemparticle/tst_qquickitemparticle.cpp b/tests/auto/particles/qquickitemparticle/tst_qquickitemparticle.cpp
index a447a58..629287a 100644
--- a/tests/auto/particles/qquickitemparticle/tst_qquickitemparticle.cpp
+++ b/tests/auto/particles/qquickitemparticle/tst_qquickitemparticle.cpp
@@ -45,24 +45,28 @@
 #include <private/qquickimage_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickitemparticle : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickitemparticle : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickitemparticle();
+    tst_qquickitemparticle() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickitemparticle::tst_qquickitemparticle()
+void tst_qquickitemparticle::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickitemparticle::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquicklineextruder/qquicklineextruder.pro b/tests/auto/particles/qquicklineextruder/qquicklineextruder.pro
index 3b87f00..519b3e4 100644
--- a/tests/auto/particles/qquicklineextruder/qquicklineextruder.pro
+++ b/tests/auto/particles/qquicklineextruder/qquicklineextruder.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquicklineextruder
 SOURCES += tst_qquicklineextruder.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquicklineextruder/tst_qquicklineextruder.cpp b/tests/auto/particles/qquicklineextruder/tst_qquicklineextruder.cpp
index eac0a6b..d760bc5 100644
--- a/tests/auto/particles/qquicklineextruder/tst_qquicklineextruder.cpp
+++ b/tests/auto/particles/qquicklineextruder/tst_qquicklineextruder.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquicklineextruder : public QObject
+#include "../../shared/util.h"
+
+class tst_qquicklineextruder : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquicklineextruder();
+    tst_qquicklineextruder() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquicklineextruder::tst_qquicklineextruder()
+void tst_qquicklineextruder::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquicklineextruder::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickmaskextruder/qquickmaskextruder.pro b/tests/auto/particles/qquickmaskextruder/qquickmaskextruder.pro
index 33d6f2e..48aeadd 100644
--- a/tests/auto/particles/qquickmaskextruder/qquickmaskextruder.pro
+++ b/tests/auto/particles/qquickmaskextruder/qquickmaskextruder.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickmaskextruder
 SOURCES += tst_qquickmaskextruder.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickmaskextruder/tst_qquickmaskextruder.cpp b/tests/auto/particles/qquickmaskextruder/tst_qquickmaskextruder.cpp
index 1ccf93e..7feb6e2 100644
--- a/tests/auto/particles/qquickmaskextruder/tst_qquickmaskextruder.cpp
+++ b/tests/auto/particles/qquickmaskextruder/tst_qquickmaskextruder.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickmaskextruder : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickmaskextruder : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickmaskextruder();
+    tst_qquickmaskextruder() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickmaskextruder::tst_qquickmaskextruder()
+void tst_qquickmaskextruder::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickmaskextruder::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickparticlegroup/qquickparticlegroup.pro b/tests/auto/particles/qquickparticlegroup/qquickparticlegroup.pro
index 594b704..d3e132f 100644
--- a/tests/auto/particles/qquickparticlegroup/qquickparticlegroup.pro
+++ b/tests/auto/particles/qquickparticlegroup/qquickparticlegroup.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickparticlegroup
 SOURCES += tst_qquickparticlegroup.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickparticlegroup/tst_qquickparticlegroup.cpp b/tests/auto/particles/qquickparticlegroup/tst_qquickparticlegroup.cpp
index 584ef80..ff08876 100644
--- a/tests/auto/particles/qquickparticlegroup/tst_qquickparticlegroup.cpp
+++ b/tests/auto/particles/qquickparticlegroup/tst_qquickparticlegroup.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickparticlegroup : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickparticlegroup : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickparticlegroup();
+    tst_qquickparticlegroup() {}
 
 private slots:
+    void initTestCase();
     void test_instantTransition();
 };
 
-tst_qquickparticlegroup::tst_qquickparticlegroup()
+void tst_qquickparticlegroup::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickparticlegroup::test_instantTransition()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickparticlesystem/qquickparticlesystem.pro b/tests/auto/particles/qquickparticlesystem/qquickparticlesystem.pro
index ea5642a..b241048 100644
--- a/tests/auto/particles/qquickparticlesystem/qquickparticlesystem.pro
+++ b/tests/auto/particles/qquickparticlesystem/qquickparticlesystem.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickparticlesystem
 SOURCES += tst_qquickparticlesystem.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickparticlesystem/tst_qquickparticlesystem.cpp b/tests/auto/particles/qquickparticlesystem/tst_qquickparticlesystem.cpp
index f4327ad..45e9ced 100644
--- a/tests/auto/particles/qquickparticlesystem/tst_qquickparticlesystem.cpp
+++ b/tests/auto/particles/qquickparticlesystem/tst_qquickparticlesystem.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickparticlesystem : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickparticlesystem : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickparticlesystem();
+    tst_qquickparticlesystem() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickparticlesystem::tst_qquickparticlesystem()
+void tst_qquickparticlesystem::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickparticlesystem::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickpointattractor/qquickpointattractor.pro b/tests/auto/particles/qquickpointattractor/qquickpointattractor.pro
index 4a93555..22a9ac5 100644
--- a/tests/auto/particles/qquickpointattractor/qquickpointattractor.pro
+++ b/tests/auto/particles/qquickpointattractor/qquickpointattractor.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickpointattractor
 SOURCES += tst_qquickpointattractor.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickpointattractor/tst_qquickpointattractor.cpp b/tests/auto/particles/qquickpointattractor/tst_qquickpointattractor.cpp
index bc81fef..d2ef298 100644
--- a/tests/auto/particles/qquickpointattractor/tst_qquickpointattractor.cpp
+++ b/tests/auto/particles/qquickpointattractor/tst_qquickpointattractor.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickpointattractor : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickpointattractor : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickpointattractor();
+    tst_qquickpointattractor() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickpointattractor::tst_qquickpointattractor()
+void tst_qquickpointattractor::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickpointattractor::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickpointdirection/qquickpointdirection.pro b/tests/auto/particles/qquickpointdirection/qquickpointdirection.pro
index 093e7a7..319bdee 100644
--- a/tests/auto/particles/qquickpointdirection/qquickpointdirection.pro
+++ b/tests/auto/particles/qquickpointdirection/qquickpointdirection.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickpointdirection
 SOURCES += tst_qquickpointdirection.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickpointdirection/tst_qquickpointdirection.cpp b/tests/auto/particles/qquickpointdirection/tst_qquickpointdirection.cpp
index b105298..885cd79 100644
--- a/tests/auto/particles/qquickpointdirection/tst_qquickpointdirection.cpp
+++ b/tests/auto/particles/qquickpointdirection/tst_qquickpointdirection.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickpointdirection : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickpointdirection : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickpointdirection();
+    tst_qquickpointdirection() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickpointdirection::tst_qquickpointdirection()
+void tst_qquickpointdirection::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickpointdirection::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickrectangleextruder/qquickrectangleextruder.pro b/tests/auto/particles/qquickrectangleextruder/qquickrectangleextruder.pro
index 1b5da61..683f77e 100644
--- a/tests/auto/particles/qquickrectangleextruder/qquickrectangleextruder.pro
+++ b/tests/auto/particles/qquickrectangleextruder/qquickrectangleextruder.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickrectangleextruder
 SOURCES += tst_qquickrectangleextruder.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickrectangleextruder/tst_qquickrectangleextruder.cpp b/tests/auto/particles/qquickrectangleextruder/tst_qquickrectangleextruder.cpp
index a13fe23..570e23a 100644
--- a/tests/auto/particles/qquickrectangleextruder/tst_qquickrectangleextruder.cpp
+++ b/tests/auto/particles/qquickrectangleextruder/tst_qquickrectangleextruder.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickrectangleextruder : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickrectangleextruder : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickrectangleextruder();
+    tst_qquickrectangleextruder() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickrectangleextruder::tst_qquickrectangleextruder()
+void tst_qquickrectangleextruder::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickrectangleextruder::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickspritegoal/qquickspritegoal.pro b/tests/auto/particles/qquickspritegoal/qquickspritegoal.pro
index 9908f22..95cf68f 100644
--- a/tests/auto/particles/qquickspritegoal/qquickspritegoal.pro
+++ b/tests/auto/particles/qquickspritegoal/qquickspritegoal.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickspritegoal
 SOURCES += tst_qquickspritegoal.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickspritegoal/tst_qquickspritegoal.cpp b/tests/auto/particles/qquickspritegoal/tst_qquickspritegoal.cpp
index f499147..704651a 100644
--- a/tests/auto/particles/qquickspritegoal/tst_qquickspritegoal.cpp
+++ b/tests/auto/particles/qquickspritegoal/tst_qquickspritegoal.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickspritegoal : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickspritegoal : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickspritegoal();
+    tst_qquickspritegoal() {}
 
 private slots:
+    void initTestCase();
     void test_instantTransition();
 };
 
-tst_qquickspritegoal::tst_qquickspritegoal()
+void tst_qquickspritegoal::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickspritegoal::test_instantTransition()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquicktargetdirection/qquicktargetdirection.pro b/tests/auto/particles/qquicktargetdirection/qquicktargetdirection.pro
index 226cd9d..a4a09ae 100644
--- a/tests/auto/particles/qquicktargetdirection/qquicktargetdirection.pro
+++ b/tests/auto/particles/qquicktargetdirection/qquicktargetdirection.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquicktargetdirection
 SOURCES += tst_qquicktargetdirection.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquicktargetdirection/tst_qquicktargetdirection.cpp b/tests/auto/particles/qquicktargetdirection/tst_qquicktargetdirection.cpp
index 666bed8..2362be9 100644
--- a/tests/auto/particles/qquicktargetdirection/tst_qquicktargetdirection.cpp
+++ b/tests/auto/particles/qquicktargetdirection/tst_qquicktargetdirection.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquicktargetdirection : public QObject
+#include "../../shared/util.h"
+
+class tst_qquicktargetdirection : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquicktargetdirection();
+    tst_qquicktargetdirection() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquicktargetdirection::tst_qquicktargetdirection()
+void tst_qquicktargetdirection::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquicktargetdirection::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquicktrailemitter/qquicktrailemitter.pro b/tests/auto/particles/qquicktrailemitter/qquicktrailemitter.pro
index 67b14c8..e169ccd 100644
--- a/tests/auto/particles/qquicktrailemitter/qquicktrailemitter.pro
+++ b/tests/auto/particles/qquicktrailemitter/qquicktrailemitter.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquicktrailemitter
 SOURCES += tst_qquicktrailemitter.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquicktrailemitter/tst_qquicktrailemitter.cpp b/tests/auto/particles/qquicktrailemitter/tst_qquicktrailemitter.cpp
index 1759c97..da4235f 100644
--- a/tests/auto/particles/qquicktrailemitter/tst_qquicktrailemitter.cpp
+++ b/tests/auto/particles/qquicktrailemitter/tst_qquicktrailemitter.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquicktrailemitter : public QObject
+#include "../../shared/util.h"
+
+class tst_qquicktrailemitter : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquicktrailemitter();
+    tst_qquicktrailemitter() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquicktrailemitter::tst_qquicktrailemitter()
+void tst_qquicktrailemitter::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquicktrailemitter::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickturbulence/qquickturbulence.pro b/tests/auto/particles/qquickturbulence/qquickturbulence.pro
index d8de625..306d58d 100644
--- a/tests/auto/particles/qquickturbulence/qquickturbulence.pro
+++ b/tests/auto/particles/qquickturbulence/qquickturbulence.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickturbulence
 SOURCES += tst_qquickturbulence.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickturbulence/tst_qquickturbulence.cpp b/tests/auto/particles/qquickturbulence/tst_qquickturbulence.cpp
index 5ea9821..985003c 100644
--- a/tests/auto/particles/qquickturbulence/tst_qquickturbulence.cpp
+++ b/tests/auto/particles/qquickturbulence/tst_qquickturbulence.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickturbulence : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickturbulence : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickturbulence();
+    tst_qquickturbulence() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickturbulence::tst_qquickturbulence()
+void tst_qquickturbulence::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickturbulence::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/qquickwander/qquickwander.pro b/tests/auto/particles/qquickwander/qquickwander.pro
index ceb1d9f..94b8837 100644
--- a/tests/auto/particles/qquickwander/qquickwander.pro
+++ b/tests/auto/particles/qquickwander/qquickwander.pro
@@ -3,9 +3,8 @@ TARGET = tst_qquickwander
 SOURCES += tst_qquickwander.cpp
 macx:CONFIG -= app_bundle
 
-testDataFiles.files = data
-testDataFiles.path = .
-DEPLOYMENT += testDataFiles
+include (../../shared/util.pri)
+TESTDATA = data/*
 
 QT += core-private gui-private v8-private qml-private quick-private opengl-private testlib
 
diff --git a/tests/auto/particles/qquickwander/tst_qquickwander.cpp b/tests/auto/particles/qquickwander/tst_qquickwander.cpp
index 9b04a0c..12aae95 100644
--- a/tests/auto/particles/qquickwander/tst_qquickwander.cpp
+++ b/tests/auto/particles/qquickwander/tst_qquickwander.cpp
@@ -44,24 +44,28 @@
 #include <private/qquickparticlesystem_p.h>
 #include <private/qabstractanimation_p.h>
 
-class tst_qquickwander : public QObject
+#include "../../shared/util.h"
+
+class tst_qquickwander : public QQmlDataTest
 {
     Q_OBJECT
 public:
-    tst_qquickwander();
+    tst_qquickwander() {}
 
 private slots:
+    void initTestCase();
     void test_basic();
 };
 
-tst_qquickwander::tst_qquickwander()
+void tst_qquickwander::initTestCase()
 {
+    QQmlDataTest::initTestCase();
     QUnifiedTimer::instance()->setConsistentTiming(true);
 }
 
 void tst_qquickwander::test_basic()
 {
-    QQuickView* view = createView(QCoreApplication::applicationDirPath() + "/data/basic.qml", 600);
+    QQuickView* view = createView(testFileUrl("basic.qml"), 600);
     QQuickParticleSystem* system = view->rootObject()->findChild<QQuickParticleSystem*>("system");
     ensureAnimTime(600, system->m_animation);
 
diff --git a/tests/auto/particles/shared/particlestestsshared.h b/tests/auto/particles/shared/particlestestsshared.h
index 114ade7..d1d1813 100644
--- a/tests/auto/particles/shared/particlestestsshared.h
+++ b/tests/auto/particles/shared/particlestestsshared.h
@@ -66,11 +66,11 @@ bool myFuzzyGEQ(qreal a, qreal b)
     return (a + EPSILON > b);
 }
 
-QQuickView* createView(const QString &filename, int additionalWait=0)
+QQuickView* createView(const QUrl &filename, int additionalWait=0)
 {
     QQuickView *canvas = new QQuickView(0);
 
-    canvas->setSource(QUrl::fromLocalFile(filename));
+    canvas->setSource(filename);
     if (canvas->status() != QQuickView::Ready)
         return 0;
     canvas->show();